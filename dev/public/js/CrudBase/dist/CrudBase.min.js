class AddrLatLng{constructor(t){t=this._setParamIfEmpty(t),this.tDiv=jQuery("#"+t.div_xid),this.param=t,this.map,this.infoWindow1,this.marker,this.geocoder,this.init_flg=!1,this.wrapDiv=this.tDiv.find(t.wrap_slt),this.addrElm=this.tDiv.find(t.address_tb_slt),this.latElm=this.tDiv.find(t.lat_tb_slt),this.lngElm=this.tDiv.find(t.lng_tb_slt),this.errElm=this.tDiv.find(t.err_slt)}_setParamIfEmpty(t){return null==t&&(t={}),null==t.div_xid&&(t.div_xid="addr_lat_lng"),null==t.wrap_slt&&(t.wrap_slt=".allex_map_w"),null==t.map_slt&&(t.map_slt=".allex_map"),null==t.address_tb_slt&&(t.address_tb_slt=".allex_address"),null==t.lat_tb_slt&&(t.lat_tb_slt=".allex_lat"),null==t.lng_tb_slt&&(t.lng_tb_slt=".allex_lng"),null==t.err_slt&&(t.err_slt=".allex_err"),null==t.def_lat&&(t.def_lat=35.670528),null==t.def_lng&&(t.def_lng=139.72014),null==t.lat&&(t.lat=t.def_lat),null==t.lng&&(t.lng=t.def_lng),null==t.zoom&&(t.zoom=15),t}init(){let t=this.param,e=this.tDiv.find(t.map_slt),i=new google.maps.Map(e[0],{center:new google.maps.LatLng(t.lat,t.lng),zoom:t.zoom});this.map=i;let a=new google.maps.Marker({map:i,position:new google.maps.LatLng(t.lat,t.lng)});this.marker=a,i.addListener("click",(t=>{this._clickOnMap(t)})),this.init_flg=!0}_clickOnMap(t){let e=t.latLng,i=e.lat(),a=e.lng();t.placeId;this.latElm.val(i),this.lngElm.val(a),this.param.lat=i,this.param.lng=a}addrLatLngShowMap(t){this.wrapDiv.show(),this._errShow(""),0==this.init_flg&&this.init();let e=this.param,i=this.latElm.val(),a=this.lngElm.val();this._empty(i)&&(i=e.def_lat),this._empty(a)&&(a=e.def_lng);let r=new google.maps.LatLng(i,a);this.map.setCenter(r),this.marker.setPosition(r),this.param.lat=i,this.param.lng=a}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}addrLatLngAutoSet(t){this._errShow("");let e=this.addrElm.val();this._empty(e)?this._errShow("住所を入力してください"):(null==this.geocoder&&(this.geocoder=new google.maps.Geocoder),this.geocoder.geocode({address:e},((t,e)=>{if("OK"===e&&t[0]){let e=t[0],i=e.geometry.location.lat(),a=e.geometry.location.lng();this.latElm.val(i),this.lngElm.val(a),this.init_flg&&(this.map.setCenter(e.geometry.location),this.marker.setPosition(e.geometry.location))}else this._errShow("住所の場所は見つかりませんでした。")})))}_errShow(t){this.errElm.html(t)}addrLatLngEditShow(){if(0==this.init_flg)return;let t=this.param;this._errShow("");let e=this.latElm.val(),i=this.lngElm.val();this._empty(e)&&(e=t.def_lat),this._empty(i)&&(i=t.def_lng);let a=new google.maps.LatLng(e,i);this.map.setCenter(a),this.marker.setPosition(a),this.param.lat=e,this.param.lng=i}}
/**
 * 住所緯度経度・編集機能【拡張】 | AddrLatLngのラッパークラス 
 * 
 * @note
 * Yahoo ジオコーダに対応
 * 
 * @date 2019-8-2 | 2019-8-16
 * @license MIT
 * @version 1.0.1
 */class AddrLatLngEx{init(t){this.param=this._setParamIfEmpty(t),this.tDiv=jQuery("#"+this.param.div_xid);let e=this._createHtml(this.param);this.tDiv.html(e),this.addrLatLng=new AddrLatLng(this.param),this.fShowBtn=this.tDiv.find(".allex_f_show_btn"),this.funcDiv=this.tDiv.find(".allex_func_div"),this.resDiv=this.tDiv.find(".allex_res"),this.errDiv=this.tDiv.find(".allex_err"),this.yAutoSetBtn=this.tDiv.find(".allex_y_auto_set_btn"),this.byGApiBtn=this.tDiv.find(".allex_by_g_api_btn"),this.gApiDiv=this.tDiv.find(".allex_g_api_div"),this.showMapBtn=this.tDiv.find(".allex_show_map_btn"),this.autoSetBtn=this.tDiv.find(".allex_auto_set_btn"),this.mapWrap=this.tDiv.find(".allex_map_w"),this.mapCloseBtn=this.tDiv.find(".allex_map_close_btn"),this.addrElm=this.tDiv.find(t.address_tb_slt),this.latElm=this.tDiv.find(t.lat_tb_slt),this.lngElm=this.tDiv.find(t.lng_tb_slt),this._addClickYAutoSetBtn(this.yAutoSetBtn),this._addClickByGApiBtn(this.byGApiBtn),this._addClickFShowBtn(this.fShowBtn),this._addClickShowMapBtn(this.showMapBtn),this._addClickAutoSetBtn(this.autoSetBtn),this._addClickMapCloseBtn(this.mapCloseBtn)}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.div_xid&&(t.div_xid="addr_lat_lng_ex"),null==t.wrap_slt&&(t.wrap_slt=".allex_map_w"),null==t.map_slt&&(t.map_slt=".allex_map"),null==t.address_tb_slt&&(t.address_tb_slt=".allex_address"),null==t.lat_tb_slt&&(t.lat_tb_slt=".allex_lat"),null==t.lng_tb_slt&&(t.lng_tb_slt=".allex_lng"),null==t.err_slt&&(t.err_slt=".allex_err"),null==t.ajax_url_y_auto_set)throw"'ajax_url_y_auto_set' is empty!";return null==t.address_field&&(t.address_field="address"),t}_createHtml(t){return`\n\t\t<input class='allex_f_show_btn btn btn-primary btn-sm' type="button" value='住所緯度経度・編集' />\n\t\t<div class='allex_func_div' style="display:none">\n\t\t\t<div style="width:100%">\n\t\t\t\t住所: <input type="text" name="${t.address_field}" class="allex_address valid" value=""  maxlength="200" title="200文字以内で入力してください" style="width:100%;" />\n\t\t\t\t<label class="text-danger" for="${t.address_field}"></label>\n\t\t\t</div>\n\t\t\t<div class='cbf_input' style="margin-right:8px">\n\t\t\t\t緯度: <input type="text" name="lat" class="allex_lat valid" value=""  pattern="[+-]?[0-9]+[.]?[0-9]*([eE][+-])?[0-9]*" maxlength="64" title="数値を入力してください" />\n\t\t\t\t<label class="text-danger" for="lat"></label>\n\t\t\t</div>\n\t\t\t<div class='cbf_input' style="margin-right:8px">\n\t\t\t\t経度: <input type="text" name="lng" class="allex_lng valid" value=""  pattern="[+-]?[0-9]+[.]?[0-9]*([eE][+-])?[0-9]*" maxlength="64" title="数値を入力してください" />\n\t\t\t\t<label class="text-danger" for="lng"></label>\n\t\t\t</div>\n\t\t\t\n\t\t\t<input type="button" class="allex_y_auto_set_btn btn btn-success btn-sm" value="緯度経度取得【Yahoo版】" title="Yahoo APIを利用して住所から緯度経度を取得します。無料機能ですが失敗率は高めです。" />\n\t\t\t<input type="button" class="allex_by_g_api_btn btn btn-info btn-sm" value="Google APIモード" title="Google APIによる緯度経度取得機能を表示します。" />\n\t\t\t<div class="allex_g_api_div" style="display:none;padding:15px;border:solid 3px #FF7373;border-radius:5px;background-color:#FFEEEE">\n\t\t\t\t<div class='cbf_input' style="margin-right:8px">\n\t\t\t\t\t<input type="button" class="allex_auto_set_btn btn btn-danger btn-sm" value="緯度経度設定【Google版】" title="Google APIを利用して住所から緯度経度を取得します。ボタンを押すごとに$0.005の利用料金が発生します。（無料枠あり。2019年時点）" />\n\t\t\t\t\t<input type="button" class="allex_show_map_btn btn btn-primary btn-sm" value="地図から設定" title="地図上をクリックして緯度経度の設定ができます。" />\n\t\t\t\t</div>\n\t\t\t\n\t\t\t\t<div class="allex_map_w" style="display:none;">\n\t\t\t\t\t<input type="button" class="allex_map_close_btn btn btn-secondary btn-sm" value="閉じる" title="地図閉じるボタン" />\n\t\t\t\t\t<div class="allex_map" style="width:100%;height:400px;"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="allex_err text-danger" style="color:red"></div>\n\t\t\t<div class="allex_res text-success"></div>\n\t\t\t\n\t\t</div>\n\t\t`}_showMsg(t){this.resDiv.html(t)}_showErr(t){this.errDiv.html(t+"<br>")}_addClickFShowBtn(t){t.click((t=>{var e=this.funcDiv.css("display");if(null==e|"none"==e){let t=this._getFShowBtnName(0);this.fShowBtn.val(t),this.tDiv.css("display","block"),this.funcDiv.show(300)}else{let t=this._getFShowBtnName(1);this.fShowBtn.val(t),this.tDiv.css("display","inline-block"),this.funcDiv.hide(300)}}))}_getFShowBtnName(t){let e=" (閉じる)",i=this.fShowBtn.val();return 1==t?i=i.replace(e,""):i+=e,i}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}_addClickYAutoSetBtn(t){t.click((t=>{this.clickYAutoSetBtn()}))}_addClickByGApiBtn(t){t.click((t=>{this.gApiDiv.toggle(100)}))}_addClickShowMapBtn(t){t.click((e=>{this.addrLatLngShowMap(t)}))}_addClickAutoSetBtn(t){t.click((e=>{this.addrLatLngAutoSet(t)}))}addrLatLngShowMap(t){t=jQuery(t);this.addrLatLng.addrLatLngShowMap(t)}addrLatLngAutoSet(t){t=jQuery(t);this.addrLatLng.addrLatLngAutoSet(t)}_addClickMapCloseBtn(t){t.click((t=>{this.mapWrap.hide(),this.gApiDiv.hide()}))}addrLatLngEditShow(){this.addrLatLng.addrLatLngEditShow()}clickYAutoSetBtn(){this._showMsg("住所から緯度経度を取得中です...");let t=this.addrElm.val();if(t=t.trim(),this._empty(t))return void this._showErr("住所を入力してください。");t=t.replace(/&/g,"%26");let e={address:t};var i=JSON.stringify(e);jQuery.ajax({type:"POST",url:this.param.ajax_url_y_auto_set,data:"key1="+i,cache:!1,dataType:"text"}).done(((t,e)=>{var i;try{i=jQuery.parseJSON(t)}catch(e){return void this._showErr(t)}this._showMsg(""),0!=i.lat&&0!=i.lng?(this.latElm.val(i.lat),this.lngElm.val(i.lng)):this._showErr("入力の住所からは緯度経度は取得できませんでした。Google API版をお試しください。")})).fail(((t,e,i)=>{this._showMsg(""),this._showErr(t.responseText),alert(e)}))}}class AjaxLoginWithCake{constructor(t){this.param=this._setParamIfEmpty(t)}_setParamIfEmpty(t){return null==t&&(t={}),null==t.btn_type&&(t.btn_type=1),null==t.login_check_url&&(t.login_check_url="ajax_login_with_cake/login_check"),null==t.login_url&&(t.login_url="ajax_login_with_cake/login_rap"),null==t.logout_url&&(t.logout_url="users/logout"),this._isEmpty(t.callback)&&(t.callback=null),this._isEmpty(t.form_slt)&&(t.form_slt="#ajax_login_with_cake"),this._isEmpty(t.csrf_token)&&(t.csrf_token=null),t}_margeParam(t){return this.param=Object.assign({},this.param,t),this.param}loginCheckEx(t){this._getUrlQuery();this.loginCheck(t)}loginCheck(t){t=this._margeParam(t);let e=new FormData,i=JSON.stringify({dummy:1});e.append("key1",i),e.append("_token",t.csrf_token),$.ajax({type:"post",url:t.login_check_url,data:e,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((e,i)=>{let a={};try{a=jQuery.parseJSON(e)}catch(t){throw alert("エラー"+e),new Error(e)}this._showBtns(a),null!=t.callback&&callBack(a.auth_flg)})).fail(((t,e,i)=>{jQuery("#err").html(t.responseText),alert(e)}))}_showBtns(t){let e=this.param.form_slt,i=jQuery(e);if(1==t.auth_flg){let t=this._getLogoutBtnHtml();i.html(t)}else{let t=this._getLoginBtnHtml();i.html(t)}}_getLogoutBtnHtml(){let t=this.param.logout_url,e="";return e=1==this.param.btn_type?"<span class='text-success'>認証中です </span><a href='"+t+"' id='logout_btn' class='btn btn-secondary btn-sm'>ログアウト</a>":"<a href='"+t+"' id='logout_btn'>ログアウト</a>",e}_getLoginBtnHtml(){let t=this.param.login_url,e="";return e=1==this.param.btn_type?"<a id='login_btn' href='"+t+"' class='btn btn-primary' >ログイン</a>":"<a id='login_btn' href='"+t+"' >ログイン</a>",e}_getUrlQuery(){let t=window.location.search;if(""==t||null==t)return{};t=t.substring(1,t.length);let e=t.split("&"),i={};for(let t=0;t<e.length;t++){let a=e[t].split("=");i[a[0]]=a[1]}return i}_isEmpty(t){return""==t||null==t||0==t}_isSet(t){return""!=t&&null!=t&&0!=t}}
/**
 * 一括削除クラス
 * @date 2019-7-27 | 2019-8-16
 * @license MIT
 * @version 1.0.1
 */class BulkDelete{init(t,e){this.param=this._setParamIfEmpty(e),this.tDiv=jQuery("#"+this.param.div_xid);let i=this._createHtml(t);this.tDiv.html(i),this.fShowBtn=this.tDiv.find(".bulk_del_f_show_btn"),this.funcDiv=this.tDiv.find(".bulk_del_func_div"),this.resDiv=this.tDiv.find(".bulk_del_res"),this.errDiv=this.tDiv.find(".bulk_del_err"),this.startBtn=this.tDiv.find(".bulk_del_start_btn"),this.inpsDiv=this.tDiv.find(".bulk_del_inps"),this._addClickFShowBtn(this.fShowBtn),this._addClickStartBtn(this.startBtn),this.delCnds=t}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.div_xid&&(t.div_xid="bulk_delete"),null==t.ajax_url)throw new Error("'ajax_url' is empty!");return t}_createHtml(t){return`\n\t<input class='bulk_del_f_show_btn btn btn-primary btn-sm' type="button" value='条件指定・一括削除' />\n\t<div class='bulk_del_func_div' style="display:none">\n\t\t<div style="display:inline-block;padding:10px;border:solid 4px #5bd59e;border-radius:5px;margin-bottom:10px">\n\t\t\t<p>条件指定・一括削除</p>\n\t\t\t<div class="bulk_del_inps" style="padding-bottom:16px">${this._makeInpsHtml(t)}</div>\n\t\t\t<input class="bulk_del_start_btn btn btn-danger btn-sm" type='button' value="削除実行" />\n\t\t\t<div class="bulk_del_res text-success"></div>\n\t\t\t<div class="bulk_del_err text-danger"></div>\n\t\t</div>\n\t</div>\n\t\t`}_makeInpsHtml(t){let e="";for(let i in t){let a=t[i];switch(a.inp_type){case"text":e+=this._makeInpHtmlText(a);break;case"select":e+=this._makeInpHtmlSelect(a)}}return e}_makeInpHtmlText(t){return`<input type="text" class="${t.field}" placeholder="${t.wamei}">`}_makeInpHtmlSelect(t){let e="",i=t.hashmap;for(let t in i){e+=`<option value="${t}">${i[t]}</option>`}return`\n\t\t\t<select  class="${t.id_field}">\n\t\t\t\t<option value=''>-- ${t.wamei}(未選択) --</option>\n\t\t\t\t${e}\n\t\t\t</select>\n\t\t\t\t`}_showErr(t){this.errDiv.append(t+"<br>")}_addClickFShowBtn(t){t.click((t=>{var e=this.funcDiv.css("display");if(null==e|"none"==e){this.resDiv.html("入力した条件に一致するデータを削除します。");let t=this._getFShowBtnName(0);this.fShowBtn.val(t),this.tDiv.css("display","block"),this.funcDiv.show(300)}else{let t=this._getFShowBtnName(1);this.fShowBtn.val(t),this.tDiv.css("display","inline-block"),this.funcDiv.hide(300)}}))}_getFShowBtnName(t){let e=" (閉じる)",i=this.fShowBtn.val();return 1==t?i=i.replace(e,""):i+=e,i}_addClickStartBtn(t){t.click((t=>{window.confirm("削除を実行します。よろしいですか？")&&this._clickStartBtn()}))}_clickStartBtn(){this.resDiv.html("削除中です。しばらくお待ちください...");let t=this._getKjsFromInps();this.deleteByKjs(t)}deleteByKjs(t){let e={kjs:t};e=this._escapeForAjax(e),e=this._ampTo26(e);let i=JSON.stringify(e);jQuery.ajax({type:"POST",url:this.param.ajax_url,data:"key1="+i,cache:!1,dataType:"text"}).done(((t,e)=>{try{jQuery.parseJSON(t)}catch(e){return void this._showErr(t)}this.resDiv.html("削除が完了しました。"),location.reload(!0)})).fail(((t,e,i)=>{this._showErr(t.responseText),alert(e)}))}_getKjsFromInps(){let t={};for(let e in this.delCnds){let i=this.delCnds[e],a=null;switch(i.inp_type){case"text":a=this._getValueFromTextbox(i);break;case"select":a=this._getValueFromSelect(i)}null!=a&&(t[a.field]=a.value)}return t}_getValueFromTextbox(t){let e=t.field;return{field:e,value:this.inpsDiv.find("."+e).val()}}_getValueFromSelect(t){let e=t.id_field;return{field:e,value:this.inpsDiv.find("."+e).val()}}_escapeForAjax(t){if("string"==typeof t)return-1!=t.indexOf("&")?(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),encodeURIComponent(t)):t;if("object"==typeof t){for(var e in t)t[e]=this._escapeForAjax(t[e]);return t}return t}_ampTo26(t){if("string"==typeof t)return-1!=t.indexOf("&")?t.replace(/&/g,"%26"):t;if("object"==typeof t){for(var e in t)t[e]=this._ampTo26(t[e]);return t}return t}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}class CalendarViewK{create(t,e,i){t=this._shapingDateInData(t,e);var a=this._getBaseMonthStart(t,e);if(null!=a){var r=this._getMonthEndDate(a),s=this._createCalendarDataFormat(a,r),l=this._aggByDateField(t,e);s=this._mappingToCalData(s,l),s=this._weekStructConv(s),null==i&&(i=this._callback);var n=this._buildCalendarViewHtml(s,i,a);jQuery("#calendar_view_k").html(n)}else console.log("カレンダービュー：データ中に日付がありません。")}_callback(t,e){var i="";if(null!=t.ents){var a=t.ents;for(var r in a){var s=a[r],l=e._getNameField(s);i+="<div>"+e._xss_sanitize(s[l])+"</div>"}}return i="<div style='width:120px;height:80px'>"+i+"</div>"}_getNameField(t){if(null==this.name_field)for(var e in this.name_field="id",t)e.indexOf("name")>=0&&(this.name_field=e);return this.name_field}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=_xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_buildCalendarViewHtml(t,e,i){var a=new Date(i),r="<table class='calendar_view_k'><caption>"+(a.getFullYear()+"-"+(a.getMonth()+1))+"</caption><thead><tr>",s=[{code:"sun",wamei:"日"},{code:"mon",wamei:"月"},{code:"tue",wamei:"火"},{code:"wed",wamei:"水"},{code:"thu",wamei:"木"},{code:"fri",wamei:"金"},{code:"sat",wamei:"土"}];for(var l in s){var n=s[l].wamei;r+="<th class='"+("cvk_"+(d=s[l].code))+"'>"+n+"</th>"}for(var l in r+="</tr></thead><tbody>",t){var o=t[l];for(var h in r+="<tr>",o){var d,_=o[h],c=new Date(h),p=c.getDate(),u="cvk_"+(d=s[c.getDay()].code);0==_.cur_month_flg&&(u="cvk_out_this_month"),r+="<td><div class='cvk_cell'><div class='cvk_cell_div1 "+u+"'>"+p+"</div><div class='cvk_cell_div2'> "+d+" </div><div class='cvk_cell_div3'>"+e(_,this)+"</div></div></td>"}r+="</tr>"}return r+="</tbody></table>"}_weekStructConv(t){var e=[],i=0,a=0;for(var r in t){var s=t[r];if(null==e[i]){if(i>=4&&0==s.cur_month_flg)return e;e[i]={}}e[i][r]=s,7==++a&&(i++,a=0)}return e}_mappingToCalData(t,e){for(var i in t)null!=e[i]&&(t[i].ents=e[i]);return t}_createCalendarDataFormat(t,e){var i=new Date(t),a=i.getFullYear(),r=i.getMonth(),s=i.getDay(),l=new Date(t);l.setDate(l.getDate()-s);for(var n=this._convDateToYMD(l),o={},h=new Date(n),d=0;d<42;d++){var _=0;h.getFullYear()==a&&h.getMonth()==r&&(_=1);var c=this._convDateToYMD(h);o[c]={index:d,date:c,cur_month_flg:_},h.setDate(h.getDate()+1)}return o}_shapingDateInData(t,e){for(var i in t){var a=t[i];a[e]=this._shapingDate(a[e])}return t}_getBaseMonthStart(t,e){for(var i in t){var a=t[i];if(null!=a[e]){var r=a[e];return r=this._getMonthStartDate(r)}}return null}_getMonthStartDate(t){return null==t?null:("string"==typeof t&&(t=new Date(t)),t.getFullYear()+"-"+(t.getMonth()+1)+"-1")}_getMonthEndDate(t){if(null==t)return null;"string"==typeof t&&(t=new Date(t));var e=new Date(t.getFullYear(),t.getMonth()+1,0);return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}_aggByDateField(t,e){var i={};for(var a in t){var r=t[a],s=r[e];null!=s&&(null==i[s]&&(i[s]=[]),i[s].push(r))}return i}_shapingDate(t){return null==t?null:("string"==typeof t&&(t=new Date(t)),t=this._convDateToYMD(t))}_convDateToYMD(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}}class CbBtnSizeChanger{constructor(t){this.crudBaseData=t;this.kj_delete_flg=t.kjs.kj_delete_flg,this.kj_delete_flg=1*this.kj_delete_flg,this._empty(this.kj_delete_flg)&&(this.kj_delete_flg=0);var e=(e=location.href).split(/[?#]/)[0];this.ls_key=e+"-CbBtnSizeChanger_1.1.4",this.param=this._setParamIfEmpty({}),this.iniCnfData=this._makeIniCnfData({});var i=this._initCnfData(this.iniCnfData),a=this._createCnfFormHtml(i),r=jQuery(this.param.main_slt);r.html(a),this._setCheckEvent(r,i),this._setVisibleCbClickEvent(r,i),this._setSubEvents(r),1==this.param.save_flg&&(this._changeSizeAll(i),this._changeBtnVisibleAll(i)),this.mainForm=r,this.cnfData=i}_makeIniCnfData(t){var e=this._getDefaultCnfData();return jQuery.extend(e,t),e}_getDefaultCnfData(){var t=[{slt:".row_edit_btn",wamei:"編集ボタン",visible:!0,def_size:"btn-sm",size:"btn-sm"},{slt:".row_copy_btn",wamei:"複製ボタン",visible:!0,def_size:"btn-sm",size:"btn-sm"},{slt:".row_delete_btn",wamei:"削除ボタン",visible:!0,def_size:"btn-sm",size:"btn-sm"},{slt:".row_eliminate_btn",wamei:"抹消ボタン",visible:!0,def_size:"btn-sm",size:"btn-sm"},{slt:".row_exc_btn",wamei:"行入替ボタン(↑↓ボタン)",visible:!0,def_size:"btn-sm",size:"btn-sm"},{slt:".row_enabled_btn",wamei:"有効ボタン",visible:!0,def_size:"btn-sm",size:"btn-sm"}];for(var e in t){var i=t[e];i.code=this._getCodeFromSlt(i.slt)}return t}_setParamIfEmpty(t){return null==t&&(t={}),null==t.main_slt&&(t.main_slt="#CbBtnSizeChanger"),null==t.radioData&&(t.radioData=[{value:"btn-sm",wamei:" 極小",show_flg:!1},{value:"btn-sm",wamei:" 小　",show_flg:!0},{value:"",wamei:" 普通",show_flg:!0},{value:"btn-lg",wamei:" 大　",show_flg:!0}]),null==t.save_flg&&(t.save_flg=1),t}_initCnfData(t){var e=this._loadCnfData();return this._empty(e)&&(e=jQuery.extend(!0,{},t)),e}_getCodeFromSlt(t){var e=t,i=e.charAt(0);return"."!=i&&"#"!=i||(e=e.substr(1)),e}_createCnfFormHtml(t){var e="\n\t\t\t<div style='padding:10px;margin-bottom:10px;background-color:#8dbbf3;border-radius:5px;display:inline-block'>\n\t\t\t<table class='tbl2'><tbody>\n\t\t";for(var i in t){var a=t[i],r=this._createVisibleCbHtml(a,i),s=this._createRadiosHtml(a);e+=`\n\t\t\t<tr>\n\t\t\t\t<td>${a.wamei}</td>\n\t\t\t\t<td>${r}</td>\n\t\t\t\t<td>${s}</td>\n\t\t\t</tr>\n\t\t\t`}return e+="\n\t\t\t\t</tbody></table>\n\t\t\t\t<input id='cbbsc_def_btn' type='button' value='初期に戻す' class='btn btn-secondary btn-sm' >\n\t\t\t\t<input id='cbbsc_close_btn' type='button' value='閉じる' class='btn btn-secondary btn-sm' >\n\t\t\t</div>\n\t\t"}_createVisibleCbHtml(t,e){var i="";return 1==t.visible&&(i="checked"),`<label><input type='checkbox' class='cbsc_visible_cb' data-index='${e}' ${i}> 表示</label>`}_createRadiosHtml(t){var e="",i=this.param.radioData;for(var a in i){var r=i[a];if(0!=r.show_flg){var s="";r.value==t.size&&(s="checked"),e+="<label class='btn btn-primary btn-sm'><input type='radio' name='"+("cbbsc_r_"+t.code)+"' value='"+r.value+"' "+s+" >"+r.wamei+"</label>"}}return e="<div class='btn-group' >"+e+"</div>"}_setCheckEvent(t,e){for(var i in e){var a="cbbsc_r_"+e[i].code;t.find("[name='"+a+"']").click((t=>{this._checkEvent(t)}))}}_checkEvent(t){var e=jQuery(t.target),i=e.attr("name"),a=e.val(),r=this._getCnfEntByName(i);r.size=a,jQuery(r.slt).each(((t,e)=>{this._changeSize(e,a)})),1==this.param.save_flg&&this._saveCnfData()}_getCnfEntByName(t){var e=t.replace("cbbsc_r_","");for(var i in this.cnfData){var a=this.cnfData[i];if(a.code==e)return a}return null}_changeSize(t,e){t=jQuery(t);var i=this.param.radioData;for(var a in i){var r=i[a].value;if(""!=r&&t.hasClass(r)){if(e==r)return;t.removeClass(r)}}""!=e&&t.addClass(e)}_changeSizeAll(t){for(var e in t){var i=t[e];jQuery(i.slt).each(((t,e)=>{this._changeSize(e,i.size)}))}}_setVisibleCbClickEvent(t,e){for(var i in e){e[i];var a=`.cbsc_visible_cb[data-index='${i}']`;t.find(a).click((t=>{var e=jQuery(t.currentTarget);this.visibleCbClickEvent(e)}))}}visibleCbClickEvent(t){var e=t.attr("data-index"),i=t.prop("checked"),a=this.cnfData[e];a.visible=i,this._changeBtnVisible(a),1==this.param.save_flg&&this._saveCnfData()}_changeBtnVisible(t){let e=t.visible,i=t.code,a=this._judgeRowExcCondSort();jQuery(t.slt).each(((t,r)=>{switch(r=jQuery(r),i){case"row_enabled_btn":this._changeBtnForEnabledBtn(r,e);break;case"row_delete_btn":this._changeBtnForDeleteBtn(r,e);break;case"row_eliminate_btn":this._changeBtnForEliminateBtn(r,e);break;case"row_exc_btn":this._changeBtnForRowExc(r,e,a);break;default:this._changeBtnForOther(r,e)}}))}_judgeRowExcCondSort(){let t=this.crudBaseData.main_model_name,e=this.crudBaseData.pages.sort_field;return 1!=this.crudBaseData.pages.sort_desc&&("sort"==e||("sort_no"==e||(e==t+".sort"||e==t+".sort_no")))}_changeBtnForEnabledBtn(t,e){if(0==e)t.hide();else switch(this.kj_delete_flg){case 0:t.hide();break;case-1:case 1:t.show()}}_changeBtnForDeleteBtn(t,e){if(0==e)t.hide();else switch(this.kj_delete_flg){case 0:case-1:t.show();break;case 1:t.hide()}}_changeBtnForEliminateBtn(t,e){if(0==e)t.hide();else switch(this.kj_delete_flg){case 0:case-1:t.hide();break;case 1:t.show()}}_changeBtnForRowExc(t,e,i){if(0==e)t.hide();else switch(this.kj_delete_flg){case 0:1==i?t.show():t.hide();break;case-1:case 1:t.hide()}}_changeBtnForOther(t,e){1==e?t.show():t.hide()}_changeBtnVisibleAll(t){for(var e in t){var i=t[e];this._changeBtnVisible(i)}}_setSubEvents(t){t.find("#cbbsc_def_btn").click((t=>{this.clearReset()})),t.find("#cbbsc_close_btn").click((t=>{this.mainForm.hide()}))}clearReset(){this.cnfData=jQuery.extend(!0,{},this.iniCnfData);var t=this.cnfData;this._changeSizeAll(t),this._changeBtnVisibleAll(t),this._setCnfDataToRadios(t),this._setCnfDataToVisibleCb(t),this._saveCnfData()}_setCnfDataToRadios(t){for(var e in t){var i=t[e],a="cbbsc_r_"+i.code,r=this.mainForm.find("[name='"+a+"'][value='"+i.size+"']");r[0]&&r.prop("checked",!0)}}_setCnfDataToVisibleCb(t){for(var e in t){var i=t[e],a=`.cbsc_visible_cb[data-index='${e}']`,r=this.mainForm.find(a);i.visible?r.prop("checked",!0):r.prop("checked",!1)}}_loadCnfData(){var t={},e=localStorage.getItem(this.ls_key);if(!this._empty(e))t=JSON.parse(e);return t}_saveCnfData(){var t=JSON.stringify(this.cnfData);localStorage.setItem(this.ls_key,t)}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}setCnfData(t){for(var e in this.iniCnfData=this._makeIniCnfData(t),this.iniCnfData){var i=this.iniCnfData[e];i.code=this._getCodeFromSlt(i.slt)}var a=this._loadCnfData();this._empty(a)&&this.clearReset()}}class CbFileUploadComponent{constructor(t,e,i){this.fileUploadK=this._factoryFileUploadK(t,e,i),this.fuIds=t,this.fields=this._fueIdsToFields(t),this.none_img_fp="img/icon/none.gif"}_fueIdsToFields(t){var e=[];for(var i in t){var a=t[i],r=this._fudIdToField(a);e.push(r)}return e=this._array_unique(e)}_fudIdToField(t){var e=t;if(null==t)return e;if(t.length<3)return e;var i=e.slice(-2);if("_n"==i||"_e"==i)e=e.substr(0,e.length-2);return e}_array_unique(t){return t.filter((function(t,e,i){return i.indexOf(t)===e}))}_factoryFileUploadK(t,e,i){null==e.prog_slt&&(e.prog_slt="#prog1"),null==e.err_slt&&(e.err_slt="#err"),null==e.valid_ext&&(e.valid_ext="often_use"),null==e.max_size&&(e.max_size=5e6),null==e.img_width&&(e.img_width=120),null==e.img_height&&(e.img_height=120);var a=new FileUploadK(e);for(var r in t){var s=t[r];a.addEvent(s,i)}return a}addEvent(t,e){return this.fileUploadK.addEvent(t,e)}getFileParams(){return this.fileUploadK.getFileParams()}uploadByAjax(t,e,i){return this.fileUploadK.uploadByAjax(t,e,i)}getFileNames(t){return this.fileUploadK.getFileNames(t)}setFilePaths(t,e,i){return this.fileUploadK.setFilePaths(t,e,i)}setImageToTr(t,e){for(var i in this.fields){var a=this.fields[i],r=t.find("[for='"+a+"']");if(r[0]){var s=r.find("img");if(s[0]){var l=e[a];if(null==l||""==l)return s.attr("src",this.none_img_fp),void((n=r.find("a"))[0]&&n.attr("href",this.none_img_fp));var n,o=l,h=l.replace("/orig/","/thum/"),d=new Image;d.src=h,d.onload=()=>{s.attr("src",h)},(n=r.find("a"))[0]&&n.attr("href",o)}}}}setFilesToFd(t,e){var i=this.fileUploadK.box;for(var a in i){var r=this._getFieldInfoFromFuKey(a);if(r.form_type==e){var s=i[a].files;if(null!=s&&null!=s[0]){var l=i[a].fileData;if(null!=l[0])0==l[0].err_flg&&t.append(r.field,s[0])}}}return t}_getFieldInfoFromFuKey(t){var e={fu_id:t,field:t,form_type:"none"};if(null==t||""==t)return e;if(t.length<3)return e;var i=t.slice(-2);if("_n"==i)e.form_type="new_inp",e.field=t.substr(0,t.length-2);else{if("_e"!=i)return e;e.form_type="edit",e.field=t.substr(0,t.length-2)}return e}}
/**
 * Google翻訳API・キャッシュ機能拡張
 * 
 * @note
 * Google Transrate APIのキャッシュ機能付き拡張クラス
 * 
 * @date 2019-1-27 | 2019-2-2
 * @version 1.0.2
 * @licens MIT
 */class CbGtaCash{constructor(t){t=this._setParamIfEmpty(t),this.param=t,this.jaTextList={}}init(t,e,i){i&&jQuery.extend(this.param,i),i=this.param,this.xids=e,this.page_code=t;var a=this._getLangData();this.langData=a;var r=this._createSelectOptionHtml(a),s=jQuery(i.slt);s.html(r),s.change((t=>{var e=jQuery(t.currentTarget),i=e.val();""!=i&&(this.cashTransExe(this,i),this.param.changed_select_callback&&this.param.changed_select_callback(e))}))}cashTransExe(t,e){var i=[];for(var a in t.xids){var r=t.xids[a];if(null==r||""==r)return;if(r=t._setSharp(r),null==t.jaTextList[r]){if(null==jQuery(r)[0])continue;t.jaTextList[r]=jQuery(r).html()}var s={lang:e,xid:r,ja_text:t.jaTextList[r]};i.push(s)}t._cashTransExeAjax(t.page_code,e,i)}_cashTransExeAjax(t,e,i){for(var a in i){var r=i[a];r.ja_text=r.ja_text.replace(/&/g,"%26")}var s={action_code:"get_cash",page_code:t,lang:e,data:i},l=JSON.stringify(s),n=this.param.ajax_url;jQuery.ajax({type:"POST",url:n,data:"key1="+l,cache:!1,dataType:"text"}).done(((t,e)=>{var i;try{i=jQuery.parseJSON(t)}catch(e){return void jQuery("#err").append(t)}this._cashTrans(i)})).fail(((t,e,i)=>{jQuery("#err").append("アクセスエラー"),jQuery("#err").append(t.responseText)}))}_cashTrans(t){for(var e in jQuery(".cb_gta_cash_btn").hide(),t){var i=t[e];1==i.t_cash_flg?jQuery(i.xid).html(i.trans_text):this._createCbGtaCashBtn(i)}}_createCbGtaCashBtn(t){var e=this._getLangName(t.lang),i=jQuery(t.xid),a=i.find(".cb_gta_cash_btn");if(a[0])return a.val(e),a.attr("data-lang",t.lang),void a.show();var r=`<input type="button" value="${e}" \n\t\t\tclass="cb_gta_cash_btn btn btn-success btn-sm" data-xid="${t.xid}" data-lang="${t.lang}"/>`,s=i.find(".cb_gta_cash_wb");s[0]?s.html(r):(r="<div class='cb_gta_cash_wb'>"+r+"</div>",i.prepend(r)),(a=i.find(`[data-xid='${t.xid}']`)).click((t=>{var e=jQuery(t.currentTarget);this.apiTranseAction(e)}))}apiTranseAction(t){jQuery(".cb_gta_cash_btn").prop("disabled",!0);var e=t.attr("data-xid"),i=t.attr("data-lang"),a=this.jaTextList[e];a=a.replace(/&/g,"%26");var r={action_code:"api_transe",page_code:this.page_code,lang:i,xid:e,ja_text:a},s=JSON.stringify(r),l=this.param.ajax_url;jQuery.ajax({type:"POST",url:l,data:"key1="+s,cache:!1,dataType:"text"}).done(((t,e)=>{var i;try{i=jQuery.parseJSON(t)}catch(e){return void jQuery("#err").append(t)}jQuery(i.xid).html(i.trans_text),setTimeout((function(){jQuery(".cb_gta_cash_btn").prop("disabled",!1)}),3e3)})).fail(((t,e,i)=>{jQuery("#err").append("アクセスエラー"),jQuery("#err").append(t.responseText)}))}_getLangName(t){var e="none",i=this.langData;for(var a in i){var r=i[a];if(r["iso639-1"]==t){e=r.lang_name;break}}return e}_setSharp(t){return"#"!=t.charAt(0)&&(t="#"+t),t}_createSelectOptionHtml(t){var e="<option value='' > -- Language -- </option>";for(var i in t){var a=t[i],r=a.wamei+"  "+a.lang_name;e+="<option value='"+a["iso639-1"]+"' >"+r+"</option>"}return e}_setParamIfEmpty(t){if(null==t.slt&&(t.slt="#cb_gta_cash"),null==t.ajax_url)throw new Error("Empty ajax_url !");return t}_getLangData(){var t=[{lang_nation:"インド・ヨーロッパ語族",wamei:"英語",lang_name:"English","iso639-1":"en","iso639-2T":"eng","iso639-2B":"eng","iso639-3":"eng","iso639-6":"engs",note:"",google_api:!0}],e=[];for(var i in t){var a=t[i];1==a.google_api&&e.push(a)}return e}}
/**
 * 列表示切替クラス 
 * 
 * 初期化(init)を実行すると、対象HTMLテーブルの列から、列表示切替チェックボックスを自動生成します。
 * 列表示切替チェックボックスにチェックを入れると列の表示を切り替えられます。
 * 
 * ◇主なメソッド
 * - init 初期化
 * - refresh 一覧テーブルをリフレッシュする
 * 
 * @version 1.6.1
 * @date 2014-4-1 │ 2020-6-16
 * @license MIT
 * @author k-uehara 
 */var ClmShowHide=function(){var t=this;function e(e,i,a){var r=jQuery("#"+t.props.chBoxsId);for(var s in t.defClmData){var l=t.defClmData[s].show_flg,n=r.find("[index="+s+"]");n[0]&&(1==l?(n.prop("checked",!0),t.clm_show_csh(e,s)):0==l&&(n.prop("checked",!1),t.clm_hide_csh(e,s)))}localStorage.removeItem(a+"_clmData")}function i(){var e=jQuery("#"+t.props.chBoxsId),i=t.actClmData;for(var a in i){var r=e.find("[index="+a+"]");if(r[0]){var s=r.prop("checked");i[a].show_flg=1==s?1:0}}return i}this.props={},this.defClmData={},this.actClmData={},this.init=function(a,r,s,l){this.props.tblId=a,this.props.chBoxsId=r,this.props.unique=l,null==l&&(l=a);for(var n=[],o=0;o<s.length;o++){var h={clm_name:null,show_flg:s[o]};n[o]=h}o=0;$.each(jQuery("#"+a+" thead tr th"),(function(){var t=jQuery(this).html();try{n[o].clm_name=t}catch(t){return}o++}));var d=localStorage.getItem(l+"_clmData"),_={};for(var o in _=""==d||null==d?$.extend(!0,{},n):JSON.parse(d),this.defClmData=n,this.actClmData=_,_=function(t){for(let e in t){let i=t[e],a=i.clm_name;null==a&&(a=""),i.clm_name=a.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,"")}return t}(_),function(t,e,i){var a=jQuery("#"+e);for(var r in a.empty(),i){var s=i[r];if(-1==s.show_flg)continue;var l="";1==s.show_flg&&(l="checked");let t="csh_cb"+r;var n="<div class='csh_cb_div'><input id='"+t+"' type='checkbox' class='csh_cb' "+l+" index='"+r+"' /><label for='"+t+"'>"+s.clm_name+"</label></div>";a.append(n)}a.append("<div style='clear:both'></div>");var o="<div class='csh_func_btn'><input type='button' value='列表示を保存' id='"+t+"_save_btn' class='btn btn-primary btn-sm' /></div>";a.append(o);var h="<div class='csh_func_btn'><input type='button' value='すべてチェック' id='"+t+"_all_checked_btn' class='btn btn-primary btn-sm' /></div>";a.append(h);var d="<div class='csh_func_btn'><input type='button' value='すべてはずす' id='"+t+"_all_uncheck_btn' class='btn btn-primary btn-sm' /></div>";a.append(d);var _="<div class='csh_func_btn'><input type='button' value='初期に戻す' id='"+t+"_default_btn' class='btn btn-primary btn-sm' /></div>";a.append(_),a.append("<div id='csh_msg' class='csh_func_btn' style='display:none;color:#de5246'>列の表示状態を記憶しました。</div>")}(a,r,_),jQuery(".csh_cb").click((function(e){var i=jQuery(this).prop("checked"),r=jQuery(this).attr("index");1==i?t.clm_show_csh(a,r):t.clm_hide_csh(a,r)})),_){0==(h=_[o]).show_flg&&this.clm_hide_csh(a,o)}jQuery("#"+a+"_save_btn").click((function(t){!function(t,e,a){var r=i(),s=JSON.stringify(r);localStorage.setItem(a+"_clmData",s),jQuery("#csh_msg").show(),jQuery("#csh_msg").fadeOut(3e3)}(0,0,l)})),jQuery("#"+a+"_all_checked_btn").click((function(e){!function(e,i,a){var r=jQuery("#"+t.props.chBoxsId);for(var s in a){var l=r.find("[index="+s+"]");if(l[0])0==l.prop("checked")&&(l.prop("checked",!0),t.clm_show_csh(e,s))}}(a,0,t.actClmData)})),jQuery("#"+a+"_all_uncheck_btn").click((function(e){!function(e,i,a){var r=jQuery("#"+t.props.chBoxsId);for(var s in a){var l=r.find("[index="+s+"]");if(l[0])1==l.prop("checked")&&(l.prop("checked",!1),t.clm_hide_csh(e,s))}}(a,0,t.actClmData)})),jQuery("#"+a+"_default_btn").click((function(t){e(a,r,l)}))},this.getCshAry=function(){var e=jQuery("#"+t.props.chBoxsId),i=[];for(var a in this.defClmData){var r=e.find("[index="+a+"]");if(r[0])1==r.prop("checked")?i.push(1):i.push(0)}return i},this.reset=function(){e(this.props.tblId,this.props.chBoxsId,this.props.unique)},this.refresh=function(){var t=this.props.tblId;for(var e in this.defClmData)this.clm_show_csh(t,e);var a=i();for(var e in a){var r=a[e].show_flg;1==r?this.clm_show_csh(t,e):0==r&&this.clm_hide_csh(t,e)}},this.clm_show_csh=function(t,e){jQuery("#"+t+" thead tr th").eq(e).show(),$.each(jQuery("#"+t+" tbody tr"),(function(){jQuery(this).children().eq(e).show()}))},this.clm_hide_csh=function(t,e){jQuery("#"+t+" thead tr th").eq(e).hide(),$.each(jQuery("#"+t+" tbody tr"),(function(){jQuery(this).children().eq(e).hide()}))}};
/**
 *  CRUD基本クラス | CrudBase.js
 * 
 * @note
 * CRUDのベース。
 * デフォルトでは、削除、編集、新規追加するたびにAjax通信を行う仕様である。
 * 削除、編集、新規追加するたびに更新するのが重い場合、適用ボタンで一括適用するモードも備える。
 * 
 * 
 * @license MIT
 * @since 2016-9-21 | 2022-2-25
 * @version 3.3.1
 * @histroy
 * 2019-6-28 v2.8.3 CSVフィールドデータ補助クラス | CsvFieldDataSupport.js
 * 2018-10-21 v2.8.0 ボタンサイズ変更機能にボタン表示切替機能を追加
 * 2018-10-21 v2.6.0 フォームをアコーディオン形式にする。
 * 2018-10-2 v2.5.0 フォームドラッグとリサイズ
 * 2018-9-18 v2.4.4 フォームフィット機能を追加
 * v2.0 CrudBase.jsに名称変更、およびES6に対応（IE11は非対応）
 * v1.7 WordPressに対応
 * 2016-9-21 v1.0.0
 * 
 */class CrudBase{constructor(t){this.param=this._setParamIfEmpty(t),this.crudBaseData=t,this.formInfo=this._initFormInfo(this.param),this.fieldData=this._addMoreFieldData(this.param.tbl_slt,this.fieldData),this.fieldData=this._setFieldDataFromForm(this.fieldData,this.formInfo,"new_inp"),this.fieldData=this._setFieldDataFromForm(this.fieldData,this.formInfo,"edit"),this.fieldData=this._setFieldDataFromForm(this.fieldData,this.formInfo,"delete");var e=this.getForm("edit"),i=this.getForm("new_inp");this.fieldHashTable=this._createFieldHashTable(this.fieldData),this.defNiEnt=this._getEntByForm("new_inp"),this.tbl=jQuery("#"+this.param.tbl_slt),this.rowExchange=this._factoryCrudBaseRowExchange(),this.crudBaseConfig=this._factoryCrudBaseConfig(this.param),this.cbBtnSizeChanger=this.crudBaseConfig.cbBtnSizeChanger,this.autoSave=this._factoryCrudBaseAutoSave(),this.csh=this._factoryClmShowHide(),this.cbFileUploadComp=this._factoryCbFileUploadComponent(),this.datepickerWrap=this._factoryDatepickerWrap(),this.calendarViewK=this._factoryCalendarViewK(),this.crudBaseReact=this._factoryCrudBaseReact(),this.crudBaseBulkAdd=new CrudBaseBulkAdd(this.fieldData),this.crudBasePasswordEdit=new CrudBasePasswordEdit(i,e),this.cbGtaCash=new CbGtaCash({slt:"#cb_gta_cash",ajax_url:"cb_gta_cash"}),this.csvFieldDataSupport=new CsvFieldDataSupport,(new PagenationJump).init(),(new PagenationJump).init({xid:"pagenation_jump_b"}),(new RangeYmEx).init(),this.crudBaseOuterName=new CrudBaseOuterName,this.crudBaseTaAutoHeightSize=new CrudBaseTaAutoHeightSize,this.crudBaseTaAutoHeightSize.init(),this.fueIdCash,this.foldingTaE=new FoldingTa,this.foldingTaE.init({form_slt:"#ajax_crud_edit_form"}),this.foldingTaN=new FoldingTa,this.foldingTaN.init({form_slt:"#ajax_crud_new_inp_form"}),"sp"==this.param.device_type&&this.tableTransform(1),this._formDragAndResizeSetting(),this._errByErrTypes(),this.actEditForm,this.activeTr,this.hiddensElm,this.formKjsElm,this._iniRtnSetUrl(),this._addEventForKjsEnter(),this.pwms=new ProcessWithMultiSelection({tbl_slt:this.param.tbl_slt,ajax_url:this.param.pwms_ajax_url,csrf_token:this.param.csrf_token})}getCrudBaseData(){return this.param}newVersionReload(){0!=this.param.new_version_flg&&(this._clear(),location.reload(!0))}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.csrf_token){let e=jQuery("#csrf_token").val();if(null==e)throw new Error("csrf_token is empty!");t.csrf_token=e}return null==t.src_code&&(t.src_code=t.model_name_s),null==t.src_code_c&&(t.src_code_c=this._snakeToCamel(t.src_code)),null==t.tbl_slt&&(t.tbl_slt=t.src_code+"_tbl"),null==t.edit_form_slt&&(t.edit_form_slt="ajax_crud_edit_form"),null==t.new_form_slt&&(t.new_form_slt="ajax_crud_new_inp_form"),null==t.delete_form_slt&&(t.delete_form_slt="ajax_crud_delete_form"),null==t.eliminate_form_slt&&(t.eliminate_form_slt="ajax_crud_eliminate_form"),null==t.contents_slt&&(t.contents_slt=null),null==t.edit_reg_url&&(t.edit_reg_url=t.src_code+"/ajax_reg"),null==t.new_reg_url&&(t.new_reg_url=t.src_code+"/ajax_reg"),null==t.delete_reg_url&&(t.delete_reg_url=t.src_code+"/ajax_delete"),null==t.auto_save_url&&(t.auto_save_url=t.src_code+"/auto_save"),null==t.file_uploads&&(t.file_uploads=null),null==t.form_width&&(t.form_width=null),null==t.form_height&&(t.form_height=null),null==t.form_position&&(t.form_position="auto"),null==t.form_z_index&&(t.form_z_index=9),null==t.valid_msg_slt&&(t.valid_msg_slt=".err"),null==t.auto_close_flg&&(t.auto_close_flg=0),null==t.ni_tr_place&&(t.ni_tr_place=0),null==t.disFilData&&(t.disFilData=null),null==t.kjs&&(t.kjs=null),null==t.device_type&&(t.device_type=this.judgDeviceType()),null==t.drag_and_resize_flg&&(t.drag_and_resize_flg=1),null==t.form_mode&&(t.form_mode=1),null==t.midway_dp&&(t.midway_dp=""),null==t.configData&&(t.configData={}),null==t.pwms_ajax_url&&(t.pwms_ajax_url=t.main_model_name_s+"/ajax_pwms"),null==t.fukParam&&(t.fukParam={}),null==t.fukAddEventOption&&(t.fukAddEventOption={}),t}_factoryCrudBaseConfig(t){let e=new CrudBaseConfig;return e.init(null,t),e}_factoryCrudBaseAutoSave(){var t=typeof CrudBaseAutoSave;return null==t||"undefined"==t?{saveRequest:function(){}}:new CrudBaseAutoSave(this)}_factoryCrudBaseRowExchange(){let t,e=typeof CrudBaseRowExchange;if(null==e||"undefined"==e)return t={showForm:function(){}},t;t=new CrudBaseRowExchange(this,null,(()=>{this.rowExchangeAfter()}));let i=this.param.row_exc_flg;return this.rowExcBtnShow(i),t}_factoryClmShowHide(){let t,e=typeof ClmShowHide;if(null==e||"undefined"==e)return t={},t;t=new ClmShowHide;let i=this.param.csh_ary,a="rkt_"+this.param.src_code+"_index";return t.init(this.param.tbl_slt,"clm_cbs",i,a),t}_factoryCbFileUploadComponent(){var t=typeof CbFileUploadComponent;if(null==t||"undefined"==t)return{addEvent:function(){},getFileParams:function(){},uploadByAjax:function(){},getFileNames:function(){},setFilePaths:function(){}};var e=this._getFueIds("new_inp"),i=this._getFueIds("edit"),a=e.concat(i),r=this.param.fukParam,s=this.param.fukAddEventOption;return s.pacb=this._fukPrevAfterCallback,s.pacb_param={self:this},new CbFileUploadComponent(a,r,s)}_factoryDatepickerWrap(){var t=typeof DatepickerWrap;return null==t||"undefined"==t?{tukishomatu:function(){}}:new DatepickerWrap(this)}_factoryCalendarViewK(){var t=typeof CalendarViewK;return null==t||"undefined"==t?{create:function(){}}:new CalendarViewK}_factoryCrudBaseReact(){var t=typeof CrudBaseReact;return null==t||"undefined"==t?{init:function(){},reactivatingOfRow:function(){}}:new CrudBaseReact}_getFueIds(t,e){if(null==e&&(e={}),null==e.cash_flg&&(e.cash_flg=1),1==e.cash_flg&&this.fueIdCash&&null!=this.fueIdCash[t])return this.fueIdCash[t];var i=[];for(var a in this.fieldData){var r=this.fieldData[a],s="inp_"+t;if(null!=r[s]){var l=r[s];if(null!=l.type_name&&"file"==l.type_name&&null!=l.elm){var n=l.elm.attr("id");i.push(n)}}}return null==this.fueIdCash&&(this.fueIdCash={}),this.fueIdCash[t]=i,i}newInpShow(t,e){null==e&&(e={});let i=0;void 0!==e.form_mode?i=e.form_mode:void 0!==this.param.form_mode&&(i=this.param.form_mode),"add_to_top"==e.ni_tr_place?this.param.ni_tr_place=1:"add_to_bottom"==e.ni_tr_place&&(this.param.ni_tr_place=0),this.formInfo.new_inp.show_flg=1,this.setFieldsToForm("new_inp",this.defNiEnt);var a=this.getForm("new_inp");if(this.setValueToFrom(a,"form_type","new_inp"),this._clearValidErr(a),e.callBack){var r={form:a};e.callBack(r)}if(2==i)this.tbl.hide(),a.show();else if(1==i){var s=(a=this._setColspanToForm(a)).find("td");if("sp"==this.param.device_type)s.attr("colspan",1),s.css("display","block"),a.css("display","block");else{var l=this._getClmCntByActive();s.attr("colspan",l),s.css("display","table-cell"),a.css("display","table-row")}if("add_to_top"==e.ni_tr_place){var n=this.tbl.find("tbody tr").eq(0);a.insertBefore(n)}else if("add_to_bottom"==e.ni_tr_place){var o=this.tbl.find("tbody tr").eq(-1);a.insertAfter(o)}else s.css("display","block"),a.css("display","block"),a.insertAfter("#new_inp_form_point")}else this._showForm(a,t,e);this.crudBasePasswordEdit.showForm("new_inp"),this.foldingTaN.reflection(),this.crudBaseOuterName.newInpShow(),this.crudBaseTaAutoHeightSize.newInpShow(a)}editShow(t,e){null==e&&(e={});let i=0;void 0!==e.form_mode?i=e.form_mode:void 0!==this.param.form_mode&&(i=this.param.form_mode);let a=jQuery(t).parents("tr");this.activeTr=a,this.formInfo.edit.show_flg=1;let r=this.getEntityByTr(a);e.callbackAfterGetEnt&&(r=e.callbackAfterGetEnt(r)),this.setFieldsToForm("edit",r,e);let s=this.getForm("edit");s.show(),this._clearValidErr(s),e.callBack&&e.callBack(a,s,r),2==i?this.tbl.hide():1==i?(s=this._setColspanToForm(s),s.insertAfter(a)):this._showForm(s,t,e),this.crudBasePasswordEdit.showForm("edit"),this.foldingTaE.reflection(),this.crudBaseOuterName.editShow(r),this.crudBaseTaAutoHeightSize.editShow(s)}copyShow(t,e){null==e&&(e={});let i=0;void 0!==e.form_mode?i=e.form_mode:void 0!==this.param.form_mode&&(i=this.param.form_mode);var a=jQuery(t).parents("tr");this.activeTr=a,this.formInfo.new_inp.show_flg=1;var r=this.getEntityByTr(a),s=this.getForm("copy");this.setValueToFrom(s,"form_type","copy");var l=a.index();if(this.setValueToFrom(s,"row_index",l),this.setFieldsToForm("new_inp",r,e),this._clearValidErr(s),e.callBack&&e.callBack(a,s,r),2==i)this.tbl.hide(),s.show();else if(1==i){var n=(s=this._setColspanToForm(s)).find("td");if("sp"==this.param.device_type)n.attr("colspan",1),n.css("display","block"),s.css("display","block");else{var o=this._getClmCntByActive();n.attr("colspan",o),n.css("display","table-cell"),s.css("display","table-row")}s.insertAfter(a)}else this._showForm(s,t,e);this.crudBasePasswordEdit.showForm("copy"),this.crudBaseOuterName.newInpShow(r),this.crudBaseTaAutoHeightSize.copyShow(s)}deleteAction(t,e){if(1!=this.crudBaseConfig.data.delete_alert_flg||window.confirm("削除しますがよろしいですか？")){t instanceof jQuery||(t=jQuery(t)),null==e&&(e={}),null==e.form_show_flg&&(e.form_show_flg=0);var i=t.parents("tr");this.activeTr=i,1==e.form_show_flg?(e.tr=i,this.deleteShow(t,e)):(e.caller_type=1,this.deleteReg(e))}}enabledAction(t,e){t instanceof jQuery||(t=jQuery(t)),null==e&&(e={});var i=t.parents("tr");this.activeTr=i,this.enabledReg(e)}eliminateShow(t,e,i){t instanceof jQuery||(t=jQuery(t));var a=t.parents("tr");this.activeTr=a;var r=this.formInfo.eliminate;r.show_flg=1;var s=this.getEntityByTr(a),l=jQuery(r.slt);this.setFieldsToForm("eliminate",s,e),i&&i(a,l,s),this._showForm(l,t,e)}newInpReg(t,e,i){var a=this.getForm("new_inp");if(0==this._validationCheckForm("new_inp"))return;this._empty(i)&&(i={}),this._toggleRegBtn("new_inp",0);var r=new FormData;r=this.cbFileUploadComp.setFilesToFd(r,"new_inp");var s=this._getEntByForm("new_inp"),l=!1;if(this._empty(s.id)||(l=!0),t){var n=t(s,r);if(n.err)return void this._errShow(n.err,"new_inp");n.ent?(s=n.ent,r=n.fd):s=n}var o=JSON.stringify(s);r.append("key1",o);var h={};let d=this.param.csrf_token;r.append("_token",d),i.wp_action&&(h.action=i.wp_action,i.wp_nonce&&(h.nonce=i.wp_nonce));var _=this.getValueFromForm(a,"form_type");h.form_type=_,h.ni_tr_place=this.param.ni_tr_place;var c=JSON.stringify(h);r.append("reg_param_json",c);var p=this._decAddRowIndex(a,_,i);jQuery.ajax({type:"post",url:this.param.new_reg_url,data:r,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,i,a)=>{var r;419==a.status&&location.reload(!0),this._toggleRegBtn("new_inp",1);try{r=jQuery.parseJSON(t)}catch(e){return alert("エラー"),void jQuery("#err").html(t)}if("logout"==r.err_msg&&location.reload(!0),r.err)this._showErrToForm(r.err,"new_inp");else{1==l&&location.reload(!0),this.closeForm("new_inp");var s=this._addTr(r,p);this._setOuterNameToTr(r,s),this._switchBtnsDisplay(s,r),null!=e&&e(r,s)}})).fail(((t,e,i)=>{419==t.status&&location.reload(!0),this._toggleRegBtn("new_inp",1),jQuery("#err").html(t.responseText),alert(e)}))}editReg(t,e,i){if(0==this._validationCheckForm("edit"))return;this._empty(i)&&(i={}),this._toggleRegBtn("edit",0);var a=this._getEntByForm("edit"),r=new FormData;if(r=this.cbFileUploadComp.setFilesToFd(r,"edit"),t){var s=t(a,r);if(s.err)return void this._errShow(s.err,"edit");s.ent?(a=s.ent,r=s.fd):a=s}var l={},n=JSON.stringify(a);r.append("key1",n);let o=this.param.csrf_token;r.append("_token",o),i.wp_action&&(l.action=i.wp_action,i.wp_nonce&&(l.nonce=i.wp_nonce)),l.form_type="edit";var h=JSON.stringify(l);r.append("reg_param_json",h),jQuery.ajax({type:"post",url:this.param.edit_reg_url,data:r,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,i,a)=>{419==a.status&&location.reload(!0),this._toggleRegBtn("edit",1);var r=null;try{r=jQuery.parseJSON(t)}catch(e){alert("エラー:"+t),console.log(t),jQuery("#err").html(t)}if("logout"==r.err_msg&&location.reload(!0),r){if(r.err)return void this._showErrToForm(r.err,"edit");var s=this._getTrInEditing();0==this.param.kj_delete_flg&&1==r.delete_flg&&s.hide(),r.id!=s.find(".id").text()&&location.reload(!0),this._setEntityToEditTr(r,s),this._setOuterNameToTr(r,s),this._offNoteDetail(s),null!=e&&e(r,s),1!=this._getKjs().kj_delete_flg&&1==r.delete_flg?s.css("background-color","#808080"):s.css("background-color","#d7e6fd"),this.closeForm("edit")}})).fail(((t,e,i)=>{419==t.status&&location.reload(!0),this._toggleRegBtn("edit",1),jQuery("#err").html(t.responseText),alert(e)}))}_offNoteDetail(t){t.find(".note_detail").each(((t,e)=>{let i=(e=jQuery(e)).parent("td");e.hide();let a=e.attr("data-field");i.find("."+a).show(),i.find(".note_detail_open_btn").hide()}))}deleteRegByRowIndex(t,e){var i=this.getEntity(t);this._deleteRegBase(i,1,e)}eliminateReg(t){null==t&&(t={});var e=this._getEntByForm("eliminate");t.eliminate_flg=1;this._deleteRegBase(e,1,t)}closeForm(t){var e=this.formInfo[t].form;jQuery("#crud_base_forms").append(e),e.hide(),this.tbl.show()}rowExchangeShowForm(t){this.rowExchange.showForm(t)}rowExcBtnShow(t){1==t?jQuery(".row_exc_btn").show():jQuery(".row_exc_btn").hide()}resetKjs(t){null==t&&(t=[]);let e=this.param.defKjs;for(let i in e)t.indexOf(i)<0&&jQuery("#"+i).val(e[i]);this.cbGadgetKj&&this.cbGadgetKj.reset(),this.crudBaseOuterName.clear()}getContainer(){return{param:this.param,fieldData:this.fieldData,fieldHashTable:this.fieldHashTable,formInfo:this.formInfo,defNiEnt:this.defNiEnt,formNewInp:this.formNewInp,formEdit:this.formEdit,formDelete:this.formDelete,showFormStrategy:this.showFormStrategy,react:this.react}}getTblRowCount(){return jQuery("#"+this.param.tbl_slt).children("tbody").children("tr").length}_decAddRowIndex(t,e,i){if(null!=i.add_row_index)return i.add_row_index;var a=-1;return 1==this.param.ni_tr_place&&(a=0),"copy"==e&&(a=this.getValueFromForm(t,"row_index"),a*=1,a++),a}deleteShow(t,e){t instanceof jQuery||(t=jQuery(t));var i=e.tr;null==i&&(i=jQuery(t).parents("tr"));var a=this.formInfo.delete;a.show_flg=1;var r=this.getEntityByTr(i),s=jQuery(a.slt);this.setFieldsToForm("delete",r,e);var l=e.cbBeforeFormShow;l&&l(i,s,r),this._showForm(s,t,e)}deleteReg(t){var e;null==t&&(t={}),null==t.caller_type&&(t.caller_type=0),e=0==t.caller_type?this._getEntByForm("delete"):this.getEntity();this._deleteRegBase(e,1,t)}enabledReg(t){null==t&&(t={});var e=this.getEntity();this._deleteRegBase(e,0,t)}_deleteRegBase(t,e,i){if(null==i&&(i={}),!t.id)throw new Error("Not id");var a=0;i.eliminate_flg&&(a=i.eliminate_flg);var r="delete";a&&(r="eliminate"),t.delete_flg=e,null==i&&(i={});var s=new FormData,l={};l.form_type=r,i.wp_action&&(l.action=i.wp_action,i.wp_nonce&&(l.nonce=i.wp_nonce)),a&&(l.eliminate_flg=a);var n=JSON.stringify(l);s.append("reg_param_json",n);var o=i.cbBeforeReg;if(o){var h=o(t,s);if(h.err)return void this._errShow(h.err,r);h.ent?(t=h.ent,s=h.fd):t=h}var d=JSON.stringify(t);s.append("key1",d);let _=this.param.csrf_token;s.append("_token",_),jQuery.ajax({type:"post",url:this.param.delete_reg_url,data:s,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,e,s)=>{var l;419==s.status&&location.reload(!0);try{l=jQuery.parseJSON(t)}catch(e){alert("エラー"),jQuery("#err").html(t)}if("logout"==l.err_msg&&location.reload(!0),l){if(0===this.param.kjs.kj_delete_flg||"0"===this.param.kjs.kj_delete_flg||1==a)this.activeTr.remove();else{var n=this._getTrInEditing();this._setEntityToEditTr(l,n)}var o=i.cbAfterReg;o&&window.setTimeout((()=>{o(l)}),1),this.closeForm(r)}})).fail(((t,e,i)=>{419==t.status&&location.reload(!0),jQuery("#err").html(t.responseText),alert(e)}))}getTr(t){if(null==t)return this.activeTr;var e="#"+this.param.tbl_slt+" tbody tr";return jQuery(e).eq(t)}getLastTr(){var t="#"+this.param.tbl_slt+" tbody tr";return jQuery(t).eq(-1)}_getTrInEditing(){return this.activeTr}getTd(t,e){var i=this.getTr(t).find("."+e);return i[0]?i.parents("td"):null}getTdInEditing(t){var e=this._getTrInEditing().find("."+t);return e[0]?e.parents("td"):null}getEntity(t){var e=this.getTr(t);return this.getEntityByTr(e)}getEntityByTr(t){var e={};for(var i in this.fieldData){var a=this.fieldData[i].field,r=t.find("[name='"+a+"']");e[a]=r.val()}return e}getEntityByInnerElm(t){var e=jQuery(t).parents("tr").index();return this.getEntity(e)}getDataFromTbl(t){null==t&&(t=this.tbl),t instanceof jQuery||(t=jQuery(t));var e=t.find("tbody tr"),i=[];return e.each(((t,e)=>{var a=jQuery(e),r=this.getEntityByTr(a);i.push(r)})),i}getDataFromTblByFields(t){var e="#"+this.param.tbl_slt+" tbody tr",i=[];return jQuery(e).each(((e,a)=>{var r=jQuery(a),s={};for(var e in t){var l=t[e];a=r.find("."+l);s[l]=this._getValueEx(a)}i.push(s)})),i}_getValueEx(t){var e=t.prop("tagName");return"INPUT"==e||"SELECT"==e||"TEXTAREA"==e?t.val():t.html()}getValueFromForm(t,e){var i=this._formFind(t,e),a=null;return i[0]&&(a=this._getValueEx(i)),a}setValueToFrom(t,e,i){var a=this._formFind(t,e);a[0]&&this._setValueEx(a,i)}_showErrToForm(t,e){var i=t;Array.isArray(i)&&(i=i.join("<br>"));var a=this.formInfo[e];jQuery(a.slt).find(".err").html(i)}_clearValidErr(t){var e=t.find(this.param.valid_msg_slt);for(var i in e.html(""),this.fieldData){var a=this.fieldData[i].field,r=t.find("[for='"+a+"']");r[0]&&(r.html(""),r.hide())}}_validationCheckForm(t){var e=!0,i=this.formInfo[t];return jQuery(i.slt).find(".valid").each(((t,i)=>{i=jQuery(i);var a=this._getFieldByNameOrClass(i);0==this._validationCheck(i,a)&&(e=!1)})),e}_validationCheck(t,e){var i=!0,a=jQuery("[for='"+e+"']"),r=t.attr("title");try{1==(i=t[0].checkValidity())?(a.attr("class","text-success"),a.html("")):(a.attr("class","text-danger"),a.html(r),a.show())}catch(t){throw t}return i}_resetFileUpload(t){t.evt=null;var e=t.elm;try{e.val("")}catch(t){console.log("It can not be reset in IE ")}var i=jQuery("#"+t.preview_slt);return i.attr("src",""),i.hide(),t}addTr(t,e,i){this._addTr(t,e,i)}_addTr(t,e,i){null==e&&(e=-1),e*=1,i||(i={});var a="#"+this.param.tbl_slt,r=jQuery(a+" tbody tr");0==r.length&&location.reload(!0);var s="<tr style='background-color:#fdeaea'>"+r.eq(0).html()+"</tr>",l=this._insertTr(a,e,s);return i.form_type="new_inp",this.setEntityToTr(l,t,i),l}_insertTr(t,e,i){var a=jQuery(t+" tbody"),r=a.find("tr"),s=r.length,l=null;if(s>0)if(e<s&&e>-1){var n=r[e];jQuery(n).before(i),l=e}else{n=r[s-1];jQuery(n).after(i),l=s}else a.append(i),l=0;var o=(r=a.find("tr"))[l];return jQuery(o)}_setEntityToEditTr(t,e,i){if(null!=t){if(i||(i={}),null==e)e=this._getTrInEditing();i.form_type="edit",this.setEntityToTr(e,t,i),this._switchBtnsDisplay(e,t)}}_switchBtnsDisplay(t,e){1==e.delete_flg?(this._switchBtnDisp(t,".row_delete_btn",0),this._switchBtnDisp(t,".row_enabled_btn",1),this._switchBtnDisp(t,".row_eliminate_btn",1)):(this._switchBtnDisp(t,".row_delete_btn",1),this._switchBtnDisp(t,".row_enabled_btn",0),this._switchBtnDisp(t,".row_eliminate_btn",0))}_switchBtnDisp(t,e,i){var a=t.find(e);a[0]&&(i?a.show():a.hide())}setDataToTbl(t,e,i){null==t&&(t=this.tbl),t.find("tbody tr").each(((t,a)=>{if(null!=e[t]){a=jQuery(a);var r=e[t];this.setEntityToTr(a,r,i)}}))}setEntityToTr(t,e,i){if(null!=e){null==i&&(i={});var a=1;null!=i.xss_flg&&(a=i.xss_flg),1==a&&(e=this._xssSanitaizeEncode(e)),this.entToBinds(t,e,"class",i),this.entToBinds(t,e,"name",i)}}_nl2brEx(t){return null==t||""==t||"0"==t||"string"!=typeof t?t:t=t.replace(/\r\n|\n\r|\r|\n/g,"<br>")}_getEntByForm(t){var e=this._getTrInEditing(),i={},a=this.getForm(t);"edit"!=t&&"delete"!=t||(i=this.getEntityByTr(e));var r={};for(var s in this.fieldData){var l=this.fieldData[s].field,n=this._formFind(a,l),o=n.length,h=null;0!=o&&(1==o?h=this._getEntByForm2(n,a,l):n.each(((t,e)=>{var i=jQuery(e);h=this._getEntByForm2(i,a,l)})),r[l]=h)}return jQuery.extend(i,r),i}getForm(t,e){var i;if(null==e&&(e=1),"new_inp"==t||"copy"==t)i=1==e&&null!=this.formNewInp?this.formNewInp:jQuery("#"+this.param.new_form_slt),this.formNewInp=i;else if("edit"==t)i=1==e&&null!=this.formEdit?this.formEdit:jQuery("#"+this.param.edit_form_slt),this.formEdit=i;else if("delete"==t)i=1==e&&null!=this.formDelete?this.formDelete:jQuery("#"+this.param.delete_form_slt),this.formDelete=i;else{if("eliminate"!=t)throw new Error("Uknown form_type!");i=1==e&&null!=this.formEliminate?this.formEliminate:jQuery("#"+this.param.eliminate_form_slt),this.formEliminate=i}return i}_getEntByForm2(t,e,i){var a=t.get(0).tagName,r=t.attr("data-inp-ex");if(r)switch(r){case"image1":case"image_fuk":return t.attr("data-fp")}var s=null;if("INPUT"==a||"SELECT"==a||"TEXTAREA"==a){var l=t.attr("type");if("file"==l){var n=t.attr("id");if(this.cbFileUploadComp){var o=this.cbFileUploadComp.getFileNames(n);null!=o[0]&&(s=o[0])}}else if("checkbox"==l)s=0,t.prop("checked")&&(s=1);else if("radio"==l){var h=e.find("[name='"+i+"']:checked");s=0,h[0]&&(s=h.val())}else s=t.val()}else s="IMG"==a?this._getValFromLabel(e,i):t.html();return s}_getValFromLabel(t,e){var i=null,a=t.find("[for='"+e+"']");return a[0]&&(i=a.html()),i}_formFind(t,e){var i=t.find("[name='"+e+"']");return null==i[0]&&(i=t.find("."+e)),i}_convertFormToDlg(t,e){var i=this.param;null==e&&(e=i.form_z_index);var a=t.form,r={"z-index":e,position:"absolute"};a.css(r),1==this.param.auto_close_flg&&(jQuery(document).click((()=>{1==t.show_flg?t.show_flg=0:jQuery(t.slt).hide()})),a.click((t=>{t.stopPropagation()}))),a.hide()}judgDeviceType(){var t="pc";return screen.width<=480&&(t="sp"),t}_setFieldDataFromForm(t,e,i){var a=e[i].form;for(var r in t){var s=t[r],l=s.field,n={elm:null,tag_name:null,type_name:null,accept:""},o=this._formFind(a,l);if(n.elm=o,null!=o[0]){var h=o.get(0).tagName;n.tag_name=h;if("INPUT"==h||"SELECT"==h||"TEXTAREA"==h){var d=o.attr("type");if(n.type_name=d,"file"==d){var _=o.attr("accept");n.accept=_}}s["inp_"+i]=n}}return t}trToDiv(t,e,i){var a=this.getEntity(e);this.entToBinds(t,a,"class",i),this.entToBinds(t,a,"name",i)}entToBinds(t,e,i,a){var r=this.getBindElms(t,i,a);for(var s in a||(a={}),"class"==i?a.dis_fil_flg=1:"name"==i&&(a.dis_fil_flg=0),this.fieldData){var l=this.fieldData[s].field;if(void 0!==e[l]){var n=r[l];for(var o in n){var h=n[o];this.setValueToElement(h,l,e[l],e,a)}}}}getBindElms(t,e){var i={};for(var a in t instanceof jQuery||(t=jQuery(t)),this.fieldData){var r,s=this.fieldData[a];if("class"==e)r=t.find("."+s.field);else{if("name"!=e)continue;r=t.find(`[name='${s.field}']`)}if(r[0]){for(var l=[],n=0;n<r.length;n++)l.push(r.eq(n));i[s.field]=l}}return i}setFieldsToForm(t,e,i){var a=this.getForm(t);null==i&&(i={}),i.par=a,i.form_type=t,this.entToBinds(a,e,"class",i),this.entToBinds(a,e,"name",i)}setValueToElement(t,e,i,a,r){t instanceof jQuery||(t=jQuery(t)),null==r&&(r={});var s=0;s=null==r.xss?1:r.xss;var l=t.get(0).tagName;if(r.dis_fil_flg){var n=this.displayFilter(i,e,r.disFilData,s);i=n.val1,s=n.xss}var o=t.attr("data-inp-ex");if(o)switch(o){case"image1":this._setEntToImage1(t,e,i);break;case"image_fuk":this._setEntToImageFuk(t,e,i)}else if("INPUT"==l||"SELECT"==l){var h=t.attr("type");if("checkbox"==h)0==i||null==i||""==i?t.prop("checked",!1):t.prop("checked",!0);else if("radio"==h){var d=r.par.find("[name='"+e+"'][value='"+i+"']");if(d[0])d.prop("checked",!0);else if(this._empty(i))r.par.find("[name='"+e+"']").prop("checked",!1)}else this._setForCustumType(t,e,i,a,r)}else"TEXTAREA"==l?(""!=i&&null!=i&&(i=i.replace(/<br>/g,"\r"),i=this._xssSanitaizeDecode(i)),t.val(i)):("string"==typeof i&&(i=i.replace(/<br>/g,"\r"),1==s&&(i=this._xssSanitaizeEncode(i)),i=this._nl2brEx(i)),t.html(i))}_setForCustumType(t,e,i,a,r){let s=this._xssSanitaizeDecode(i);if("link"==t.attr("data-custum-type")){let e=t.parents("td").find("a"),a=e.attr("data-url-tmp");return a=a.replace("%0",s),e.attr("href",a),e.html(i),void t.val(s)}t.val(s)}_setEntToImage1(t,e,i){let a=0;if(null==i||""==i)a=0;else{let t=this._getExtension(i);a=-1==["jpg","jpeg","png","gif"].indexOf(t)?2:1}let r=t.parents("td"),s=r.find(".image1_img_a"),l=r.find(".image1_img"),n=r.find(".image1_dl"),o=r.find(".image1_none");s.attr("href",""),l.attr("src",""),n.attr("href",""),s.hide(),n.hide(),o.hide();let h=this.param.midway_dp+i;switch(t.val(i),a){case 0:o.show();break;case 1:let t=h.replace("/orig/","/thum/");l.attr("src",t),s.attr("href",h),s.show();break;case 2:n.attr("href",h),n.show();break;default:throw new Error("システムエラー CB210607A")}}_getExtension(t){if(null==t||""==t)return"";if(-1==t.indexOf("."))return"";let e=t.split("."),i=e[e.length-1];return i=i.toLowerCase(),i}_setEntToImageFuk(t,e,i){let a=t.attr("id"),r={midway_dp:this.param.midway_dp};this.cbFileUploadComp.setFilePaths(a,i,r),t.attr("data-fp",i)}displayFilter(t,e,i,a){var r={val1:t,xss:a};if(i||(i=this.param.disFilData),!i)return r;if(!i[e])return r;var s=i[e];a=0;switch(s.fil_type){case"select":r.val1=this.disFilSelect(t,e,s.option);break;case"delete_flg":r.val1=this.disFilDeleteFlg(t,e,s.option),r.xss=0;break;case"flg":r.val1=this.disFilFlg(t,e,s.option),r.xss=0;break;case"money":r.val1=this.disFilMoney(t,e,s.option),r.xss=0}return r}setDisplayFilterData(t){this.param.disFilData=t}disFilSelect(t,e,i){if(null==t)return t;var a={};i&&i.list&&(a=i.list);var r="";return null!=a[t]&&(r=a[t]),r}disFilDeleteFlg(t,e,i){return null==t?t:1==t?'<span style="color:#b4b4b4;">削除</span>':'<span style="color:#23d6e4;">有効</span>'}disFilFlg(t,e,i){null!=t&&""!=t&&0!=t||(t=0),t>0&&(t=1);var a=i.list[t];return 1==t?'<span style="color:#23d6e4;">'+a+"</span>":'<span style="color:#b4b4b4;">'+a+"</span>"}disFilMoney(t,e,i){if(null==t)return t;var a="&yen;";return i&&i.currency&&(a=i.currency),a+String(t).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}_getFieldEntByField(t){var e=this.fieldHashTable[t];return this.fieldData[e]}_showForm(t,e,i){if(null==i&&(i={}),null==i.form_position&&(i.form_position=this.param.form_position,"sp"==this.param.device_type&&(i.form_position="max")),"sp"==this.param.device_type){var a=t.find("table");a.addClass("tbl_sp"),a.find("label.text-danger").hide()}if((null==i.use_show_form_strategy&&(i.use_show_form_strategy=1),0==this.param.auto_close_flg&&(this.param.form_z_index++,t.css("z-index",this.param.form_z_index)),t.show(),1==i.use_show_form_strategy&&null!=this.showFormStrategy)&&1==this.showFormStrategy.showForm(t,e))return;e instanceof jQuery||(e=jQuery(e));var r=e.offset(),s=r.left,l=r.top,n=jQuery(window).width(),o=this.param.form_width,h=this.param.form_height;this._empty(o)&&(o=t.outerWidth()),this._empty(h)&&(h=t.outerHeight());var d=l+e.outerHeight(),_=0,c=n;if(!this._empty(this.param.contents_slt)){var p=jQuery(this.param.contents_slt);p[0]&&(_=p.offset.left,c=p.width())}switch(i.form_position){case"left":_=s-o;break;case"center":_=c/2-o/2;break;case"right":_=s;break;case"max":o=c-2;break;default:(_=s)+o>c&&(_=c-o)}_<0&&(_=0),t.offset({top:d,left:_}),this._empty(o)||t.width(o),this._empty(h)||t.height(h),this._fitForm(t)}_addMoreFieldData(t,e){if(!e&&!(e=this._getFieldDataFromTh()))throw new Error("fieldDataを取得できません。th要素のclass属性にフィールド名を指定してください。");var i=[];return jQuery("#"+t+" th").each(((t,a)=>{var r=jQuery(a).text(),s=null;if(e[t]&&(s=e[t]),null!=s){var l={index:t,field:s,wamei:r};i.push(l),t++}})),i}_getFieldDataFromTh(){var t=[],e="#"+this.param.tbl_slt+" th";return jQuery(e).each(((e,i)=>{var a=jQuery(i),r=this._getFieldByClassOrName(a);r&&t.push(r)})),t}_createFieldHashTable(t){var e={};for(var i in t){e[t[i].field]=i}return e}_initFormInfo(t){var e={},i=this._classifySlt(t.new_form_slt),a=jQuery(i.slt);e.new_inp={xid:i.xid,slt:i.slt,show_flg:0,form:a},0==this.param.form_mode&&this._convertFormToDlg(e.new_inp),i=this._classifySlt(t.edit_form_slt);var r=jQuery(i.slt);e.edit={xid:i.xid,slt:i.slt,show_flg:0,form:r},0==this.param.form_mode&&this._convertFormToDlg(e.edit);i=this._classifySlt(t.delete_form_slt);var s=jQuery(i.slt);e.delete={xid:i.xid,slt:i.slt,show_flg:0,form:s},this._convertFormToDlg(e.delete);i=this._classifySlt(t.eliminate_form_slt);var l=jQuery(i.slt);return e.eliminate={xid:i.xid,slt:i.slt,show_flg:0,form:l},this._convertFormToDlg(e.eliminate),e}_errShow(t,e){var i=this.getForm(e);if(this._clearValidErr(i),"string"==typeof t)(r=i.find(this.param.valid_msg_slt))[0]&&(r.length>1&&(r=r.eq(0)),r.html(t.err_msg)),r.html(t);else if(t[0])for(var a in t){var r,s=t[a];(r=i.find(s.err_slt)).html(s.err_msg)}else(r=i.find(t.err_slt)).html(t.err_msg)}searchKjs(){if(this.cbValidationJq.checkAll())return void alert("検索入力に不備があります。確認してください。");let t=this._getUrlQuery(),e=this._getFormKjsElm(),i={},a=[];e.find(".kjs_inp").each(((t,e)=>{let r=jQuery(e),s="";s="checkbox"==r.attr("type")?r.prop("checked")?1:0:r.val();let l=r.attr("id");this._emptyNotZero(s)?a.push(l):(s=encodeURIComponent(s),i[l]=s)})),jQuery.extend(t,i);for(let e in a){delete t[a[e]]}t.page_no=0;let r,s="";for(let e in t){s+=e+"="+t[e]+"&"}""!=s&&(s=s.substr(0,s.length-1),r="?"+s),window.location.href=r}isDefaultKjs(t,e,i){if(null==e&&(e=this.param.kjs),null==i){this.param.defKjs}let a={};for(let e in t){a[t[e]]=1}let r=1;for(let t in i)if(!a[t]&&null!==e[t]){let a=e[t];this._emptyNotZero(a)&&(a=null);let s=i[t];if(this._emptyNotZero(s)&&(s=null),a!=s){r=0;break}}return r}_getFieldByNameOrClass(t){var e=t.attr("name");if(e||(e=t.attr("class")),!e)return e;var i=(e=e.trim()).indexOf(" ");return-1!=i&&(e=e.substr(0,e.length-i)),e}_getFieldByClassOrName(t){var e=t.attr("class");if(e||(e=t.attr("name")),!e)return e;var i=(e=e.trim()).indexOf(" ");return-1!=i&&(e=e.substr(0,e.length-i)),e}_classifySlt(t){var e="",i="";if(!t)return{xid:e,slt:i};"#"==t.charAt(0)?(e=t.replace("#",""),i=t):(e=t,i="#"+t);var a={xid:e,slt:i};return a}_xssSanitaizeEncode(t){if("object"==typeof t){for(var e in t)t[e]=this._xssSanitaizeEncode(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_xssSanitaizeDecode(t){if("object"==typeof t){for(var e in t)t[e]=this._xssSanitaizeDecode(t[e]);return t}return"string"==typeof t?t.replace(/&lt;/g,"<").replace(/&gt;/g,">"):t}_nl2br(t){return"string"==typeof t?t.replace(/[\n\r]/g,"<br>"):t}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}_emptyNotZero(t){var e=this._empty(t);return e&&(0!==t&&"0"!==t||(e=!1)),e}_getUrlQuery(){if(""==(t=window.location.search)||null==t)return{};for(var t=t.substring(1,t.length),e=t.split("&"),i={},a=0;a<e.length;a++){var r=e[a].split("=");i[r[0]]=r[1]}return i}setShowFormStrategy(t){this.showFormStrategy=t}_setValueEx(t,e){if(t[0]){var i=t.get(0).tagName;if("INPUT"==i||"SELECT"==i){var a=t.attr("type");if("checkbox"==a)0==e||null==e||""==e?t.prop("checked",!1):t.prop("checked",!0);else if("radio"==a){var r=t.attr("name"),s=t.parent().find("[name='"+r+"'][value='"+e+"']");s[0]&&s.prop("checked",!0)}else"string"==typeof e&&(e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">")),t.val(e)}else"TEXTAREA"==i?(""!=e&&null!=e&&"string"==typeof(e=e.replace(/<br>/g,"\r"))&&(e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">")),t.val(e)):"IMG"==i||"AUDIO"==i?t.attr("src",e):(""!=e&&null!=e&&("string"==typeof(e=e.replace(/<br>/g,"\r"))&&(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")),e=e.replace(/\r\n|\n\r|\r|\n/g,"<br>")),t.html(e))}}saveRequest(t,e){this.autoSave.saveRequest(t,e)}escapeForAjax(t){if("string"==typeof t)return-1!=t.indexOf("&")?(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),encodeURIComponent(t)):t;if("object"==typeof t){for(var e in t)t[e]=this.escapeForAjax(t[e]);return t}return t}rowExchangeAfter(){let t=this.getDataFromTbl(),e=1*this.param.pages.page_no*(1*this.param.pages.row_limit)+1;for(let i in t){t[i].sort_no=e,e++}this._btnsDisabledSwich(!0);let i={reflect_on_tbl:1,afterCallBack:function(){this._btnsDisabledSwich(!1)}.bind(this)};this.saveRequest(t,i)}_btnsDisabledSwich(t){jQuery(".row_edit_btn").prop("disabled",t),jQuery(".row_copy_btn").prop("disabled",t),jQuery(".row_delete_btn").prop("disabled",t),jQuery(".row_enabled_btn").prop("disabled",t),jQuery(".row_eliminate_btn").prop("disabled",t)}_toggleRegBtn(t,e){var i=this.getForm(t),a=i.find(".reg_btn"),r=i.find(".reg_btn_msg");0==e?(a.prop("disabled",!0),r.html(" 登録中・・・")):(a.prop("disabled",!1),r.html(""))}_snakeToCamel(t){return t=(t=t.replace(/_./g,(t=>t.charAt(1).toUpperCase()))).charAt(0).toUpperCase()+t.slice(1)}getKjElms(){var t={};return jQuery(".kj_wrap").each(((e,i)=>{var a=(i=jQuery(i)).attr("data-field");t[a]=i})),t}tableTransform(t){1==t?(this.tbl.addClass("table_transform"),jQuery("#table_transform_tbl_mode").show(),jQuery("#table_transform_div_mode").hide()):(this.tbl.removeClass("table_transform"),jQuery("#table_transform_tbl_mode").hide(),jQuery("#table_transform_div_mode").show())}_fukPrevAfterCallback(t,e,i){if(null!=t){var a=t.slice(-2),r=null;if("_n"==a)r="new_inp";else{if("_e"!=a)return;r="edit"}i.self._fitFormByFormType(r)}}_fitFormByFormType(t){var e=this.getForm(t);this._fitForm(e)}_fitForm(t){1==this.param.form_mode?t.css({width:"auto",height:"auto"}):t.css({width:"auto",height:"auto",display:"inline-block"})}_formDragAndResizeSetting(){0==this.param.form_mode&&(this._formDragAndResizeSetting2("new_inp"),this._formDragAndResizeSetting2("edit")),this._formDragAndResizeSetting2("delete"),this._formDragAndResizeSetting2("eliminate")}_formDragAndResizeSetting2(t){if(1==this.param.drag_and_resize_flg){var e=this.getForm(t);if(null!=e&&null!=e.draggable){var i=e.draggable();jQuery(".panel-body",i).mousedown((t=>{i.draggable("disable")})).mouseup((t=>{i.draggable("enable")})),e.resizable()}}}_errByErrTypes(){this.param.errTypes.indexOf("kjs_err")>=0&&jQuery(".cb_kj_detail").show()}openNoteDetail(t,e){t instanceof jQuery||(t=jQuery(t)),null==e&&(e="note");var i=t.parents("td"),a=(i.find("[name='"+e+"']"),i.find("."+e)),r=1,s=i.find(".note_detail");if(!s[0]){r=0;var l=`<div class='note_detail' data-field='${e}'></div>`;i.append(l),s=i.find(".note_detail")}if("none"==a.css("display"))return a.show(),s.hide(),void t.val("...");if(r)return a.hide(),s.show(),void t.val("閉じる");var n=i.find("[name='"+e+"']").val();null!=n&&""!=n&&(n=(n=this._xssSanitaizeEncode(n)).replace(/\r\n|\n\r|\r|\n/g,"<br>"),s.html(n),a.hide(),t.val("閉じる"))}_setColspanToForm(t){var e=this._getClmCntByActive();return t.find("td").attr("colspan",e),t}_getClmCntByActive(){var t=this.csh.getCshAry(),e=1;for(var i in t)t[i]&&e++;return e}_setColspanToTd(t){var e=this.csh.getCshAry(),i=1;for(var a in e)e[a]&&i++;return form.find("td").attr("colspan",i),form}_iniRtnSetUrl(){this._getHiddensElm();let t=this.param.referer_url,e=this.param.now_url;var i=this._stringLeft(t,"?",1),a=this._stringLeft(e,"?",1),r=location.href.split(/[?#]/)[0]+"-ini_rtn_url",s="";i==a?null==(s=localStorage.getItem(r))&&(s=e):(s=e,localStorage.setItem(r,s)),jQuery(".ini_rtn").attr("href",s)}_getHiddensElm(){return null==this.hiddensElm&&(this.hiddensElm=jQuery("#hiddens_data")),this.hiddensElm}_stringLeft(t,e,i){if(null==t||""==t)return t;var a=t.indexOf(e);return-1==a&&1==i?t:t.substring(0,a)}_addEventForKjsEnter(){this._getFormKjsElm().find("input").keypress((t=>{13==t.which&&this.searchKjs()}))}_getFormKjsElm(){return null==this.formKjsElm&&(this.formKjsElm=jQuery(".form_kjs")),this.formKjsElm}calendarViewCreate(t){var e=this.getDataFromTbl();this.calendarViewK.create(e,t)}reactInit(t){(new Date).getTime();var e=this._getFields();this.crudBaseReact.init(e,t)}reactivatingOfRow(){this.crudBaseReact.reactivatingOfRow()}_getFields(){if(null!=this.fields)return this.fields;var t=[];for(var e in this.fieldData){var i=this.fieldData[e];t.push(i.field)}return this.fields=t,this.fields}initCbGtaCash(t,e){null!=this.cbGtaCash&&this.cbGtaCash.init(t,e)}_getKjs(){return null==this.kjs&&(this.kjs=this.param.kjs),this.kjs}sessionClear(t){if(this._empty(t))t="";else{"&"!=t.charAt(0)&&(t="&"+t)}this._clear(),location.href="?ini=1&sc=1"+t}_clear(){this.csh.reset(),this.crudBaseConfig.reset(),this.cbBtnSizeChanger.clearReset()}setKjsValidationForJq(t,e,i){this.cbValidationJq=new CrudBaseValidationJQuery(t,e,i)}_setOuterNameToTr(t,e){let i=this.crudBaseData.fieldData;for(let a in i){let r=i[a];if(null==r.outer_tbl_name)continue;let s=r.outer_alias,l=t[s];l=this._xssSanitaizeEncode(l),null==l&&(l="");let n=e.find("."+s);n[0]&&n.html(l);let o=e.find(`input[name='${s}']`);o[0]&&o.val(l)}}reg(t,e){if(null==e&&(e={}),this._empty(t))return t;let i=new FormData;if(e.beforeCallBack){let a=e.beforeCallBack(t,i);if(a.err)return a.err;a.ent?(t=a.ent,i=a.fd):t=a}let a=JSON.stringify(t);i.append("key1",a);let r=this.param.csrf_token;i.append("_token",r),jQuery.ajax({type:"post",url:this.param.edit_reg_url,data:i,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,i,a)=>{419==a.status&&location.reload(!0);let r=null;try{r=jQuery.parseJSON(t)}catch(e){alert("エラー:"+t),console.log(t),jQuery("#err").html(t)}"logout"==r.err_msg&&location.reload(!0),e.afterCallBack&&e.afterCallBack(r)})).fail(((t,e,i)=>{419==t.status&&location.reload(!0),jQuery("#err").html(t.responseText),alert(e)}))}}class CrudBaseAutoSave{constructor(t){this.crudBase=t,this.fieldData=t.fieldData,this.tbl=t.tbl,this.msgElm=jQuery("#crud_base_auto_save_msg"),this.data,this.set_timeout_hdl,this.crudBaseData=t.param}saveRequest(t,e){this.data=t,null==e&&(e={}),null==e.reflect_on_tbl&&(e.reflect_on_tbl=0),null==e.interval&&(e.interval=3e3),null==e.afterCallBack&&(e.afterCallBack=null),this.option=e,null!=this.set_timeout_hdl&&clearTimeout(this.set_timeout_hdl),this.set_timeout_hdl=setTimeout((()=>{this._autoSave(this.data),1==e.reflect_on_tbl&&this.crudBase.setDataToTbl(null,t)}),e.interval)}_autoSave(t){if(this.msgElm.html("保存中..."),console.log("自動保存"),null==t)t=this.crudBase.getDataHTbl();t=this.crudBase.escapeForAjax(t);let e=JSON.stringify(t),i=this.crudBase.param.auto_save_url,a=new FormData;a.append("key1",e);let r=this.crudBaseData.csrf_token;a.append("_token",r),jQuery.ajax({type:"post",url:i,data:a,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,e)=>{let i;try{i=jQuery.parseJSON(t),this.msgElm.html("")}catch(e){return this.msgElm.html("自動保存のエラー1"),void jQuery("#err").html(t)}this.option.afterCallBack&&this.option.afterCallBack()})).fail(((t,e,i)=>{this.msgElm.html("自動保存のエラー"),console.log(t),jQuery("#err").html(t.responseText)}))}}class CrudBaseBulkAdd{constructor(t){this.fieldData=t}init(t,e){for(var i in t){var a=t[i];a.wamei=this._getWameiFromFieldData(a.field)}this.inpFields=t,this.param=this._initParam(e)}_getWameiFromFieldData(t){var e=t;for(var i in this.fieldData){var a=this.fieldData[i];if(t==a.field){e=a.wamei;break}}return e}_initParam(t){if(null==t&&(t={}),null==t.ajax_url)throw new Error("Not empty ajax_url in param!");if(null==t.csrf_token)throw new Error("Not empty csrf_token in param!");return null==t.ta_placeholder&&(t.ta_placeholder="Excelからコピーした行列を貼り付けてください。\n(例)\nネコ名A\t100\nネコ名B\t101\n"),null==t.ta_height&&(t.ta_height="20rem"),null==t.test_mode&&(t.test_mode=0),t}showForm(){if(this.form)return this.form.show(),this.form.find("#cbba_inps_div").show(),void this.form.find("#cbba_preview_div").hide();var t=this.param,e=this._makeSameApplysHtml(),i="";this.param.test_mode&&(i=this._getTestText());var a=`\n\t\t\t<div id="cbba_div" >\n\t\t\t\t<div id="cbba_head" >\n\t\t\t\t\t<h4>一括追加</h4>\n\t\t\t\t\t<div id="cbba_close_btn_w" style="">\n\t\t\t\t\t\t<input id="cbba_close_btn" type='button' value="閉じる" class="btn btn-primary btn-sm" onclick="" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div style="clear:both"></div>\n\t\t\t\t\n\t\t\t\t<div id="cbba_inps_div">\n\t\t\t\t\t<textarea id="cbba_ta" placeholder="${t.ta_placeholder}" style='height:${t.ta_height}'>${i}</textarea>\n\t\t\t\t\t<div id="cbba_same_applys_w">${e}</div>\n\t\t\t\t\t<div id="cbba_preview_btn_w">\n\t\t\t\t\t\t<input id="cbba_preview_btn" type="button" value="プレビュー" class="btn btn-success" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div id="cbba_preview_div" style="display:none">\n\t\t\t\t\t<div id="cbba_preview_div2">\n\t\t\t\t\t</div>\n\t\t\t\t\t<input id="cbba_reg_btn" type="button" value="一括追加" class="btn btn-danger" />\n\t\t\t\t\t<input id="cbba_rtn_btn" type="button" value="戻る" class="btn btn-primary" />\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div id="cbba_err" class="text-danger"></div>\n\t\t\t</div>\n\t\t`,r=jQuery("#crud_base_bulk_add");r.html(a),r.find("#cbba_close_btn").click((t=>{this.form.hide()})),r.find("#cbba_reg_btn").click((t=>{this._bulkAdd()})),r.find("#cbba_rtn_btn").click((t=>{this._returnToInput()})),r.find("#cbba_preview_btn").click((t=>{this._preview()})),this.form=r,this.form.show()}_returnToInput(){this.form.find("#cbba_preview_div").hide(),this.form.find("#cbba_inps_div").show()}_getTestText(){return"ロイヤルアナロスタン\t101\nロード・ゴート\t102\nツィッツァ\t103\nイッパイアッテナ\t104\n<input />\t105\nおキャット様.'\"\t106"}_makeSameApplysHtml(){var t="",e=this.inpFields;for(var i in e){var a=e[i];switch(a.inp_type){case"text":t+=this._makeSameApplyTypeText(a);break;case"date":t+=this._makeSameApplyTypeDate(a);break;case"select":t+=this._makeSameApplyTypeSelect(a);break;case"sort_no":t+=this._makeSameApplyTypeSortNo(a)}}return t}_makeSameApplyTypeText(t){var e="";return null!=t.def&&(e=t.def),`\n\t\t\t<div class="same_apply_w">\n\t\t\t\t<label>${t.wamei}</label>\n\t\t\t\t<input type="text" class="same_apply ${t.field}" value="${e}" />\n\t\t\t</div>\n\t\t`}_makeSameApplyTypeDate(t){var e="";return null!=t.def&&(e=t.def,e=this._convDateTo_yyyymmdd(e)),`\n\t\t\t<div class="same_apply_w">\n\t\t\t\t<label>${t.wamei}</label>\n\t\t\t\t<input type="date" class="same_apply ${t.field}" value="${e}" />\n\t\t\t</div>\n\t\t`}_makeSameApplyTypeSelect(t){var e=null;null!=t.def&&(e=t.def);var i="";for(var a in t.list){var r="";e==a&&(r="selected"),i+=`<option value='${a}' ${r}>${t.list[a]}</option>`}return`\n\t\t\t<div class="same_apply_w">\n\t\t\t\t<label>${t.wamei}</label>\n\t\t\t\t<select class="same_apply ${t.field}">${i}</select>\n\t\t\t</div>\n\t\t`}_makeSameApplyTypeSortNo(t){var e="",i="";return 1==t.def?i="checked":e="checked",`\n\t\t\t<div class="same_apply_w">\n\t\t\t\t<label>追加場所</label>\n\t\t\t\t<label class='cbba_sort_no_label'>\n\t\t\t\t\t<input type="radio" name="cbba_sort_no" value="0" ${e}>\n\t\t\t\t\t先頭に追加\n\t\t\t\t</label>\n\t\t\t\t<label class='cbba_sort_no_label'>\n\t\t\t\t\t<input type="radio" name="cbba_sort_no" value="1" ${i}>\n\t\t\t\t\t末尾に追加\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`}_convDateTo_yyyymmdd(t){if("string"==typeof t&&"Invalid Date"==(t=new Date(t)))return null;var e=t.getFullYear(),i=t.getMonth()+1;i=("0"+i).slice(-2);var a=t.getDate();return e+"-"+i+"-"+(a=("0"+a).slice(-2))}_preview(){var t=[];if(t=this._getDataFromTextArea(t),this._err(""),0!=t.length){t=this._getDataFromSameApplys(t);var e=jQuery.extend(!0,{},t);e=this._xss_sanitize(e);var i=this._makePrviewHtml(e),a=this.form.find("#cbba_preview_div");a.find("#cbba_preview_div2").html(i),a.show(),this.form.find("#cbba_inps_div").hide(),this.data=t}else this._err("テキストエリアが空です。")}_getDataFromTextArea(t){var e=this.form.find("#cbba_ta").val(),i=this._makeADataFromTaText(e),a=this._filteringToTaInpFields();for(var r in i){var s=i[r],l={};for(var n in a){var o=a[n].field;null==s[n]?l[o]="":l[o]=s[n]}t.push(l)}return t}_makeADataFromTaText(t){var e=[],i=t.split("\n");for(var a in i){var r=i[a];if(""!=r){var s=r.split("\t");e.push(s)}}return e}_filteringToTaInpFields(){var t=this.inpFields,e=[];for(var i in t){var a=t[i];"textarea"==a.inp_type&&e.push(a)}return e}_getDataFromSameApplys(t){var e=this._filteringInpFieldsByInpTypes(["text","date","select"]);for(var i in e){var a=e[i].field,r="",s=this.form.find("."+a);for(var l in s[0]&&(r=s.val()),t){t[l][a]=r}}return t}_filteringInpFieldsByInpTypes(t){var e=this.inpFields,i=[];for(var a in e){var r=e[a];t.indexOf(r.inp_type)>=0&&i.push(r)}return i}_makePrviewHtml(t){if(0==t.length)return"";var e=this._getTHeads(t[0]),i="<table class='tbl2'>";i+="<thead><tr>";var a=t[0];for(var r in a){i+="<th>"+e[r]+"</th>"}for(var s in i+="</tr></thead>",t){var l=t[s];for(var n in i+="<tr>",l)i+="<td>"+l[n]+"</td>";i+="</tr>"}return i+="</table>"}_getTHeads(t){var e={},i=this.fieldData;for(var a in t){var r=a;for(var s in i){var l=i[s];if(a==l.field){r=l.wamei;break}}e[a]=r}return e}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=this._xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_bulkAdd(){this._anabledBulkAddBtn(!1);var t=this._getAddPosition();this.param.add_position=t;var e={add_position:t};this._ajax("cbba_get_sort_no",e,this._bulkAdd2)}_bulkAdd2(t,e){var i=e.next_sort_no,a=t.param.add_position,r=t.data,s=i;for(var l in r){r[l].sort_no=s,1==a?s++:s--}var n={data:r};t._ajax("cbba_add_reg",n,t._bulkAdd3)}_bulkAdd3(t,e){var i=e.newIds,a=t.data;for(var r in a){var s=a[r],l=i[r];s.id=l}var n=e.err_msg;if(""!=n){t._err(n);var o=t.regbtn;return o.val("一括追加"),void o.prop("disabled",!1)}location.reload(!0)}_ajax(t,e,i){let a=this.param.ajax_url;e.action_code=t;var r=JSON.stringify(e);let s=new FormData;s.append("key1",r);let l=this.param.csrf_token;s.append("_token",l),jQuery.ajax({type:"post",url:a,data:s,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,e)=>{var a=null;try{a=jQuery.parseJSON(t)}catch(e){return void this._err(t)}i(this,a)})).fail(((t,e,i)=>{this._err(t.responseText)}))}_anabledBulkAddBtn(t){null==t&&(t=!1),null==this.regBtn&&(this.regbtn=this.form.find("#cbba_reg_btn"));var e=this.regbtn;1==t?(e.val("一括追加"),e.prop("disabled",!1)):(e.val("追加中・・・"),e.prop("disabled",!0))}_getAddPosition(){var t=this.form.find('input[name="cbba_sort_no"]:checked'),e=1;return t[0]&&(e=t.val()),e}_err(t){null==this.errElm&&(this.errElm=this.form.find("#cbba_err")),this.errElm.html(t)}}
/**
 * CrudBase設定クラス
 * @date 2019-7-17 | 2020-8-25
 * @version 1.0.2
 * @license MIT
 */class CrudBaseConfig{init(t,e){this.param=this._setParamIfEmpty(t),this.tDiv=jQuery("#"+this.param.div_xid),this.crudBaseData=e,this.data=this._getData(e.configData);let i=this._createHtml();this.tDiv.html(i),this.fShowBtn=this.tDiv.find(".cb_conf_f_show_btn"),this.fCloseBtn=this.tDiv.find("#cb_conf_f_close_btn"),this.funcDiv=this.tDiv.find(".cb_conf_func_div"),this.resDiv=this.tDiv.find(".cb_conf_res"),this.errDiv=this.tDiv.find(".cb_conf_err"),this.applyBtn=this.tDiv.find(".cb_conf_apply_btn"),this.defBtn=this.tDiv.find(".cb_conf_def_btn"),this.form=this.tDiv.find(".cb_conf_form"),this._addClickFShowBtn(this.fShowBtn),this._addClickFCloseBtn(this.fCloseBtn),this._addClickApplyBtn(this.applyBtn),this._addClickDefBtn(this.defBtn),this.cbBtnSizeChanger=new CbBtnSizeChanger(e),this.setDataToUi(this.data)}_getData(t){null==t&&(t=[]);let e=$.extend(!0,{},t);null==e.delete_alert_flg&&(e.delete_alert_flg=0);let i=$.extend(!0,{},e),a=this._getDataFromLs();return i=$.extend(i,a),this.defData=e,this.lsData=a,this.data=i,i}_setFlg(t,e,i){let a=i;return null!=t[e]&&(a=t[e]),a}_setParamIfEmpty(t){return null==t&&(t={}),null==t.div_xid&&(t.div_xid="crud_base_config"),t}_createHtml(){return'\n\t<input class=\'cb_conf_f_show_btn btn btn-secondary btn-sm\' type="button" value=\'設定\' />\n\t<div class=\'cb_conf_func_div\' style="display:none">\n\t\t<div style="display:inline-block;padding:10px;border:solid 4px #5bd59e;border-radius:5px;margin-bottom:10px">\n\t\t\t<table style="width:100%;"><tbody><tr>\n\t\t\t\t<td><div style="color:#5bd59e;font-weight:bold">設定</div></td>\n\t\t\t\t<td style="text-align:right"><button id="cb_conf_f_close_btn" type="button" class="btn btn-secondary btn-sm">閉じる</button></td>\n\t\t\t</tr></tbody></table>\n\t\t\t\n\t\t\t<input value="ボタン設定" type="button" class="btn btn-secondary btn-sm" onclick="jQuery(\'#CbBtnSizeChanger\').toggle(300);" />\n\t\t\t<div id="CbBtnSizeChanger" style="display:none"></div>\n\t\t\t\n\t\t\t<table class=\'cb_conf_form tbl2\' style="margin-top:8px"><tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td><input class="cbcf_delete_alert_flg" type="checkbox" value=\'1\'></td>\n\t\t\t\t\t<td>削除アラート: 一覧行の削除ボタンを押したときにアラートを表示する。</td>\n\t\t\t\t<tr>\n\t\t\t</tbody></table>\n\t\t\t\n\t\t\t<div style="margin-top:8px">\n\t\t\t\t<input class="cb_conf_apply_btn btn btn-success" type=\'button\' value="適用" />\n\t\t\t\t<input class="cb_conf_def_btn btn btn-secondary btn-sm" type=\'button\' value="初期に戻す" />\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="cb_conf_res text-success"></div>\n\t\t\t<div class="cb_conf_err text-danger"></div>\n\t\t</div>\n\t</div>\n\t\t'}_getDataFromLs(){let t=this._getLsKey(),e=localStorage.getItem(t),i=JSON.parse(e);return null==i&&(i={}),i}clearlocalStorage(){let t=this._getLsKey();localStorage.removeItem(t)}_saveData(t,e){this.data[t]=e;let i=this._getLsKey();var a=JSON.stringify(this.data);localStorage.setItem(i,a)}_getLsKey(){let t=location.href;return t=t.split(/[?#]/)[0],t+="_CrudBaseConfig",t}_showErr(t){this.errDiv.append(t+"<br>")}_addClickFShowBtn(t){t.click((t=>{this._showToggle()}))}_addClickFCloseBtn(t){t.click((t=>{this._showToggle()}))}_showToggle(){var t=this.funcDiv.css("display");if(null==t|"none"==t){let t=this._getFShowBtnName(0);this.fShowBtn.val(t),this.tDiv.css("display","block"),this.funcDiv.show(300)}else{let t=this._getFShowBtnName(1);this.fShowBtn.val(t),this.tDiv.css("display","inline-block"),this.funcDiv.hide(300)}}_addClickApplyBtn(t){t.click((t=>{this.clickApplyBtn()}))}clickApplyBtn(){this.data.delete_alert_flg=this._getFromCheckbox("delete_alert_flg");let t=this._getLsKey();var e=JSON.stringify(this.data);localStorage.setItem(t,e)}_getFromCheckbox(t){let e=this.form.find(".cbcf_"+t+":checked").val();return null==e&&(e=0),e}_getFShowBtnName(t){let e=" (閉じる)",i=this.fShowBtn.val();return 1==t?i=i.replace(e,""):i+=e,i}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}_addClickDefBtn(t){t.click((t=>{this.reset()}))}reset(){this.data=$.extend(!0,{},this.defData),this.setDataToUi(this.data);let t=this._getLsKey();localStorage.removeItem(t)}setDataToUi(t){this._setCheckbox(t,"delete_alert_flg")}_setCheckbox(t,e){let i=this.form.find(".cbcf_"+e);this._empty(t[e])?i.prop("checked",!1):i.prop("checked",!0)}}
/**
 * 外部名称クラス： 外部idに紐づく外部テーブルの名前要素を制御
 * @since 2021-6-2 | 2021-6-5
 * @license MIT
 * @version 1.0.1
 */class CrudBaseOuterName{init(t,e,i){this.crudBaseData=t,this.csrf_token=t.csrf_token,e=this._setValueIfEmpty(e),this.data=e,null==i&&(i={}),null==i.ajax_action_method&&(i.ajax_action_method="getOuterName"),this.option=i,this.box=this._createBox(e)}_createBox(t){let e={};for(let i in t){let a=t[i],r=a.unique_code,s={};s.ent=a;let l=jQuery(a.outer_id_slt);if(null==l[0])throw new Error("CBCN0604F nothing→"+a.outer_id_slt);s.outerIdElm=l;let n=jQuery(a.outer_name_slt);if(null==n[0])throw new Error("CBCN0604F nothing→"+a.outer_name_slt);s.outerNameElm=n;let o=jQuery(a.outer_show_btn_slt);if(null==o[0])throw new Error("CBCN0604F nothing→"+a.outer_show_btn_slt);s.outerShowBtnElm=o,e[r]=s}return e}_setValueIfEmpty(t){for(let e in t){let i=t[e];if(null==i.unique_code)throw new Error("CBON0604D i="+e);let a=i.unique_code;null==i.outer_id_field&&(i.outer_id_field=this._extractIdField(a)),null==i.outer_name_field&&(i.outer_name_field=this._extractOuterNameField(i.outer_id_field)),null==i.wamei&&(i.wamei=""),null==i.outer_id_slt&&(i.outer_id_slt=".OuterName-"+a+"-outer_id"),null==i.outer_name_slt&&(i.outer_name_slt=".OuterName-"+a+"-outer_name"),null==i.outer_show_btn_slt&&(i.outer_show_btn_slt=".OuterName-"+a+"-outer_show_btn"),null==i.form_type&&(i.form_type=this._extactFromType(a))}return t}_extractOuterNameField(t){let e=this._getFieldEnt(t);if(null==e.outer_alias)throw new Error("CBON210605B");return e.outer_alias}_getFieldEnt(t){let e=null,i=this.crudBaseData.fieldData;for(let a in i){let r=i[a];if(r.id==t){e=r;break}}if(null==e)throw new Error("システムエラー CBON210605A");return e}_extractIdField(t){return this._stringRight(t,"_")}_stringRight(t,e){if(null==t||""==t)return t;var i=t.indexOf(e);return t.substring(i+e.length,t.length)}_extactFromType(t){let e=t.split("_")[0];switch(e){case"kj":case"edit":case"new_inp":break;case"ni":e="new_inp";break;default:throw new Error("CBON210604E")}return e}getOuterName(t){let e=this.box[t],i=e.outerIdElm,a=i.val();if(a=a.trim(),""==a)return;if(a=this._hankaku2Zenkaku(a),isNaN(a))return void alert("半角数値を入力してください。");let r=i.attr("id");if(null==r&&(r=i.attr("name")),null==r)throw new Exception("システムエラー CBON210604A");"kj_"==r.substr(0,3)&&(r=r.substr(3));let s=this.crudBaseData.model_name_s,l=this.crudBaseData.crud_base_project_path+"/"+s+"/getOuterName",n={outer_id:a,outer_id_field:r},o=new FormData,h=JSON.stringify(n);o.append("key1",h);let d=this.crudBaseData.csrf_token;o.append("csrf_token",d),jQuery.ajax({type:"post",url:l,data:o,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,i)=>{let a;try{a=jQuery.parseJSON(t)}catch(e){return void jQuery("#err").append(t)}let r=a.outer_name;r=this._xss_sanitize(r),""==r&&(r="一致はありません"),e.outerNameElm.html(r)})).fail(((t,e,i)=>{let a=jQuery("#err");a.append("アクセスエラー"),a.append(t.responseText),alert(e)}))}clear(){jQuery(".OuterName-outer_name").each(((t,e)=>{jQuery(e).html("")}))}_hankaku2Zenkaku(t){return t.replace(/[Ａ-Ｚａ-ｚ０-９]/g,(function(t){return String.fromCharCode(t.charCodeAt(0)-65248)}))}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=this._xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}newInpShow(){this._show(null,"new_inp")}editShow(t){this._show(t,"edit")}_show(t,e){for(let i in this.box){let a=this.box[i],r=a.ent,s=r.outer_name_field;if(r.form_type==e){let e=a.outerNameElm,i="";t&&(i=t[s]),null==i&&(i=""),e.html(i)}}}}class CrudBasePasswordEdit{constructor(t,e,i){this.newInpForm=t,this.editForm=e,this.param=this._setParamIfEmpty(i);var a=[];a=this._getPwElmsFromNewInp(a,t,"new_inp"),a=this._getPwElmsFromNewInp(a,e,"edit"),a=this._createPwChgbtns(a),this._setClickEventToBtn(a),this.data=a}_setParamIfEmpty(t){return null==t&&(t={}),t}_getPwElmsFromNewInp(t,e,i){var a=e.find("input[name='password']");return a[0]?(a.each(((e,a)=>{var r={pwElm:jQuery(a),pw_index:e,form_type:i};t.push(r)})),t):t}_createPwChgbtns(t){for(var e in t){var i=t[e],a=i.form_type,r=i.pw_index,s=`<input type="button" id="${"cbpe_"+a+r}" value="パスワード変更" data-form-type="${a}" data-pw-index="${r}" class="btn btn-warning btn-sm" />`;i.pwElm.after(s);var l=this._getBtnElm(a,r);i.btnElm=l}return t}_getBtnElm(t,e){var i=null;"new_inp"==t&&(i=this.newInpForm),"copy"==t&&(i=this.newInpForm),"edit"==t&&(i=this.editForm);var a="cbpe_"+t+e;return i.find("#"+a)}_setClickEventToBtn(t){for(var e in t){t[e].btnElm.click((t=>{this.clickPwChgbtn(this,t.currentTarget)}))}}clickPwChgbtn(t,e){var i=(e=jQuery(e)).attr("data-form-type"),a=e.attr("data-pw-index"),r=this._getEntity(i,a);if(null!=r){var s=r.pwElm;s.val(""),s.show(),(e=r.btnElm).hide()}}_getEntity(t,e){for(var i in this.data){var a=this.data[i];if(a.form_type==t&&a.pw_index==e)return a}return null}showForm(t){0!=this.data.length&&("new_inp"==t?this._changeForNewInp(t):this._changeForEditAndCopy(t))}_changeForNewInp(t){for(var e in this.data){var i=this.data[e];if(i.form_type==t)i.btnElm.hide(),i.pwElm.show()}}_changeForEditAndCopy(t){for(var e in this.data){var i=this.data[e];i.btnElm.show(),i.pwElm.hide()}}}class CrudBaseReact{constructor(t){}_setParamIfEmpty(t){return null==t&&(t={}),t}init(t,e){this.fields=t;var i=e.split(",");for(var a in i){var r=i[a];i[a]=r.trim()}this.hyoIds=i}reactivatingOfRow(){}}
/**
 * 
 * 行入替機能
 * 
 * @note
 * テーブルの行を入れ替えることによる並べ替え
 * 
 * @version 1.2.1 Bootstrap4に対応
 * @since 2017-3-7 | 2021-10-7
 * @license MIT
 * 
 */class CrudBaseRowExchange{constructor(t,e,i){null==e&&(e={});var a=t.param.tbl_slt;this.afterCallback=i,this.tbl=t.tbl;var r="#exchange_tr_form_"+a;e.form_slt=r;var s=this._getFormHtml(r);this.tbl.after(s),this.form=jQuery(r),this.param=e,this.crudBaseData=t.param,this.form.find(".exchange_tr_form_close").click((()=>{this.form.hide()})),this.form.find(".exchange_tr_btn").click((()=>{this._exchageTrReb()})),jQuery(r+" input").keypress((t=>{13==t.which&&this._exchageTrReb()})),this.form.find(".exchange_tr_shift_up").click((()=>{this._exchageTrShiftUp()})),this.form.find(".exchange_tr_shift_down").click((()=>{this._exchageTrShiftDown()}))}showForm(t){var e=jQuery(t),i=e.parents("tr").index();i+=1,this.param.from_row_index=i;var a=this.form.find(".exchange_tr_sort_no"),r=a.val();this._empty(r)&&a.val(i),this._showForm(this.form,e)}_exchageTrReb(){var t=this.param.from_row_index,e=this.form.find(".exchange_tr_sort_no").val();0!=this._checkRowIndex(e)&&t!=e&&this._exchageTr(t,e)}_exchageTrShiftUp(){var t=this.param.from_row_index,e=t-1;e<=0||(this._exchageTr(t,e),this.param.from_row_index=e)}_exchageTrShiftDown(){var t=this.param.from_row_index,e=t+1;e>this.tbl.children("tbody").children("tr").length||(this._exchageTr(t,e),this.param.from_row_index=e)}_exchageTr(t,e){var i=this.tbl.find("tr").eq(t),a=this.tbl.find("tr").eq(e);t>e?jQuery(a).before(i):jQuery(a).after(i),this.afterCallback&&this.afterCallback({from_row_index:t,to_row_index:e})}_checkRowIndex(t){return null!=t&&(!!t.match(/^[0-9]*$/)&&!(t<=0))}_showForm(t,e,i){i||(i="auto"),t.show();var a=(e=jQuery(e)).offset(),r=a.left,s=a.top,l=jQuery(window).width(),n=t.outerWidth(),o=s+e.outerHeight(),h=0;switch(i){case"left":h=r-n;break;case"center":h=l/2-n/2;break;case"right":h=r;break;default:(h=r)+n>l&&(h=l-n)}h<0&&(h=0),t.offset({top:o,left:h})}_getFormHtml(t){var e=this._sltToCode(t);return"<div id='"+e+"_rap'>\t<div id='"+e+"' class='card' style='display:none;width:200px;background-color:white'>\t\t<div class='card-header bg-primary'>\t\t\t\t\t\t<div class='text-light' style='display:inline-block;width:60%'>行入替</div>\t\t\t<div class='text-light' style='display:inline-block;width:35%;text-align:right'>\t\t\t\t<button type='button' class='exchange_tr_form_close btn btn-primary btn-sm'  aria-label='閉じる'>\t\t\t\t\t<span class='oi' data-glyph='x'></span>\t\t\t\t</button>\t\t\t</div>\t\t</div>\t\t<div class='card-body' \">\t\t\t<button type='button' class='exchange_tr_shift_up btn btn-primary btn-sm' style='font-weight:bold;' title='一つ上に移動します。'><span class='oi' data-glyph='arrow-thick-top'></span></button>\t\t\t<button type='button' class='exchange_tr_shift_down btn btn-primary btn-sm' style='font-weight:bold;' title='一つ下に移動します。'><span class='oi' data-glyph='arrow-thick-bottom'></span></button>\t\t\t<div style='margin-top:20px'>\t\t\t\t<input class='exchange_tr_sort_no' type='number' style='width:60px' min='1' max='9999'  title='移動したい行の位置を数値で入力してください。先頭に移動させたい場合は1を入力して行入替ボタンを押します。上から3番目に移動させたい場合は3を入力します。' />\t\t\t\t<input type='button' value='行入替' class='exchange_tr_btn btn btn-warning btn-sm' />\t\t\t</div>\t\t</div>\t</div></div>"}_sltToCode(t){var e=t,i=e.charAt(0);return"#"!=i&&"."!=i||(e=e.substr(1)),e}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}
/**
 * テキストエリア高さ自動調整クラス
 * @date 2021-6-10
 * @license MIT
 * @version 1.0.0
 */class CrudBaseTaAutoHeightSize{init(){jQuery(".auto_height_size").each(((t,e)=>{let i=jQuery(e);i.attr("rows",1).on("input",(t=>{jQuery(t.target).height(0).innerHeight(t.target.scrollHeight)})),i.attr("rows",1).click("input",(t=>{jQuery(t.target).height(0).innerHeight(t.target.scrollHeight)}))}))}editShow(t){t.find(".auto_height_size").each(((t,e)=>{jQuery(e).click()}))}copyShow(t){t.find(".auto_height_size").each(((t,e)=>{jQuery(e).click()}))}newInpShow(t){t.find(".auto_height_size").each(((t,e)=>{jQuery(e).click()}))}}
/**
 * バリデーション関数群
 * 
 * @note
 * InputCheckAの後継
 * 
 * @version 5.0.1
 * @date 2009-7-9 | 2020-4-15
 * @license MIT
 */class CrudBaseValidation{isMaxLength(t,e,i){return(1!=i||null!=t&&""!==t&&!1!==t)&&!(t.length>e)}isNaturalNumber(t){return!!/^[0-9]*$/.test(t)}isInteger(t){if(null===t)return!0;if(""===t)return!0;if(Number.isNaN(t))return!1;let e=Number(t);return!!Number.isInteger(e)}isDate(t){var e=t.split("/");if(3!=e.length&&3!=(e=t.split("-")).length)return!1;let i=e[0],a=e[1],r=e[2],s=/^[0-9]*$/;if(!s.test(i))return!1;if(!s.test(a))return!1;if(!s.test(r))return!1;var l=new Date(i,a-1,r);return l.getFullYear()==i&&l.getMonth()==a-1&&l.getDate()==r}isKatakana(t){return!!/^[ァ-ヶー]*$/.test(t)}isHiragana(t){return!!/^[ぁ-んー]*$/.test(t)}isMail(t){return!!/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/.test(t)}isTell(t){return!!/^[0-9+-]*$/.test(t)}isPost(t){let e=/^\d{3}-?\d{4}$/;return!(!e.test(t)&&(e=/^¥d{7}$/,!e.test(t)))}isPassword(t){return!!/^(?=.*?[a-zA-Z])(?=.*?\d)[a-zA-Z\d]{8,100}$/.test(t)}isAlphaNum(t){return!!/^[a-zA-Z0-9_\-]+$/.test(t)}}
/**
 * CrudBaseバリデーション・jQuery版
 * 
 * @date 2020-8-26
 * @version 1.0.0
 * @license MIT
 * 
 */class CrudBaseValidationJQuery{constructor(t,e,i,a){this.validMethods=i;let r=Object.keys(i);"undefined"==typeof cbv?this.cbv=new CrudBaseValidation:this.cbv=cbv;let s=jQuery(t);if(!s[0])throw new Error(t+" is none.");let l=this._getInpElms(s,r),n=this._getErrElms(s,r),o=this._filterInpElms(l,["text","number"]);this._addChangeEvent(o),this.perElm=s,this.kjFields=r,this.inpElms=o,this.errElms=n}_addChangeEvent(t,e){for(let e in t){t[e].change((t=>{let e=jQuery(t.currentTarget);this._validationEvent(e)}))}}_validationEvent(t){let e=t.attr("id"),i=t.val(),a=this.validMethods[e],r="";if(null==a)throw new Error("バリデーションメソッドがありません。"+e);return r=a(this.cbv,i),this.errElms[e].html(r),r}_filterInpElms(t,e){let i={};for(let a in t){let r=t[a];if(!r[0])continue;let s=r.attr("type");-1!=e.indexOf(s)&&(i[a]=r)}return i}_getInpElms(t,e){let i={};for(let a in e){let r=e[a],s="#"+r;i[r]=t.find(s)}return i}_getErrElms(t,e){let i={};for(let a in e){let r=e[a],s="#"+r+"_err";i[r]=t.find(s)}return i}checkAll(){let t="";for(let e in this.inpElms){let i=this.inpElms[e];t+=this._validationEvent(i)}return this._empty(t)&&(t=!1),t}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}
/**
 * CrudBase validation for Vue.js
 * @since 2020-4-4
 * @license MIT
 * @auther Kenji Uehara
 */class CrudBaseValidationVue{init(t,e){this.ent=t,this.methods=e,this.valids=this._makeValidErrMsgs(t)}setVueApp(t){this.vueApp=t}_makeValidErrMsgs(t){let e={};for(let i in t)e[i]="";return e}validationAll(t){for(let e in this.methods){let i=this.methods[e];null!=i&&i(t[e])}return this._judgErr()}_judgErr(){let t=this.vueApp.valids;for(let e in t){let i=t[e];if(!this._empty(i))return!1}return!0}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}class CsvExin{init(t,e){this.mainElm=jQuery("#csv_exin"),this.csvFieldData=t,this.csvParam=this._setParamIfEmpty(e),this.data;this.mainElm.html('\n\t\t\t<div id="csv_exin_step1">\n\t\t\t\t<label><input type="radio" name="csv_exin_str_code" value=\'utf-8\' checked />UTF-8</label>\n\t\t\t\t<label style="font-weight:normal;color:#808080" title="iosの波ダッシュ「〜」はWindowsのShift-jisにおいて文字化けします。">\n\t\t\t\t\t<input type="radio" name="csv_exin_str_code" value=\'Shift_JIS\' />Shift-Jis(非推奨)</label>\n\t\t\t\t<input id="csv_exin_file" type="file" multiple >\n\t\t\t</div>\n\t\t\t<aside>基本的に上書きでDB登録されますが、idが空のレコードもしくはDBに存在しないidのレコードは「新規追加」になります。</aside>\n\t\t\t<div id="csv_exin_step2" style="display:none">\n\t\t\t\t<input id="csv_bulk_reg_btn" type="button" value="一括登録" class="btn btn-danger btn-sm" />\n\t\t\t\t<input id="csv_exin_retry_btn" type="button" value="やり直し" class="btn btn-default btn-xs" />\n\t\t\t</div>\n\t\t\t<div id="csv_exin_err" style="color:red"></div>\n\t\t\t<div id="csv_exin_success" class="text-success"></div>\n\t\t\t<div id="csv_exin_preview" style="overflow:auto;height:400px;display:none"></div>\n\t\t'),this.bulkRegBtn=this.mainElm.find("#csv_bulk_reg_btn"),this._addEventStrCodeRadioClick(),this._addEventRetryBtn(),this._addEventFileChange(),this._addEventBulkReg()}_setParamIfEmpty(t){return null==t&&(t={}),null==t.ajax_url&&(t.ajax_url="dummy"),t}_addEventFileChange(){this.mainElm.find("#csv_exin_file").change((t=>{var e=t.target.files[0],i=new FileReader;i.readAsText(e,this.csvParam.str_code),i.onload=t=>{var e=t.target.result;this._preview(e)}}))}_addEventBulkReg(){this.mainElm.find("#csv_bulk_reg_btn").click((t=>{this._bulkReg()}))}_preview(t){var e=this.csvFieldData,i=this.csvParam;this._errShow(""),this.mainElm.find("#csv_exin_step1").hide(),this.mainElm.find("#csv_exin_step2").show();var a=this._csvTextToData(t),r=this._checkD2ary(a);if(r)this._errShow(r);else{var s=this._getClmHederFlgEtc(a,e);i.clm_header_flg=s.clm_header_flg,i.id_clm_flg=s.id_clm_flg;var l=a[0],n=this._makeIndexHashmap(l,e);if(r=this._checkClmName(l,e,n))this._errShow(r);else{var o=this._createDataFromD2ary(a,e,n);this.data=o;var h=$.extend(!0,{},o);h=this._xss_sanitize(h);var d=this._makeTableHtml(h,e,n),_=this.mainElm.find("#csv_exin_preview");_.show(),_.html(d),this.bulkRegBtn.show()}}}_getClmHederFlgEtc(t,e){var i={clm_header_flg:0,id_clm_flg:0},a=t[0][0];return 0==isNaN(a)?(i.id_clm_flg=1,i):"id"==a.toLowerCase()?(i.clm_header_flg=1,i.id_clm_flg=1,i):a==e[1].clm_name?(i.clm_header_flg=1,i):i}_createDataFromD2ary(t,e,i){var a=[];for(var r in t)if(0!=r){var s=t[r],l={};for(var n in i){var o=e[i[n]].field,h=s[n];l[o]=h}a.push(l)}return a}_makeIndexHashmap(t,e){var i={};for(var a in t){var r=t[a];for(var s in r=r.trim(),e){var l=e[s];if(l.clm_name==r)i[a]=s;else{if(null==l.clm_alias_names)continue;for(var n in l.clm_alias_names){var o=l.clm_alias_names[n];null!=o&&""!=o&&(o!=r||(i[a]=s))}}}}return i}_checkClmName(t,e,i){var a=null;for(var r in t){var s=t[r],l=0;for(var n in t){s==t[n]&&l++}if(l>=2)return a="列名「"+s+"」が重複しています。同じ列名は使えません"}var o={};for(var h in i){o[_=i[h]]=h}var d=[];for(var _ in e)if(null==o[_]){var c=e[_];1==c.req_flg&&d.push(c.clm_name)}d.length>0&&(a="次の列名は必須です。→"+d.join(","));return a}_addEventStrCodeRadioClick(){this.mainElm.find("input[name='csv_exin_str_code']").click((t=>{var e=$(t.currentTarget);this.csvParam.str_code=e.val(),this.mainElm.find("#csv_exin_file").prop("disabled",!1)}))}_addEventRetryBtn(){this.mainElm.find("#csv_exin_retry_btn").click((t=>{this.mainElm.find("#csv_exin_file").val(""),this.mainElm.find("#csv_exin_step1").show(),this.mainElm.find("#csv_exin_step2").hide(),this.mainElm.find("#csv_exin_err").html("");var e=this.mainElm.find("#csv_exin_preview");e.hide(),e.html("")}))}_csvTextToData(t){if(""==t||null==t)return null;t[t.length-1].match(/\r|\n/)||(t+="\n");for(var e=[],i=t.length,a=0,r="",s=[],l=0;l<i;l++){var n=t[l];if(0==a)if('"'==n)a=1;else if(","==n)s.push(r),r="";else if(n.match(/\r|\n/)){if(s.push(r),e.push(s),r="",s=[],l<i-1)t[l+1].match(/\r|\n/)&&l++}else r+=n;else if('"'==n){if(l<i-1)'""'==n+t[l+1]?(r+='"',l++):a=0}else r+=n}return e}_checkD2ary(t){return null==t||0==t.length?"CSVのデータが空です。":0==t[0].length||1==t[0].length?"対象のCSVファイルではありません。":null}_makeTableHtml(t,e,i){var a="<table id='csv_exin_table' class='tbl2' style='white-space:nowrap;'>";for(var r in a+="<thead><tr>",i){a+="<th>"+e[i[r]].clm_name+"</th>"}for(var s in a+="</tr></thead><tbody>",t){var l=t[s];for(var n in a+="<tr>",l){var o=l[n];"string"==typeof o&&(o=o.replace(/\r\n|\r|\n/g,"<br>")),null==o&&(o=""),a+="<td>"+o+"</td>"}a+="</tr>"}return a+="</tbody></table>"}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=this._xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_errShow(t){this.mainElm.find("#csv_exin_err").html(t),this.bulkRegBtn.hide()}_bulkReg(){var t=this.csvParam,e=this.data,i={data:e=this._ampTo26(e),csvFieldData:this.csvFieldData,csvParam:this.csvParam},a=JSON.stringify(i);this.mainElm.find("#csv_exin_success").html("登録中です..."),jQuery.ajax({type:"POST",url:t.ajax_url,data:"key1="+a,cache:!1,dataType:"text"}).done(((t,e)=>{var i;try{i=jQuery.parseJSON(t),console.log(i),location.reload(!0)}catch(e){return void this._errShow(t)}console.log(i)})).fail(((t,e,i)=>{this._errShow(t.responseText),alert(e)}))}_ampTo26(t){if("string"==typeof t)return-1!=t.indexOf("&")?t.replace(/&/g,"%26"):-1!=t.indexOf("%")?t.replace(/%/g,"%25"):t;if("object"==typeof t){for(var e in t)t[e]=this._ampTo26(t[e]);return t}return t}}
/**
 * CSVフィールドデータ補助クラス
 * 
 * @version 0.9.1
 * @date 2019-6-28 | 2019-8-13
 * @auther kenji uehara
 * @license MIT
 */class CsvFieldDataSupport{normalizeCsvFieldData(t,e){for(let i in t){let a=t[i];if(null==a.field)throw new Error("CsvFieldData: 'field' is empty!");if(null==a.clm_name&&null==a.wamei)throw Error("CsvFieldData: clm_name and wamei is empty!");if(null==a.clm_name&&null!=a.wamei&&(a.clm_name=a.wamei),null!=a.clm_name&&null==a.wamei&&(a.wamei=a.clm_name),null==a.clm_alias_names&&(a.clm_alias_names=null),null==a.req_flg&&(a.req_flg=!1),null==a.req_clm&&(a.req_clm=a.req_flg),null==a.join_type&&(a.join_type=null),null==a.id_field&&(null!=a.join_type?a.id_field=a.field.replace("_name","_id"):a.id_field=null),null==a.model_name&&null==a.master&&null==a.tbl_name){let t=this._tblNameToModelName(e);a.model_name=t,a.master=t,a.tbl_name=e}else{let t=this._getTblNames(a),e=t.model_name,i=t.tbl_name;null==a.model_name&&(a.model_name=e),null==a.master&&(a.master=e),null==a.tbl_name&&(a.tbl_name=i)}if("const"==a.join_type){if(null==a.idMap)throw new Error(`CsvFieldData: ${a.field}: ipMap is empty!`)}else a.idMap=null;null==a.import_flg&&(a.import_flg=!0),null==a.export_flg&&(a.export_flg=!0),null==a.inp_type&&(null==a.id_field?a.inp_type="text":a.inp_type="select")}return t}_tblNameToModelName(t){return""==t||null==t?"":("s"==(t=(t=t.replace(/_./g,(function(t){return t.charAt(1).toUpperCase()}))).charAt(0).toUpperCase()+t.slice(1)).slice(-1)&&(t=t.substr(0,t.length-1)),t)}_modelNameToTblName(t){return""==t||null==t?"":(t=(t=t.charAt(0).toLowerCase()+t.slice(1)).replace(/([A-Z])/g,(function(t){return"_"+t.charAt(0).toLowerCase()})),t+="s")}_getTblNames(t){let e=t.tbl_name,i=t.model_name;return null==i&&(i=t.master),null==e&&(e=this._modelNameToTblName(i)),null==i&&(i=this._tblNameToModelName(e)),{tbl_name:e,model_name:i}}}class DatepickerWrap{constructor(t){null!=jQuery.datepicker&&(this.param=this._setParamIfEmpty(t),1==t.ja_flg&&this.datepicker_ja(),this._datepickerApply(),this._datetimepickerApply(),this._ympickerApply())}_setParamIfEmpty(t){return null==t&&(t={}),null==t.ja_flg&&(t.ja_flg=1),null==t.datetimepicker_f&&(t.datetimepicker_f=0),t}_datepickerApply(){jQuery(".datepicker").each(((t,e)=>{jQuery(e).datepicker({dateFormat:"yy-mm-dd"})}))}_datetimepickerApply(){0!=this.param.datetimepicker_f&&jQuery(".datetimepicker").each(((t,e)=>{jQuery(e).datetimepicker({dateFormat:"Y-m-d H:i"})}))}_ympickerApply(){var t={closeText:"閉じる",prevText:"&#x3c;前",nextText:"次&#x3e;",currentText:"今日",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dateFormat:"yy/mm",yearSuffix:"年",onSelect:function(t,e){}};jQuery(".ympicker").each(((e,i)=>{jQuery(i).ympicker(t)}))}tukishomatu(t,e,i){var a={closeText:"閉じる",prevText:"&#x3c;前",nextText:"次&#x3e;",currentText:"今日",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dateFormat:"yy/mm",yearSuffix:"年",onSelect:function(t,a){var r=t+"/1";jQuery("#"+e).val(r);var s=new Date(r),l=DateFormat(l=new Date(s.getFullYear(),s.getMonth()+1,0),"yyyy/mm/dd");jQuery("#"+i).val(l)}};jQuery("#"+t).ympicker(a),jQuery("#"+t).blur((function(){var a=jQuery("#"+t).val();""!=a&&null!=a||(jQuery("#"+e).val(""),jQuery("#"+i).val(""))}))}datepicker_ja(){jQuery.datepicker.regional.ja={closeText:"閉じる",prevText:"<前",nextText:"次>",currentText:"今日",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayNames:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"],dayNamesShort:["日","月","火","水","木","金","土"],dayNamesMin:["日","月","火","水","木","金","土"],weekHeader:"週",dateFormat:"yy/mm/dd",firstDay:0,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"年"},jQuery.datepicker.setDefaults(jQuery.datepicker.regional.ja)}}function dateFormat(t,e){if(null==t&&(t=(new Date).toLocaleString()),null==e&&(e="Y-m-d"),"string"==typeof t&&"Invalid Date"==(t=new Date(t)))return null;var i=t.getFullYear(),a=t.getMonth()+1;a=("0"+a).slice(-2);var r=t.getDate();r=("0"+r).slice(-2);var s=t.getHours();s=("0"+s).slice(-2);var l=t.getMinutes();l=("0"+l).slice(-2);var n=t.getSeconds();n=("0"+n).slice(-2);var o=e;return o=(o=(o=(o=(o=(o=o.replace("Y",i)).replace("m",a)).replace("d",r)).replace("h",s)).replace("i",l)).replace("s",n)}function DateFormat(t,e){var i,a,r=e,s=new Array("日","月","火","水","木","金","土");return i="yyyy",r.indexOf(i)>-1&&(a=t.getFullYear(),r=r.replace(/yyyy/,a)),i="mm",r.indexOf(i)>-1&&(a=PadZero(t.getMonth()+1,2),r=r.replace(/mm/,a)),i="ddd",r.indexOf(i)>-1&&(a=s[t.getDay()],r=r.replace(/ddd/,a)),i="dd",r.indexOf(i)>-1&&(a=PadZero(t.getDate(),2),r=r.replace(/dd/,a)),i="hh",r.indexOf(i)>-1&&(a=PadZero(t.getHours(),2),r=r.replace(/hh/,a)),i="ii",r.indexOf(i)>-1&&(a=PadZero(t.getMinutes(),2),r=r.replace(/ii/,a)),i="ss",r.indexOf(i)>-1&&(a=PadZero(t.getSeconds(),2),r=r.replace(/ss/,a)),i="fff",r.indexOf(i)>-1&&(a=PadZero(t.getMilliseconds(),3),r=r.replace(/fff/,a)),r}function DateParse(t,e){var i,a,r="1990",s="01",l="01",n="00",o="00",h="00",d="000";return i="yyyy",(a=e.indexOf(i))>-1&&(r=t.substr(a,i.length)),i="MM",(a=e.indexOf(i))>-1&&(s=parseInt(t.substr(a,i.length),10)-1),i="dd",(a=e.indexOf(i))>-1&&(l=t.substr(a,i.length)),i="HH",(a=e.indexOf(i))>-1&&(n=t.substr(a,i.length)),i="mm",(a=e.indexOf(i))>-1&&(o=t.substr(a,i.length)),i="ss",(a=e.indexOf(i))>-1&&(h=t.substr(a,i.length)),i="fff",(a=e.indexOf(i))>-1&&(d=t.substr(a,i.length)),new Date(r,s,l,n,o,h,d)}function PadZero(t,e){return new Array(e-(""+t).length+1).join("0")+t}
/**
 * ファイルアップロードの拡張クラス
 * 
 * @note
 * DnD（ドラッグ&ドロップに対応。
 * アップロード区分のドレスアップ。
 * エンティティなどのデータも一緒に送信。
 * 複数のファイルをアップロードできる。
 * 複数のファイルアップロード要素に対応。
 * 進捗バーの表示
 * ファイルの初期表示
 * 
 * @license MIT
 * @version 1.3.7
 * @date 2018-7-6 | 2021-6-11
 * @history 
 *  - 2021-04-29 var 1.3.0 大幅なバージョンアップ
 *  - 2018-10-2 var 1.2.6 「Now Loading...」メッセージを表示する
 *  - 2018-9-18 var 1.2.5 コールバックパラメータを追加（pacb_param)
 *  - 2018-9-18 var 1.2.4 fuk_preview要素のstyle属性を修正
 *  - 2018-9-18 var 1.2.3 クリアのバグを修正
 *  - 2018-8-27 ver 1.2.2 setFilePaths:ファイル名空に対応
 *  - 2018-8-14 ver 1.2.0 ファイルの初期表示
 *  - 2018-8-11 ver 1.1
 *  - 2018-8-7 リリース
 *  - 2018-7-6 新規作成
 * 
 */class FileUploadK{constructor(t,e){null==e&&(e={}),this.callbacks=e,this.active_fue_id,this.box={},this.mimeMap=this._getMimeMapping(),this.param=this._setParamIfEmpty(t),this.unit=jQuery(this.param.unit_slt),this.cbAsynsEnd}_setParamIfEmpty(t){null==t&&(t={}),null==t.ajax_url&&(t.ajax_url=null),null==t.style_flg&&(t.style_flg=1),null==t.unit_slt&&(t.unit_slt="body"),null==t.err_slt&&(t.err_slt="#err"),null==t.valid_mime_flg&&(t.valid_mime_flg=0),null==t.img_width&&(t.img_width=null),null==t.img_height&&(t.img_height=null),null==t.adf&&(t.adf={fn_flg:1,size_flg:1,mime_flg:1,modified_flg:1}),null==t.max_size&&(t.max_size=5e6);var e=null;return null!=t.valid_ext&&(e=t.valid_ext),t.validData=this._createValidData(e,t.max_size),t}addEvent(t,e){null==e&&(e={});var i=this._getElement(t,"label");i.attr("data-fue-id",t);var a=this._setToBox(t,this.box,e);this._addRelatedElements(i,t,a),this._applyStyle(t),i[0].addEventListener("drop",(i=>{i.stopPropagation(),i.preventDefault();var a=i.dataTransfer.files;this.box[t].files=a,this._preview(t,"files","dnd",e),null!=this.callbacks.fileputEvent&&this.callbacks.fileputEvent(this.box)}),!1),i[0].addEventListener("dragover",(t=>{t.preventDefault()}),!1),this._getElement(t,"fue").change((i=>{var a=i.target.files;null!=a&&0!=a.length&&(this.box[t].files=a,this._preview(t,"files","change",e),null!=this.callbacks.fileputEvent&&this.callbacks.fileputEvent(this.box))})),this._getElement(t,"clear_btn").click((t=>{this._clearBtnClick(t)}))}setFilePaths(t,e,i){if(null==i&&(i={}),this._clearBtnAction(t),"string"==typeof e){if(""==this._getExtension(e))return}if(null!=e&&""!=e&&0!=e){"string"==typeof e&&(e=[e]);var a=[];i.pacb=()=>{this.box[t].bData=a,this._preview(t,"blob","set_file_path",i)},this._cbAsynsEndInit(e.length,i);var r="";for(var s in i.midway_dp&&(r=i.midway_dp),e){var l=r+e[s];this._preloadByXhr(l,a)}}}_preloadByXhr(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onload=t=>{if("404"==t.currentTarget.status)throw new Error("ファイルが見つかりません。パスを確認してください。");this._xhrOnload(t,i,e)},i.send()}_xhrOnload(t,e,i){var a=t.target.response,r=t.target.responseURL,s=this._stringRightRev(r,"/"),l=e.getResponseHeader("Content-Type"),n=e.getResponseHeader("Content-Length"),o=(e.getResponseHeader("server"),{fn:s,mime_type:l,size:n,modified:e.getResponseHeader("Last-Modified"),blob:a});i.push(o),this._cbAsynsEndAction("exe1")}_addRelatedElements(t,e,i){let a=`\n\t\t\t<div class='fuk_box1'>\n\t\t\t\t<div class='fuk_preview' style='display:inline-block'></div>\n\t\t\t\t<div class='fuk_clear_btn_w'>\n\t\t\t\t\t<input type='button' value='Clear' class='btn btn-secondary btn-sm fuk_clear_btn' data-fue-id='${e}' />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;t.append(a)}_applyStyle(t){this.param.style_flg&&this._getElement(t,"label").addClass("fuk")}_preview(t,e,i,a){this.active_fue_id=t;var r=null,s=null,l=[];if("files"==e){r=this.box[t].files;l=this._getFileDataFromFiles(r)}else{if("blob"!=e)throw new Error("Unknown 'bin_type'");s=this.box[t].bData,l=this._getFileDataFromBData(s)}if(!this._checkFnsEmpty(l)){this._getElement(t,"label").css({width:"auto",height:"auto"}),this._getElement(t,"clear_btn_w").show(),l=this._validCheck(t,l,i),this.box[t].fileData=l;var n="";for(var o in l){var h=l[o];n+=this._makeFileUnitHtml(t,h,a)}var d=this._getElement(t,"preview");d[0]&&d.html(n);var _={};if(d.children("div").each(((t,e)=>{var i=(e=jQuery(e)).find(".fuk_rp");i[0]?_[t]=i:_[t]=null})),l=this._filteringFileData(l,_),"files"==e){for(var o in this._cbAsynsEndInit(l.length,a),l){var c=r[p=(h=l[o]).index];this._setupRender(c,_,p)}this._cbAsynsEndAction("exe2")}else if("blob"==e){for(var o in l){var p,u=s[p=(h=l[o]).index].blob,m=window.URL.createObjectURL(u);_[p].attr("src",m)}this._cbAsynsEndAction("exe2")}}}_checkFnsEmpty(t){for(var e in t){if(t[e].fn)return!1}return!0}_filteringFileData(t,e){var i=[];for(var a in t)if(null!=e[a]){var r=t[a];1!=r.err_flg&&null!=r.size&&0!=r.size&&(r.index=a,i.push(r))}return i}_setupRender(t,e,i){var a=new FileReader;a.readAsDataURL(t),a.onload=t=>{e[i].attr("src",a.result),this._cbAsynsEndAction("exe1")}}_getFileDataFromFiles(t){var e=[];for(var i in t){var a=t[i];if(null!=a.size){var r={},s=a.type;r.mime=s;var l="";null!=s&&(s.indexOf("image")>=0&&(l="image"),s.indexOf("audio")>=0&&(l="audio")),r.file_type=l;var n="";null!=a.name&&(n=a.name),r.fn=n,r.size=a.size;var o=0;null!=a.size&&(o=a.size),isNaN(o)||(o=this._convSizeUnit(o)),r.size_str=o;var h="";null!=a.lastModifiedDate&&(h=a.lastModifiedDate.toLocaleString()),r.modified=h,e.push(r)}}return e}_getFileDataFromBData(t){var e=[];for(var i in t){var a=t[i];if(null!=a.size&&0!=a){var r={};r.mime=a.mime_type;var s="";null!=r.mime&&(r.mime.indexOf("image")>=0&&(s="image"),r.mime.indexOf("audio")>=0&&(s="audio")),r.file_type=s,r.fn=a.fn,r.size=a.size;var l=0;null!=a.size&&(l=a.size),isNaN(l)||(l=this._convSizeUnit(l)),r.size_str=l;var n="";null!=a.modified&&(n=new Date(n).toLocaleString()),r.modified=n,e.push(r)}}return e}_validCheck(t,e,i){if(null==t)return e;var a=this.box[t].validData,r=a.validExts,s=!0;for(var l in null!=r&&0!=r||(s=!1),e){var n=e[l];if("set_file_path"==i){n.err_flg=!1;continue}if(0==s){n.err_flg=!1;continue}var o=n.fn;if(""==o||null==o){n.err_flg=!0,n.err_msg="ファイル名が空です。",n.fn_empty=!0;continue}var h=this._getExtension(n.fn);if(-1==r.indexOf(h)){n.err_flg=!0,n.err_msg=o+"の拡張子は対象外です。";continue}n.err_flg=!1,n=this._validCheckMime(t,n);let d=Number(n.size),_=Number(a.max_size);if(d>_){n.err_flg=!0;let t=this._convSizeUnit(_,0);n.err_msg=`ファイルサイズが制限を超えています。(最大${t}まで)`}else n.err_flg=!1}return e}_getExtension(t){if(null==t||""==t)return"";if(-1==t.indexOf("."))return"";let e=t.split("."),i=e[e.length-1];return i=i.toLowerCase(),i}_validCheckMime(t,e){if(0==this.param.valid_mime_flg)return e;if(1==e.err_flg)return e;var i=this.box[t].validData.validMimes,a=e.mime;return-1==i.indexOf(a)?(e.err_flg=!0,e.err_msg=e.fn+"のMIME("+a+")は対象外です。"):e.err_flg=!1,e}_makeFileUnitHtml(t,e,i){var a="";if(1==e.err_flg)return a="<div class='fuk_file_unit' >"+(a="<div class='fuk_err_msg'>"+e.err_msg+"</div>")+"</div>";"image"==e.file_type?a+="<img src='' class='fuk_rp' style='width:100%;height:100%' />":"audio"==e.file_type&&(a+="<audio src='' class='fuk_rp' controls />");var r=this.param.adf,s=[{label:"ファイル名",val:e.fn,flg:r.fn_flg},{label:"サイズ",val:e.size_str,flg:r.size_flg},{label:"MIME",val:e.mime,flg:r.mime_flg},{label:"更新日",val:e.modified,flg:r.modified_flg}];let l="";for(var n in s){var o=s[n];1==o.flg&&(l+=`\n\t\t\t\t\t<div><label class='fuk_param_label'>${o.label}</label>\n\t\t\t\t\t<val class='fuk_param_val'>${o.val}</val></div>\n\t\t\t\t`)}return a=`\n\t\t\t<div class='fuk_file_unit' >\n\t\t\t\t<div class='fuk_file_view'>${a}</div>\n\t\t\t\t<div class='fuk_params'>${l}</div>\n\t\t\t</div>\n\t\t\t`}_getImgSize(t,e){return{width:e.img_width?e.img_width:this.param.img_width?this.param.img_width:this.box[t].label_width?this.box[t].label_width:160,height:e.img_height?e.img_height:this.param.img_height?this.param.img_height:this.box[t].label_height?this.box[t].label_height:160}}_clearBtnClick(t){var e=jQuery(t.currentTarget).attr("data-fue-id");this._clearBtnAction(e)}_clearBtnAction(t){this._getElement(t,"clear_btn_w").hide();var e=this._getElement(t,"fue");e.val(""),e.attr("data-fp",""),this._getElement(t,"fuk_msg").show(),this._getElement(t,"preview").html(""),this._getElement(t,"label").css({width:"100%",height:"100%"}),this.box[t].fileData=[]}_cbAsynsEndInit(t,e){var i=function(){};null!=e.pacb&&(i=e.pacb);var a={};null!=e.pacb_param&&(a=e.pacb_param),this.cbAsynsEndData={index:0,count:t,callback:i,cbParam:a}}_cbAsynsEndAction(t){switch(t){case"exe1":(e=this.cbAsynsEndData).index==e.count-1?null!=e.callback&&(e.callback(this.active_fue_id,this.box,e.cbParam),this._endPreview()):e.index++;break;case"exe2":var e;0==(e=this.cbAsynsEndData).count&&null!=e.callback&&(e.callback(this.active_fue_id,this.box,e.cbParam),this._endPreview())}}_endPreview(){this._getElement(this.active_fue_id,"fuk_msg").hide()}uploadByAjax(t,e,i){var a=this.param,r=new FormData,s=0;for(var l in this.box){var n=this.box[l].files,o=this.box[l].fileData;for(var h in o){0==o[h].err_flg&&(r.append(s,n[h]),s++)}}e=this._escapeForAjax(e);var d=JSON.stringify(e);r.append("key1",d);var _=null;a.prog_slt&&(_=this.unit.find(a.prog_slt)),jQuery.ajax({type:"POST",url:a.ajax_url,data:r,cache:!1,dataType:"text",processData:!1,contentType:!1,xhr:()=>{var t=jQuery.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",(t=>{if(_){var e=parseInt(t.loaded/t.total*1e4)/100;_.val(e)}}),!1),t}}).done(((e,i)=>{var a;try{a=jQuery.parseJSON(e)}catch(t){return void jQuery(this.param.err_slt).html(e)}t(a)})).fail(((t,e,i)=>{var a=t.responseText;console.log(a),jQuery(this.param.err_slt).html(a),alert(e)}))}getFileParams(){var t=[];for(var e in this.box){var i=this.box[e].files,a={};for(var r in i){var s=i[r];null!=s.size&&(a.fu_id=e,a.name=s.name,a.size=s.size,a.mime=s.type,a.modified=s.lastModifiedDate.toLocaleString(),t.push(a))}}return t}_getElement(t,e){var i=this.box;if(null==i[t]&&(i[t]={}),"fue"==e){var a=null;return i[t].fue?a=i[t].fue:(a=this.unit.find("#"+t),i[t].fue=a),a}if("label"==e){a=null;if(i[t].label)a=i[t].label;else{var r=this._getElement(t,"fue");if(null==r)return null;a=r.parents("label"),i[t].label=a}return a}if("fuk_msg"==e){a=null;if(i[t].fuk_msg)a=i[t].fuk_msg;else{if(null==(s=this._getElement(t,"label")))return null;a=s.find(".fuk_msg"),i[t].fuk_msg=a}return a}if("preview"==e){a=null;if(i[t].preview)a=i[t].preview;else{if(null==(s=this._getElement(t,"label")))return null;a=s.find(".fuk_preview"),i[t].preview=a}return a}if("clear_btn"==e){a=null;if(i[t].clear_btn)a=i[t].clear_btn;else{if(null==(s=this._getElement(t,"label")))return null;a=s.find(".fuk_clear_btn"),i[t].clear_btn=a}return a}if("clear_btn_w"==e){a=null;if(i[t].clear_btn_w)a=i[t].clear_btn_w;else{var s;if(null==(s=this._getElement(t,"label")))return null;a=s.find(".fuk_clear_btn_w"),i[t].clear_btn_w=a}return a}return null}_setToBox(t,e,i){null==i&&(i={});var a={};e[t]&&(a=e[t]);var r=this._getElement(t,"label");return a.label_width=r.width(),a.label_height=r.height(),null==i.valid_ext?a.validData=this.param.validData:a.validData=this._createValidData(i.valid_ext),e[t]=a,e}_convSizeUnit(t,e){null==e&&(e=1);return t<1e3?t+"Byte":t<Math.pow(10,6)?(t=Math.round(t*Math.pow(10,e-3))/Math.pow(10,e))+"KB":t<Math.pow(10,9)?(t=Math.round(t*Math.pow(10,e-6))/Math.pow(10,e))+"MB":t<Math.pow(10,12)?(t=Math.round(t*Math.pow(10,e-9))/Math.pow(10,e))+"GB":(t=Math.round(t*Math.pow(10,e-12))/Math.pow(10,e))+"TB"}_createValidData(t,e){null==e&&(e=this.param.max_size);var i={validExts:[],validMimes:[]};if(null==t||""==t)return i;var a=[];for(var r in a=Array.isArray(t)?t:"image"==t?["jpg","jpeg","png","gif","bpg"]:"audio"==t?["mp3","wav"]:"video"==t?["mp4","avi","mov","webm"]:"often_use"==t?["pdf","jpg","jpeg","png","gif","bpg","tif","tiff","zip","lzh","tar","xls","xlsx","doc","docx","txt","csv","xml","mp3","wav","ogg","m4a","avi","mp4","mpg","ppt","pptx","mdb","accdb"]:t.split(","))a[r]=a[r].trim();a=this._array_unique(a);var s=this._getValidMimes(a);return i.validExts=a,i.validMimes=s,i.max_size=e,i}_array_unique(t){return t.filter((function(t,e,i){return i.indexOf(t)===e}))}_getValidMimes(t){var e=this.mimeMap,i=[];for(var a in t){var r=t[a],s="";null!=e[r]&&(s=e[r]),i.push(s)}return i}getFileNames(t){var e=[];if(null==t)for(var t in this.box){var i=this.box[t].fileData;for(var a in i){var r=i[a];e.push(r.fn)}}else{i=this.box[t].fileData;for(var a in i){r=i[a];e.push(r.fn)}}return e}_getMimeMapping(){var t={aac:"audio/aac",abw:"application/x-abiword",arc:"application/octet-stream",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bpg:"image/bpg",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",es:"application/ecmascript",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",mid:"audio/midi audio/x-midi",midi:"audio/midi audio/x-midi",mp3:"audio/mp3",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otf:"font/otf",png:"image/png",pdf:"application/pdf",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/x-rar-compressed",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"application/typescript",ttf:"font/ttf",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"};return t}_escapeForAjax(t){if("string"==typeof t)return-1!=t.indexOf("&")?(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),encodeURIComponent(t)):t;if("object"==typeof t){for(var e in t)t[e]=this._escapeForAjax(t[e]);return t}return t}_stringRightRev(t,e){if(null==t||""==t)return t;var i=t.lastIndexOf(e);return t.substring(i+e.length,t.length)}}class FoldingTa{init(t){t=this._setParamIfEmpty(t),this.param=t,this.formElm=jQuery(t.form_slt);var e=this._initBoxs();e=this._addPreviewElms(e),this._addEventTenkaiClick(e),this.boxs=e}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.form_slt)throw new Error("Empty 'form_slt' !");return null==t.midasi_length&&(t.midasi_length=20),t}_initBoxs(){var t=[];return this.formElm.find("[data-folding-ta]").each(((e,i)=>{var a=jQuery(i),r=a.attr("data-folding-ta");null!=r&&""!=r||(r=this.param.midasi_length);var s={taElm:a,midasi_len:r};t.push(s)})),t}_getMidasiText(t,e){if(""==t|null==t)return"";var i="";return i=t.length>this.param.midasi_length?t.substring(0,e):t,i=this._xss_sanitize(i)}_addPreviewElms(t){for(var e in t){var i=t[e],a=i.taElm,r=`\n\t\t\t\t<div class="folding_ta_preview" data-folding-ta-p-i="${e}" ">\n\t\t\t\t\t<div class="folding_ta_midasi" style="display:inline-block;margin-right:5px">${this._getMidasiText(a.val(),i.midasi_len)}</div>\n\t\t\t\t\t<input type="button" value='...' class="folding_ta_tenkai btn btn-secondary btn-sm" data-folding-ta-p-i="${e}" style="margin-top:0px" />\n\t\t\t\t</div>\n\t\t\t`;a.before(r)}return this.formElm.find(".folding_ta_preview").each(((e,i)=>{var a=jQuery(i),r=a.attr("data-folding-ta-p-i"),s=t[r];s.previewElm=a;var l=a.find(".folding_ta_midasi");s.midasiElm=l;var n=a.find(".folding_ta_tenkai");s.tenkaiElm=n})),t}_addEventTenkaiClick(t){for(var e in t){var i=t[e];i.tenkaiElm.click((t=>{var e=jQuery(t.currentTarget);this.clickTenkai(e)})),i.taElm.hide()}}clickTenkai(t){var e=t.attr("data-folding-ta-p-i"),i=this.boxs[e];if("none"==i.taElm.css("display"))i.taElm.show(),i.midasiElm.hide(),i.tenkaiElm.attr("value","閉じる");else{var a=this._getMidasiText(i.taElm.val(),i.midasi_len);i.midasiElm.html(a),i.taElm.hide(),i.midasiElm.show(),i.tenkaiElm.attr("value","...")}}reflection(){for(var t in this.boxs){var e=this.boxs[t],i=e.taElm.val(),a=this._getMidasiText(i,e.midasi_len);e.midasiElm.html(a)}}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=this._xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}}function imgCompactK(){jQuery(".img_compact_k").each((function(){jQuery(this).attr("class",""),jQuery(this).css({width:"160px",height:"160px"}),jQuery(this).click((function(){"160px"==jQuery(this).css("width")?(jQuery(this).attr("class","img-responsive"),jQuery(this).css({width:"auto",height:"auto"})):(jQuery(this).attr("class",""),jQuery(this).css({width:"160px",height:"160px"}))}))}))}jQuery((function(){imgCompactK()}));class ImgsPreload{preload(t,e,i){if(this._empty(t))return{};let a;if(Array.isArray(t)){a={};for(let e in t)a[String(e)]=t[e]}else{if("object"!=typeof t)throw Error("システムエラー 20220111A");a=t}this.counter=0,this.data_cnt=Object.keys(a).length,this.afterPreloadCallback=e,this.progressCallback=i,this.imgObjList={};for(let t in a){let e=a[t],i=new Image;i.onload=()=>{this.counter++,this.data_cnt==this.counter&&null!=this.afterPreloadCallback&&this.afterPreloadCallback(this.imgObjList),null!=this.progressCallback&&this.progressCallback({counter:this.counter,data_cnt:this.data_cnt})},i.onerror=()=>{console.log("画像の読込に失敗"),this.counter++,this.data_cnt==this.counter&&null!=this.afterPreloadCallback&&this.afterPreloadCallback(this.imgObjList),null!=this.progressCallback&&this.progressCallback({counter:this.counter,data_cnt:this.data_cnt})},i.src=e,this.imgObjList[t]=i}}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}var ImportFu=function(t){this.param=t,this.fu_wrap,this.files;var e=this;function i(t){var i=e.param;!function(){var t=e.param;e.fu_wrap.find("#"+t.preview_xid).hide(),e.fu_wrap.find(".loding_gif").show()}();var r=t[0];if(null!=r){var l=new FileReader;l.readAsDataURL(r),l.onload=function(t){var r=function(){var t=e.param.fw,i=e.param.ajax_url;if(""==t&&""!=i)return i;if(""==t&&""==i)throw new Error("Empty ajax_url !");if("wp"==t&&""!=i)return i;if("wp"==t&&""==i)return jQuery("#admin-ajax-url").val()}(),l=i.fu_slt,o=new FormData;o.append("upload_file",jQuery(l).prop("files")[0]),"wp"==i.fw&&(o=function(t,e){var i=jQuery("#nonce").val();return t.append("action",e),t.append("nonce",i),t}(o,i.wp_ajax_action)),jQuery.ajax({type:"POST",url:r,data:o,cache:!1,dataType:"text",processData:!1,contentType:!1}).done((function(t,r){var l,o;try{n((l=JSON.parse(t)).err_msg)?((o=jQuery("#"+e.param.suc_msg_xid)).show(),0!=e.param.suc_toggle_sec&&o.fadeOut(e.param.suc_toggle_sec),n(i.success_callback)||i.success_callback(l)):jQuery("#"+i.err_xid).html(l.err_msg),s(),a()}catch(e){throw console.log(t),jQuery("#"+i.err_xid).html(t),s(),a(),e}})).fail((function(t,e,a){console.log(t);var r=t.responseText;console.log(r),jQuery("#"+i.err_xid).html(r),alert(e),s()}))}}}function a(){e.files=null,e.fu_wrap.find(".imp_fu_caption").show();var i=e.fu_wrap.find("#"+t.preview_xid);i.find(".imp_fu_pre_fn").html(""),i.hide();var a=e.param.fu_slt;jQuery(a).val("")}function r(t){var i=e.param,a=e.fu_wrap.find("#"+i.preview_xid);a.show();var r=a.find(".imp_fu_pre_fn"),s=t[0].name;r.html(s),e.fu_wrap.find(".imp_fu_caption").hide(),e.files=t,jQuery("#"+e.param.suc_msg_xid).hide()}function s(){e.fu_wrap.find(".loding_gif").hide()}function l(t){var e=t,i=e.charAt(0);return"#"!=i&&"."!=i||(e=e.substr(1)),e}function n(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}this.constract=function(){this.param=function(t){null==t&&(t={});if(null==t.fu_slt)throw new Error("The fu_slt in param is empty!");var e=l(t.fu_slt);null==t.ajax_url&&(t.ajax_url="");null==t.preview_flg&&(t.preview_flg=1);null==t.caption&&(t.caption="File upload");null==t.caption_color&&(t.caption_color="#a698c9");null==t.caption_color2&&(t.caption_color2="#FFFFFF");null==t.back_color&&(t.back_color="#e3dfee");null==t.caption_font_size&&(t.caption_font_size="40px");null==t.backimg_fp&&(t.backimg_fp="");null==t.wrap_xid&&(t.wrap_xid=e+"_wrap");null==t.fw&&(t.fw="");if(null==t.wp_ajax_action){if("wp"==t.fw)throw Error("The wp_ajax_action in param is empty! (WordPress only)");t.wp_ajax_action=""}null==t.success_callback&&(t.success_callback=null);null==t.suc_msg_xid&&(t.suc_msg_xid=e+"_suc_msg");null==t.suc_msg&&(t.suc_msg="読込が終わりました。");null==t.suc_toggle_sec&&(t.suc_toggle_sec=3e3);null==t.fuWrapCss&&(t.fuWrapCss={"background-color":t.back_color,"border-radius":"5px",display:"inline-block"});null==t.label_xid&&(t.label_xid=e+"_label");null==t.caption_xid&&(t.caption_xid=e+"_caption");null==t.preview_xid&&(t.preview_xid=e+"_preview");if(null==t.captionCss){var i=t.caption_color,a=t.caption_color2,r=t.caption_font_size;t.captionCss={padding:"0px 20px 0px 20px",color:a,"font-size":r,"font-weight":"bold","text-shadow":"2px 2px 1px "+i+",-2px 2px 1px "+i+",2px -2px 1px "+i+",-2px -2px 1px "+i}}null==t.err_xid&&(t.err_xid=e+"_err");return t}(this.param),function(t){var r=t.fu_slt,s=jQuery(r),o=l(r);s.hide(),s.wrap("<div id='"+t.wrap_xid+"'  ><label id = '"+t.label_xid+"' for='"+o+"' ></label></div>");var h=jQuery("#"+t.wrap_xid);h.css(t.fuWrapCss);var d=h.find("#"+t.label_xid),_="<div id='"+t.caption_xid+"' class='imp_fu_caption'>"+t.caption+"</div>";if(d.append(_),h.find("#"+t.caption_xid).css(t.captionCss),!n(t.backimg_fp)){var c="<img src='"+t.backimg_fp+"' />";h.append(c)}var p="<div id='"+t.preview_xid+"' style='display:none;margin:0px 20px 20px 20px;'>\t<div id='"+t.pre_fn_xid+"' class='imp_fu_pre_fn'></div>\t<div class='imp_fu_pre_btns' style='margin-top:10px'>\t\t<input type='button' class='imp_fu_pre_exe_btn btn btn-success btn' value='アップロード' />\t\t<input type='button' class='imp_fu_pre_cancel_btn btn btn-secondary btn' value='キャンセル' />\t</div></div>";h.append(p);var u="<div class='loding_gif' style='display:none;padding:20px;'>\t<img src='data:image/gif;base64,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' /> 読み込み中・・・</div>";h.append(u),h.find(".imp_fu_pre_exe_btn").click((function(t){i(e.files)})),h.find(".imp_fu_pre_cancel_btn").click((function(t){a()}));var m="<div id='"+t.suc_msg_xid+"' class='text-success' style='display:none'>"+t.suc_msg+"</div>";h.after(m);var f="<div id='"+t.err_xid+"' class='text-danger' ></div>";h.after(f),e.fu_wrap=h}(this.param),function(t){jQuery(t.fu_slt).change((function(e){var a=e.target.files;t.preview_flg?r(a):i(a)}))}(this.param),function(t){var e=jQuery("#"+t.wrap_xid);e[0].addEventListener("drop",(function(e){e.stopPropagation(),e.preventDefault();var a=e.dataTransfer.files;t.preview_flg?r(a):i(a)}),!1),e[0].addEventListener("dragover",(function(t){t.preventDefault()}),!1)}(this.param)},this.constract()};class JsQrEx{constructor(t,e,i,a){if(this.active=!1,null==t&&new Error("Sytem error:canvas_xid is empty!"),null==a&&(a={}),this.readCallback=e,"function"!=typeof e)throw new Error("System err:readCallback is not function");this.config_xid=i,a=this._setParam(a),this.param=a;let r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.setAttribute("playsinline",""),this.jq_cvs=jQuery("#"+t);let s=document.getElementById(t),l=s.getContext("2d"),n=document.createElement("canvas"),o=n.getContext("2d");this.video=r,this.cvs=s,this.cvs_ctx=l,this.tmp=n,this.tmp_ctx=o,s.style.width="0px",s.style.height="0px",s.setAttribute("width",0),s.setAttribute("height",0),this._initConfig(i),this.video=r}_getDefParam(){return{cvs_width:640,cvs_height:480,camera_width:640,camera_height:480,intarval:50,read_size_rate:.5}}_initConfig(t){if(null==t)return;let e=t+"_config_btn",i=t+"_content",a=t+"_size_rate_xid",r=t+"_apply_btn",s=t+"_def_btn";this.jQConfig=jQuery("#"+t);let l=`\n\t\t\t<button id="${e}" class="btn btn-outline-secondary btn-sm">設定</button>\n\t\t\t<div id="${i}" style="display:none;border:solid 2px #4b8bf4;padding:20px;">\n\t\t\t\t<table>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td style="padding:3px;">QRコードの読込領域の割合</td>\n\t\t\t\t\t\t\t<td style="padding:3px;"><input type="number" id="${a}" step="0.1" max="1.0" min="0.2"; value="" style="width:3.5em;" /></td>\n\t\t\t\t\t\t\t<td style="padding:3px;"><aside>0.2～1.0の範囲で指定</aside></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t\t<div>\n\t\t\t\t\t<button id="${r}" class="btn btn-primary btn-sm">適用</button>\n\t\t\t\t\t<button id="${s}" class="btn btn-primary btn-sm">初期に戻す</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;this.jQConfig.html(l),this.jqConfigBtn=this.jQConfig.find("#"+e),this.jqConfigCon=this.jQConfig.find("#"+i),this.jqReadSizeRate=this.jQConfig.find("#"+a),this.jqApplyBtn=this.jQConfig.find("#"+r),this.jqDefBtn=this.jQConfig.find("#"+s),this.jqReadSizeRate.val(this.param.read_size_rate),this.jqConfigBtn.click((t=>{this.jqConfigCon.toggle(300)})),this.jqApplyBtn.click((t=>{this._apply()})),this.jqDefBtn.click((t=>{this._toDefault()}))}start(t,e){1!=this.active&&(this.jQConfig&&this.jQConfig.hide(),this.jq_cvs.show(),this.startCallback=t,this.errCallback=e,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:{ideal:this.param.camera_width},height:{ideal:this.param.camera_height}}}).then((t=>{let e=this.video,i=this.cvs;e.srcObject=t,e.onloadedmetadata=t=>{e.play();let a=e.videoWidth,r=e.videoHeight;i.setAttribute("width",a),i.setAttribute("height",r),i.style.width=this.param.cvs_width+"px",i.style.height=this.param.cvs_height+"px",this.active=!0,setTimeout((()=>{this._scan()}),500),this.startCallback&&this.startCallback()}})).catch((t=>{this.errCallback?this.errCallback(t):alert("カメラ起動に失敗しました。")})))}stop(){if(0==this.active)return;this.jQConfig&&this.jQConfig.show(),this.active=!1,this.jq_cvs.hide();this.video.srcObject.getTracks().forEach((t=>{t.stop()}))}_scan(){let t=this.video,e=this.cvs,i=this.cvs_ctx,a=this.tmp,r=this.tmp_ctx,s=this.param.camera_width,l=this.param.camera_height,n=this.param.read_size_rate,o=0;o=s>l?l*n:s*n;let h=(s-o)/2,d=(l-o)/2;i.drawImage(t,0,0,s,l),i.beginPath(),i.strokeStyle="rgb(255,0,0)",i.lineWidth=2,i.rect(h,d,o,o),i.stroke(),a.setAttribute("width",o),a.setAttribute("height",o),r.drawImage(e,h,d,o,o,0,0,o,o);let _=r.getImageData(0,0,o,o),c=jsQR(_.data,o,o);c&&this.readCallback(c.data),1==this.active&&setTimeout((()=>{this._scan()}),this.param.intarval)}_setParam(t){this.ls_key=null,t&&(t.ls_key?this.ls_key=t.ls_key:this._createLsKey());let e=this._getLsParam(),i=this._getDefParam();this.lsParam=$.extend(!0,{},e),this.pParam=$.extend(!0,{},t),this.defParam=$.extend(!0,{},i);let a={};return this._empty(e)||(a=this._merge(a,e)),this._empty(t)||(a=this._merge(a,t)),a=this._merge(a,i),this.param=a,a}_apply(){let t=this.jqReadSizeRate.val();this._isRange(t,.2,1,!0)?(t*=1,this.param.read_size_rate=t,this._saveLs(),this.jqConfigCon.hide()):alert("「QRコードの読込領域の割合」は0.2から1.0の範囲で入力してください。")}_isRange(t,e,i,a){return(1!=a||null!=t&&""!==t&&!1!==t)&&(!isNaN(t)&&(e<=t&&i>=t))}_toDefault(){let t=this._getDefParam();for(let e in t)this.param[e]=t[e];this._refreshJQConfig(),this.clearlocalStorage()}_refreshJQConfig(){this.jqReadSizeRate.val(this.param.read_size_rate)}_merge(t,e){for(let i in e)void 0===t[i]&&(t[i]=e[i]);return t}_getLsParam(){let t=this._getLsKey(),e=localStorage.getItem(t),i=JSON.parse(e);return null==i&&(i={}),i}clearlocalStorage(){let t=this._getLsKey();localStorage.removeItem(t)}_saveLs(){let t=this._getLsKey(),e=JSON.stringify(this.param);localStorage.setItem(t,e)}_getLsKey(){return null==this.ls_key&&(this.ls_key=this._createLsKey()),this.ls_key}_createLsKey(){let t=location.href;return t=t.split(/[?#]/)[0],t+=this.constructor.name,t}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}_resetParam(){for(let t in this.defParam)this.param[t]=this.defParam[t];return this._saveLs(),this.param}}jQuery((function(){(new LiviPage).execution({width:"auto"})}));var LiviPage=function(){this.execution=function(t){jQuery(document.body).append("<div id='livipage_tooltip'></div>");var e={"z-index":2,"background-color":"white",position:"absolute",border:"solid 2px #ccb1bf",padding:"5px",width:"280px",height:"460px","overflow-y":"auto"};null!=t&&$.extend(e,t),jQuery(document).click((function(){jQuery("#livipage_tooltip").hide()})),jQuery("#livipage_tooltip").click((function(t){t.stopPropagation()})),jQuery(".livipage").click((function(){var t=jQuery(this).attr("href"),i=jQuery(this).offset(),a=i.left,r=i.top,s=(jQuery(t).width(),jQuery(t).height(),jQuery(t).html());s="<a href='"+t+"'>"+jQuery(this).html()+"</a><br>"+s,jQuery("#livipage_tooltip").show(),jQuery("#livipage_tooltip").css(e),jQuery("#livipage_tooltip").html(s);var l=a,n=r+16;return jQuery("#livipage_tooltip").offset({top:n,left:l}),!1}))}};
/**
 * モーダル化ライブラリ
 * @since 2022-1-21 | 2022-2-22
 * @version 1.1.2
 * @auther amaraimusi
 * @license MIT
 */class ModalCat{modalize(t,e){null==e&&(e={}),null==e.width_rate&&(e.width_rate=80),null==e.z_index&&(e.z_index=999);let i=t+"_js_main",a=t+"_js_modal_close",r=jQuery("#"+t);this.content=r,r.wrap(`<div id='${i}'></div>`);let s=jQuery("#"+i),l=`<div id='${a}'></div>`;s.prepend(l);let n=jQuery(s.find("#"+a));this.openCallback=e.openCallback,this.closeBackCallback=e.closeBackCallback,this.closeCallback=e.closeCallback;let o=String(e.z_index);s.css({display:"none",height:"100vh",position:"fixed",top:"0",left:"0",width:"100vw","z-index":o}),n.css({background:"rgba(0,0,0,0.8)",height:"100vh",position:"absolute",width:"100vw","z-index":o}),r.css({background:"#fff",left:"50%",padding:"40px",position:"absolute",top:"50%",transform:"translate(-50%,-50%)",width:e.width_rate+"%","z-index":o}),this.main=s,n.on("click",(()=>(this.main.fadeOut(),this.closeBackCallback&&this.closeBackCallback(),this.closeCallback&&this.closeCallback(),!1)))}open(t){this.openParam=t,this.content.show(),this.main.fadeIn("slow",(()=>{this.openCallback&&this.openCallback(this.openParam)}))}close(t){this.closeParam=t,this.main.fadeOut("slow",(()=>{this.closeCallback&&this.closeCallback(this.closeParam)}))}}var NoUiSliderWrap=function(){this.props,this.slider,this.init=function(t,e){this.props=e;var i=jQuery(e.slider).get(0);this.slider=i;var a=jQuery(e.tb1).val(),r=jQuery(e.tb2).val();noUiSlider.create(i,{start:[a,r],step:e.step,connect:!0,tooltips:!1,range:{min:e.min,max:e.max}}),i.noUiSlider.on("update",(function(t,i){var a=t[0],r=(a=Math.round(a),t[1]);r=Math.round(r);0!=a||0!=r?(jQuery(e.tb1).val(a),jQuery(e.tb2).val(r),jQuery(e.value_preview).html(a+"～"+r)):(jQuery(e.tb1).val(""),jQuery(e.tb2).val(""),jQuery(e.value_preview).html("OFF"))})),jQuery(e.tb1).blur((function(e){t.reload()})),jQuery(e.tb2).blur((function(e){t.reload()}))},this.reload=function(){var t=jQuery(this.props.tb1).val(),e=jQuery(this.props.tb2).val();this.slider.noUiSlider.set([t,e])}};
/**
 * ページネーションジャンプ
 * 
 * @note
 * ページネーションにジャンプ機能を付ける
 * 
 * 使い方
 * 下記のような要素をHTMLに埋め込む
 * <div class="pagenation_jump" data-count="1271" data-hina-url="/animal_park/neko?page_no=1&row_limit=50&sort_field=Neko.sort_no&sort_desc=0&act_flg=2&kj_delete_flg=0&row_limit=50" style="display:inline-block"></div>
 * 
 * @date 2019-7-26 | 2020-8-13
 * @license MIT
 * @version 1.0.1
 */class PagenationJump{init(t){if(this.param=this._setParamIfEmpty(t),this.tDiv=jQuery("#"+this.param.xid),!this.tDiv[0])return;let e=this._createHtml();this.tDiv.html(e),this.showBtn=this.tDiv.find(".cbpjump_show_btn"),this.div1=this.tDiv.find(".cbpjump_div1"),this.tb=this.tDiv.find(".cbpjump_tb"),this.jumpBtn=this.tDiv.find(".cbpjump_jump_btn");let i=this.tDiv.attr("data-row-limit"),a=this.tDiv.attr("data-count"),r=1;this._empty(i)||(r=Math.ceil(a/i));let s=this.tDiv.attr("data-hina-url");this._empty(s)||(s=s.replace(/page_no=[0-9]*/g,"page_no=%0"),this.param.row_limit=i,this.param.data_count=a,this.param.max_page_count=r,this.param.hina_url=s,this.addClickShowBtn(this.showBtn),this.addClickJumpBtn(this.jumpBtn),this.addEnterTb(this.tb))}_setParamIfEmpty(t){return null==t&&(t={}),null==t.xid&&(t.xid="pagenation_jump"),t}_createHtml(){return'\n\t<button class="cbpjump_show_btn btn btn-outline-primary btn-sm" title="ページジャンプ">\n\t\t\t⇒\n\t</button>\n\t<div style="display:inline-block">\n\t\t<div class="cbpjump_div1" style="margin-right:16px;display:none">\n\t\t\t<input class="cbpjump_tb" type="textbox" style="width:60px">\n\t\t\t<input class="cbpjump_jump_btn btn btn-warning btn-sm" type="button" value=\'ページジャンプ\' />\n\t\t</div>\n\t</div>\n\t\t'}addClickShowBtn(t){t.click((t=>{this._clickShowBtn()}))}_clickShowBtn(){this.div1.toggle(100)}addClickJumpBtn(t){t.click((t=>{this._clickJumpBtn()}))}_clickJumpBtn(){let t=this.tb.val();if(t+="",t=this._toHalfWidth(t),t=t.trim(),""==t||null==t)return void alert("ページ番号を入力してください");if(isNaN(t))return void alert("ページ番号は数値を入力してください");t*=1,t<1&&(t=1),t>this.param.max_page_count&&(t=this.param.max_page_count),t-=1;let e=this.param.hina_url;e=e.replace("%0",t),location.href=e}addEnterTb(t){t.keypress((t=>{13==t.which&&this._clickJumpBtn()}))}_toHalfWidth(t){return t.replace(/[Ａ-Ｚａ-ｚ０-９！-～]/g,(t=>String.fromCharCode(t.charCodeAt(0)-65248)))}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}
/**
 * 静的テーブルをページネーション化する。ページネーションはBootstrap4に対応
 * @since 2022-1-20 | 2022-3-3
 * @version 1.0.2
 * @license MIT
 * @auther amaraimusi
 */class PaginationRain{constructor(t,e){null==e&&(e={}),null==e.visible_row_count&&(e.visible_row_count=8),null==e.cur_page_num&&(e.cur_page_num=0),null==e.pn_position&&(e.pn_position="bottom"),null==e.search_cols_str&&(e.search_cols_str="1,2"),null==e.last_page_flg&&(e.last_page_flg=0),null==e.search_box_flg&&(e.search_box_flg=1),null==e.search_box_w_xid&&(e.search_box_w_xid=null),e.xid=t,e.searchCols=this._makeSearchCols(e.search_cols_str),this.tbl=jQuery("#"+t),null==e.search_placeholder&&(e.search_placeholder=this._getSearchPlaceholder(this.tbl,e.searchCols)),this._initSearchBox(e),this.param=e,this.refresh()}_initSearchBox(t){if(t.search_box_w_xid){if(this.jq_search_box_w=jQuery("#"+t.search_box_w_xid),null==this.jq_search_box_w[0])throw new Error("search_box_w_xid is empty!")}else this.tbl.before(`<div id="${t.xid}_search_box_w"></div>`),this.jq_search_box_w=jQuery(`#${t.xid}_search_box_w`);1==t.search_box_flg?this.jq_search_box_w.show():this.jq_search_box_w.hide()}refresh(){let t=this.param,e=this.tbl,i=e.find("tbody tr"),a=i.length;if(0==a)return;let r=t.visible_row_count;t.num_rows=a,t.all_page_count=Math.ceil(a/r),t.cur_page_num=0,t.last_page_flg&&(t.cur_page_num=t.all_page_count-1),this.data=this._createDataFromHtmltable(i),this._createSearchBox(t,e),this.data=this._reflectPagenationInData(this.data,t),this._applyToTable(this.data,t),this._createPagenationDiv(e,this.data,t),this.trs=i}_createDataFromHtmltable(t){let e=[];return t.each(((t,i)=>{let a=$(i),r=(a.index(),{row_index:t,search_flg:1,show_flg:0,trElm:a});e.push(r)})),e}search(){this.param.cur_page_num=0;let t=this.jq_search_tb.val();t=t.trim(),this.data=this._reflectSearchInData(this.data,t),this.data=this._reflectPagenationInData(this.data,this.param),this._applyToTable(this.data,this.param),this._createPagenationDiv(this.tbl,this.data,this.param)}_reflectSearchInData(t,e){for(let i in t){let a=t[i],r=a.trElm;a.search_flg=this._judgSearch(r,e),a.search_flg?a.show_flg=1:a.show_flg=0}return t}_reflectPagenationInData(t,e){let i=e.visible_row_count,a=e.cur_page_num;i*=1,a*=1;let r=a*i,s=(a+1)*i,l=0;for(let e in t){let i=t[e];i.search_flg?(i.show_flg=r<=l&l<s?1:0,l++):i.show_flg=0}return t}_makeSearchCols(t){if(this._empty(t))return[];let e=[];if(isNaN(t)){let i=t.split(",");for(let t in i){let a=i[t];a=a.trim(),a*=1,e.push(a)}}else e.push(t);return e}_getSearchPlaceholder(t,e){if(this._empty(e))return"";let i=t.find("th"),a="";for(let t in e){let r=e[t],s=i.eq(r).text();a+=0==t?s:", "+s}return a}_applyToTable(t,e){for(let e in t){let i=t[e],a=i.trElm;i.show_flg?a.show():a.hide()}}_judgSearch(t,e){if(null==e||""==e)return 1;let i=t.find("td"),a="";for(let t in this.param.searchCols){let e=this.param.searchCols[t];a+=i.eq(e).text()}return-1!=a.indexOf(e)?1:0}_createPagenationDiv(t,e,i){if(null==this.pagenationDiv){let e=i.xid+"_patination_div",a=`<div id='${e}'></div>`;"top"==i.pn_position?t.before(a):t.after(a),this.pagenationDiv=jQuery("#"+e)}let a="",r=0,s=0,l=i.visible_row_count,n=i.xid+"_page_item";for(let t in e){if(e[t].search_flg){if(r%l==0){let t="";s==i.cur_page_num&&(t="active"),a+=`\n\t\t\t\t\t\t<li class="page-item ${t} ${n}" data-page-no="${s}">\n\t\t\t\t\t\t\t<span class="page-link">${s+1}</span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t`,s++}r++}}this.toc&&this.toc.remove();let o=`<ul id="${i.xid+"_toc"}" class="pagination">${a}</ul>`;this.pagenationDiv.html(o),this.jQPageItems=jQuery("."+n),this.jQPageItems.click((t=>{let e=$(t.currentTarget);this._clickPageItem(e)}))}_clickPageItem(t){this.jQPageItems.removeClass("active"),t.addClass("active");let e=t.attr("data-page-no");this.param.cur_page_num=e,this.data=this._reflectPagenationInData(this.data,this.param),this._applyToTable(this.data,this.param)}_createSearchBox(t,e){t.search_tb_xid=t.xid+"_textbox",t.search_btn_xid=t.xid+"_search_btn";let i=`\n\t\t\t<div style='margin-bottom:0.8em;' class='row'>\n\t\t\t\t<div class='col-12 col-md-8'>\n\t\t\t\t\t<input id='${t.search_tb_xid}' type='text' class='form-control' placeholder='${t.search_placeholder}' />\n\t\t\t\t</div>\n\t\t\t\t<div class='col-12 col-md-4'>\n\t\t\t\t\t<button id='${t.search_btn_xid}' class='btn btn-primary'>検索</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;this.jq_search_box_w.html(i),this.jq_search_tb=$("#"+t.search_tb_xid),$("#"+t.search_btn_xid).click((t=>{this.search()})),this.jq_search_tb.keypress((t=>{13==t.which&&this.search()}))}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}
/**
 * ポップアップ化ライブラリ
 * @note 
 *     id属性で指定した要素をポップアップ化する。
 *     「登録完了」時の通知用ポップアップとして活用できる。
 *     ポップ発布は左上、右上、右下、左下の4方向に設定可能。
 *     ポップアップが消えるタイミングでコールバックを実行できる。
 *     ポップアップをクリックするとポップアップは消える。
 * @since 2022-1-28
 * @version 1.0.0
 * @auther amaraimusi
 * @license MIT
 */class PopupCat{popupize(t,e){this.popupElm=jQuery("#"+t),null==e&&(e={}),null==e.direction_type&&(e.direction_type="right_bottom"),null==e.z_index&&(e.z_index="2"),null==e.fadein_time&&(e.fadein_time=1e3),null==e.set_timeout_time&&(e.set_timeout_time=3500),this.popupClickCallback=e.popupClickCallback;let i="0px",a="0px",r="0px",s="0px";switch(e.direction_type){case"left_top":r="auto",s="auto";break;case"right_top":i="auto",s="auto";break;case"left_bottom":r="auto",a="auto";break;case"right_bottom":i="auto",a="auto";break;default:throw Error("PopupCat Error PCAT220129A")}this.popupElm.css({display:"none",position:"fixed",left:i,top:a,right:r,bottom:s,"z-index":e.z_index}),this.after_cb_flg=!1,this.popupElm.click((t=>{let e=$(t.currentTarget);this.popupClickCallback&&this.popupClickCallback(),e.hide()})),this.param=e}getPopupElm(){return this.popupElm}pop(t){this.afterCallback=t,this.after_cb_flg=!1,this.popupElm.hide(),this.popupElm.fadeIn(this.param.fadein_time,(()=>{window.setTimeout((()=>{this.popupElm.hide(),this.afterCallback&&this.afterCallback()}),this.param.set_timeout_time)}))}}
/**
 * 時間差ポップアップ
 * @note 
 *     ポップアップの追加とポップアップの表示をタイミングをずらして実行できる。
 *     主な使い方→ ポップアップを追加してブラウザリロードした後、ポップアップを表示。
 *     PopupCat.jsに依存している。
 * @since 2022-2-17 | 2022-2-19
 * @version 1.1.0
 * @auther amaraimusi
 * @license MIT
 */class PopupLion{constructor(t,e){null==t&&(t={}),this.param=t,this.boxs=this._getBoxsFromLs(),this.popupCatList={},this.release_index=0,null==e&&(e={}),e.popupClickCallback=()=>{this._endAllPopup()},this.popupCatParam=e}addPopup(t,e){if(null==t)throw new Exceptin("PopupLion.js error. xid is empty");null==e&&(e=[]);let i={xid:t,data:e,show_done_flg:0};this.boxs.push(i),this._saveLs(this.boxs)}releasePopup(){if(this.boxs.length==this.release_index)return void this._endAllPopup();let t=null;for(let e=this.release_index;e<this.boxs.length;e++)if(0==this.boxs[e].show_done_flg){t=this.boxs[e],this.release_index=e;break}if(null==t)return void this._endAllPopup();t.show_done_flg=1;let e=t.xid,i=this._getPopupCat(e),a=i.getPopupElm();t.data;for(let e in t.data){let i=t.data[e],r=a.find(i.jq_slt);r[0]&&r.html(i.value)}this.release_index++,this._saveLs(this.boxs),i.pop((()=>{this.releasePopup()}))}_endAllPopup(){this._empty(this.boxs)||(this.boxs=[],this.release_index=0,this.clearlocalStorage())}_getPopupCat(t){if(null==this.popupCatList[t]){let e=new PopupCat;e.popupize(t,this.popupCatParam),this.popupCatList[t]=e}return this.popupCatList[t]}_getBoxsFromLs(){let t=this._getLsKey(),e=localStorage.getItem(t),i=JSON.parse(e);return null==i&&(i=[]),i}clearlocalStorage(){let t=this._getLsKey();localStorage.removeItem(t)}_saveLs(t){let e=this._getLsKey(),i=JSON.stringify(t);localStorage.setItem(e,i)}_getLsKey(){return null==this.ls_key&&(this.ls_key=this._createLsKey()),this.ls_key}_createLsKey(){let t=location.href;return t=t.split(/[?#]/)[0],t+=this.constructor.name,t}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}class ProcessWithMultiSelection{constructor(t){this.param=this._setOptionIfEmpty(t)}_setOptionIfEmpty(t){if(null==t&&(t={}),null==t.tbl_slt&&(t.tbl_slt="tbl1"),null==t.cb_slt&&(t.cb_slt="pwms"),null==t.id_slt&&(t.id_slt="id"),null==t.ajax_url)throw new Error("'ajax_url' is nothing");if(null==t.csrf_token)throw new Error("'csrf_token' is nothing");return t}action(t){let e=this._getIdLintInChecked();if(0==e.length)return;if("11"==t){if(!confirm("チェックした行を削除してもよろしいですか？"))return}let i=new FormData,a={ids:e,kind_no:t},r=JSON.stringify(a);i.append("key1",r);let s=this.param.csrf_token;i.append("_token",s),jQuery.ajax({type:"post",url:this.param.ajax_url,data:i,cache:!1,dataType:"text",processData:!1,contentType:!1,success:(t,e)=>{"success"==t?location.reload(!0):jQuery("#err").html(t)},error:function(t,e,i){jQuery("#err").html(t.responseText),alert(e)}})}_getIdLintInChecked(){let t=[],e="#"+this.param.tbl_slt+" tbody tr";return jQuery(e).each(((e,i)=>{let a=jQuery(i);if(this._getElmByNameOrClass(a,this.param.cb_slt).prop("checked")){let e=this._getValueByNameOrClass(a,this.param.id_slt);t.push(e)}})),t}_getElmByNameOrClass(t,e){let i=t.find("[name='"+e+"']");return i[0]||(i=t.find("."+e)),i}_getValueByNameOrClass(t,e){let i,a=t.find("[name='"+e+"']");return a[0]?i=a.val():(a=t.find("."+e),a[0]&&(i=a.text())),i}switchAllSelection(t){let e=jQuery(t).prop("checked"),i=this.param.tbl_slt+" tbody tr";"#"!=i.charAt(0)&&(i="#"+i),jQuery(i).each(((t,i)=>{let a=jQuery(i);this._getElmByNameOrClass(a,this.param.cb_slt).prop("checked",e)}))}}class PwValidK{check(t,e){if(null==t||""==t||0==t)return{check:!1,err_msg:"パスワードが空です。"};if(null==e&&(e={}),null==e.num_req&&(e.num_req=!1),null==e.alph_req&&(e.alph_req=!0),null==e.min_len&&(e.min_len=8),null==e.max_len&&(e.max_len=32),t.length<e.min_len)return{check:!1,err_msg:"パスワードは"+e.min_len+"文字以上にしてください。"};if(t.length>e.max_len)return{check:!1,err_msg:"パスワードは"+e.max_len+"文字以下にしてください。"};var i;if(null==(i=t.match(/^[a-zA-Z0-9]+$/)))return{check:!1,err_msg:"パスワードは半角英数字で入力してください。"};if(e.num_req&&null==(i=t.match(/[0-9]/)))return{check:!1,err_msg:"パスワードに数字を含めてください。"};if(e.alph_req&&null==(i=t.match(/[a-zA-Z]/)))return{check:!1,err_msg:"パスワードにアルファベットを含めてください。"};return i=null==i?{check:!1,err_msg:"パスワードの入力エラー"}:{check:!0,err_msg:""}}}
/**
 * 年月による日付範囲入力 | RangeYm.js
 * @date 2019-8-17 | 2021-5-28
 * @license MIT
 * @version 1.1.6
 */class RangeYm{init(t){this.param=this._setParamIfEmpty(t),this.param.div_xid instanceof jQuery?(this.tDiv=this.param.div_xid,this.param.div_xid=this.tDiv.attr("id")):this.tDiv=jQuery("#"+this.param.div_xid);let e=this._createHtml();this.tDiv.html(e),this.ymTb=this.tDiv.find(".range_ym_tb"),this.dtlBtn=this.tDiv.find(".range_ym_dtl_btn"),this.rngDiv=this.tDiv.find(".range_ym_range_div"),this.fromInp=this.tDiv.find(".range_ym_date_from"),this.toInp=this.tDiv.find(".range_ym_date_to"),this.errElm=this.tDiv.find(".range_ym_err"),this.rngDiv.hide(),this._addClickDtlBtn(this.dtlBtn),this._addChangeYmTb(this.ymTb),this.param.def_ym=this.tDiv.attr("data-def-ym"),this.param.def1=this.tDiv.attr("data-def1"),this.param.def2=this.tDiv.attr("data-def2"),this.setYm(this.param.def_ym,this.param.def1,this.param.def2)}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.div_xid)throw new Error("div_xid is empty");if(null==t.field)throw new Error("field is empty");if(null==t.wamei)throw new Error("wamei is empty");return null==t.field_from&&(t.field_from=t.field+"1"),null==t.field_to&&(t.field_to=t.field+"2"),t}_getProperty(t,e,i,a){let r=null;return r=null!=a[t]?a[t]:null!=i[t]?i[t]:e,r}_createHtml(){let t=this.param.field,e=this.param.wamei,i=this.param.field_from,a=this.param.field_to;return`\n\t<input type="month" id="${t}_ym" class="range_ym_tb kjs_inp form-control"  placeholder="「${e}」の年月" title="年月を選択すると「>」ボタンの先にその月の日付範囲が入力されます。" style='display:inline-block;width:200px' />\t\n\t<button type="button" class="range_ym_dtl_btn btn btn-secondary btn-secondary btn-sm" title="日付を範囲入力する部分を表示します。">\n\t\t<span class='oi' data-glyph='arrow-thick-right'> </span>範囲</button>\n\t<div class="range_ym_range_div" style="display:inline-block">\n\t\t<input type="date" id="${i}" class="${i} kjs_inp range_ym_date_from form-control"  placeholder="「${e}」の範囲【始め】" title="「${e}」範囲の始め日付です。" style='display:inline-block;width:200px' />\t\n\t\t<input type="date" id="${a}" class="${a} kjs_inp range_ym_date_to form-control"  placeholder="「${e}」の範囲【終わり】" title="「${e}」範囲の終わり日付です。" style='display:inline-block;width:200px' />\t\n\t\t<div class="range_ym_err text-danger"></div>\n\t</div>\n\t\t`}_showErr(t){this.errDiv.append(t+"<br>")}_addClickDtlBtn(t){t.click((t=>{this._toggleRngDiv()}))}_toggleRngDiv(){var t=this.rngDiv.css("display");if(null==t|"none"==t){let t=this._getDtlBtnName(0);this.dtlBtn.val(t),this.tDiv.css("display","block"),this.rngDiv.show(100)}else{let t=this._getDtlBtnName(1);this.dtlBtn.val(t),this.tDiv.css("display","inline-block"),this.rngDiv.hide(100)}}_getDtlBtnName(t){let e=" (閉じる)",i=this.dtlBtn.val();return 1==t?i=i.replace(e,""):i+=e,i}_addChangeYmTb(t){t.change((t=>{let e=jQuery(t.currentTarget);this.changeYmTb(e)}))}changeYmTb(t){let e=t.val()+"-01";this.fromInp.val(e);let i=this._getMonthEndDate(e);this.toInp.val(i)}_getMonthEndDate(t){if(null==t)return null;"string"==typeof t&&(t=new Date(t));var e=new Date(t.getFullYear(),t.getMonth()+1,0),i=e.getFullYear(),a=e.getMonth()+1,r=e.getDate();return i+"-"+(a=("0"+a).slice(-2))+"-"+(r=("0"+r).slice(-2))}setYm(t,e,i){t=this._yyyymm(t),this.ymTb.val(t);let a=!1;this._empty(e)?e=this._empty(t)?"":t+"-01":a=!0,e=this._yyyymmdd(e),this.fromInp.val(e),this._empty(i)?i=this._empty(t)?"":this._getMonthEndDate(e):a=!0,i=this._yyyymmdd(i),this.toInp.val(i),a&&this._toggleRngDiv()}_yyyymmdd(t,e){if(null==t)return t;if(""==(t=t.trim())||0==t)return t;null==e&&(e="-");let i=t.split(e);if(3!=i.length)return t;let a=i[1];a=("0"+a).slice(-2);let r=i[2];return r=("0"+r).slice(-2),i[0]+e+a+e+r}_yyyymm(t,e){if(null==t)return t;if(""==(t=t.trim())||0==t)return t;null==e&&(e="-");let i=t.split(e);if(2!=i.length)return t;let a=i[1];return a=("0"+a).slice(-2),i[0]+e+a}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}
/**
 * 年月による日付範囲入力【拡張】 | RangeYmEx.js
 * 
 * @note
 * RangeYm.jsが必要。
 * 
 * @date 2019-8-17
 * @license MIT
 * @version 1.0.0
 */class RangeYmEx{init(t){let e={};jQuery(".range_ym_ex").each(((t,i)=>{let a=(i=jQuery(i)).attr("id"),r=i.attr("data-field"),s=i.attr("data-wamei");null==r&&(r=a);let l=new RangeYm;l.init({div_xid:i,field:r,wamei:s});let n={elm:i,field:r,wamei:s,rngYmObj:l};e[r]=n})),this.boxs=e}}class ReqBatch{init(t){t=this._setParamIfEmpty(t),this.tDiv=jQuery("#"+t.div_xid),this.startBtn=jQuery("#"+t.start_btn_xid),this.handlers=[],this.param=t}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.div_xid&&(t.div_xid="req_batch_div"),null==t.start_btn_xid&&(t.start_btn_xid="req_batch_start_btn"),null==t.interval&&(t.interval=1e3),null==t.ajax_url&&null==t.asyn_cb)throw new Error("Empty 'ajax_url' and 'asyn_cb' !");return null==t.fail_limit&&(t.fail_limit=5),null==t.asyn_param&&(t.asyn_param=null),t}start(t){this.data=t;var e=this._createHtml();this.tDiv.html(e),this.tDiv.show(),this.successDiv=this.tDiv.find(".req_batch_success"),this.reloadBtn=this.tDiv.find(".req_batch_reload"),this.errDiv=this.tDiv.find(".req_batch_err"),this.prog=this.tDiv.find(".req_batch_prog"),this.stopBtn=this.tDiv.find(".req_batch_stop_btn"),this.failBtn=this.tDiv.find(".req_batch_fail_btn"),this.consoleDiv=this.tDiv.find(".req_batch_console"),this.cCountDiv=this.tDiv.find(".req_batch_c_count"),this.cSuccessDiv=this.tDiv.find(".req_batch_c_success_count"),this.cFailDiv=this.tDiv.find(".req_batch_c_fail_count"),this.cMemDiv=this.tDiv.find(".req_batch_c_mem"),this.failDiv=this.tDiv.find(".req_batch_fail"),this._addReloadClickEvent(this.reloadBtn),this._addStopClickEvent(this.stopBtn),this._addFailBtnClickEvent(this.failBtn),this.mems=this._resetMemoryData(),this.prog.show(),this.prog.val(0),this.startBtn.hide(),this.main_index=0,this.asyn_flg=0,this.data_num=this.data.length,this.success_count=0,this.fail_count=0,this.ic_start_time=Math.floor($.now());var i=setInterval((()=>{this.thread()}),this.param.interval);this.handlers.push(i)}_createHtml(){return'\n\t<div>\n\t\t<div class="req_batch_success text-success"></div>\n\t\t<input type="button" class="req_batch_reload btn btn-success btn-sm" value="リロード" style="display:none"> \n\t</div>\n\t<div class="req_batch_err text-danger"></div>\n\t<div><progress class="req_batch_prog"  max="100" style="display:none">■</progress></div>\n\t<div class="btn-group">\n\t\t<input type="button" value="停止" class="req_batch_stop_btn btn btn-secondary btn-sm"/>\n\t\t<input type="button" value="失敗(0)" class="req_batch_fail_btn btn btn-secondary btn-sm"/>\n\t</div>\n\t<br>\n\t<div class="req_batch_console console">\n\t\t<div><span>処理数:</span><span class="req_batch_c_count"></span></div>\n\t\t<div><span>成功:</span><span class="req_batch_c_success_count">0</span></div>\n\t\t<div><span>失敗:</span><span class="req_batch_c_fail_count">0</span></div>\n\t\t<div style="width:100%;font-size:0.8em"><span>メモリチェック:</span><span class="req_batch_c_mem"></span></div>\n\t</div>\n\t<div class="req_batch_fail text-danger" style="display:none"></div>\n\t\t'}_addReloadClickEvent(t){t.click((t=>{location.reload(!0)}))}_addStopClickEvent(t){t.click((t=>{this.stopThread(),this.startBtn.show()}))}_addFailBtnClickEvent(t){t.click((t=>{this.failDiv.toggle(300)}))}thread(){if(0==this.asyn_flg){if(this._showCCount(),this._advanceProg(),this.ic_start_time=Math.floor($.now()),this.data_num==this.main_index)return void this._endProcessing();if(this.asyn_flg=1,this.param.asyn_cb){var t=this.data[this.main_index];this.param.asyn_cb(this.main_index,t,this.param.asyn_param)}else this._asynForInner();this.main_index++,this._showMemory()}}_showCCount(){var t=this.main_index+"/"+this.data_num;this.cCountDiv.html(t)}_advanceProg(){var t=this.main_index/this.data_num*100;this.prog.val(t)}_endProcessing(){this.prog.hide(),this.successDiv.html("すべての処理が終わりました。"),this._showCCount(),this.stopThread(),this.reloadBtn.show(),this.param.complete_cb&&this.param.complete_cb()}_asynForInner(){var t=this.data[this.main_index],e=JSON.stringify(t);jQuery.ajax({type:"POST",url:this.param.ajax_url,data:"key1="+e,cache:!1,dataType:"text"}).done(((t,e)=>{var i;try{i=jQuery.parseJSON(t)}catch(e){return void this.asynFail(t)}this.asynSuccess(i)})).fail(((t,e,i)=>{this.errDiv.html(t.responseText),alert(e)}))}asynFail(t){this.asyn_flg=0,this._addFail(this.main_index,t),this._showFailCount(),this._checkFailLimit()}asynSuccess(t){if(this.param.asyn_res_cb){var e=this.main_index-1;this.param.asyn_res_cb(e,t)}this._successCountAndShow(),this.asyn_flg=0}_successCountAndShow(){this.success_count++,this.cSuccessDiv.html(this.success_count)}_addFail(t,e){var i=`\n\t\t\t<div style="display:inline-block">\n\t\t\t\t<input type="button" class="btn btn-secondary btn-sm" value="失敗 ${t}" onclick="jQuery('#req_batch_fail${t}').toggle(300)">\n\t\t\t\t<div id="req_batch_fail${t}" style="display:none">${e}</div>\n\t\t\t</div>\n\t\t`;this.failDiv.append(i)}_showFailCount(){this.fail_count++,this.cFailDiv.html(this.fail_count);var t="失敗("+this.fail_count+")";this.failBtn.attr("value",t)}_checkFailLimit(){if(this.fail_count>this.param.fail_limit){this.stopThread();var t=`失敗数が${this.param.fail_limit}回を超えたので処理を中断します。`;this.errDiv.html(t)}}stopThread(){for(var t in this.handlers){var e=this.handlers[t];clearInterval(e)}}_showMemory(){if(null!=this.mems){var t=performance.memory.usedJSHeapSize-this.mems.usedJSHeapSize1;this.cMemDiv.html(t)}}_resetMemoryData(){var t=performance.memory;return null==t?null:{jsHeapSizeLimit1:t.jsHeapSizeLimit,totalJSHeapSize1:t.totalJSHeapSize,usedJSHeapSize1:t.usedJSHeapSize}}}
/**
 * サインX
 * @date 2021-4-1 | 2021-4-28
 * @license MIT
 * @version 1.0.1
 */class SigninX{constructor(){this.crudBaseConfig=this._getCrudBaseConfig()}init(t){this.param=this._setParamIfEmpty(t)}_setParamIfEmpty(t){return null==t&&(t={}),t}_getCrudBaseConfig(){let t=jQuery("#crudBaseConfig").val();return JSON.parse(t)}step1(){$("#app1").show(),this.app=new Vue({el:"#app1",data:{email:"",form_visible:1,send_mail_msg_visible:0,repw_visible:0},methods:{tempRegAction:()=>{this.tempRegAction()}}}),this._exJQueryValidator(),this._validStep1()}_validStep1(){var t,e;t={email:{required:!0,email:!0}},e={},$("#step1_form").validate({rules:t,messages:e,errorPlacement:function(t,e){e.is(":radio")||e.is(":checkbox")?t.appendTo(e.parent()):t.insertAfter(e)}})}tempRegAction(){if(!$("#step1_form").valid())return;let t=$("#csrf_token").val();var e={email:this.app.email},i=JSON.stringify(e),a=new FormData;a.append("key1",i),a.append("csrf_token",t);let r=this.crudBaseConfig.crud_base_project_path+"/signin_x/tempRegAction";jQuery.ajax({type:"post",url:r,data:a,cache:!1,dataType:"text",processData:!1,contentType:!1}).done((t=>{var e;try{e=jQuery.parseJSON(t)}catch(e){return void jQuery("#err").append(t)}if(1==e.is_repw&&(this.app.repw_visible=1),1==e.send_mail_flg&&(this.app.send_mail_msg_visible=1,1==e.dev_flg)){let t=$("#dev_mailtext");t.show(),t.html(e.dev_mailtext)}})).fail(((t,e,i)=>{jQuery("#err").append("アクセスエラー"),jQuery("#err").append(t.responseText),alert(e)}))}_getProperty(t,e,i,a){let r=null;return r=null!=a[t]?a[t]:null!=i[t]?i[t]:e,r}_exJQueryValidator(){$.extend($.validator.messages,{email:"正しいメールアドレスの形式で入力して下さい",required:"入力必須です",phone:"正しい電話番号の形式で入力してください"}),jQuery.validator.addMethod("katakana",(function(t,e){return this.optional(e)||/^([ァ-ヶー]+)$/.test(t)}),"全角カタカナを入力してください"),jQuery.validator.addMethod("kana",(function(t,e){return this.optional(e)||/^([ァ-ヶーぁ-ん]+)$/.test(t)}),"全角ひらがな･カタカナを入力してください"),jQuery.validator.addMethod("hiragana",(function(t,e){return this.optional(e)||/^([ぁ-ん]+)$/.test(t)}),"全角ひらがなを入力してください"),jQuery.validator.addMethod("phone",(function(t,e){return this.optional(e)||/^(?:\+?\d+-)?\d+(?:-\d+){2}$|^\+?\d+$/.test(t)}),"正しい電話番号を入力してください"),jQuery.validator.addMethod("postcode",(function(t,e){return this.optional(e)||/^\d{3}\-?\d{4}$/.test(t)}),"郵便番号を入力してください（例:123-4567）"),jQuery.validator.addMethod("password_strength",(function(t,e){return this.optional(e)||/^(?=.*?[a-z])(?=.*?\d)[a-z\d]{6,100}$/.test(t)}),"英数字を組み合わせたパスワードを入力してください")}step2(t){null==t&&(t={}),null==t.def_role&&(t.def_role="oparator"),null==t.roleOptions&&(t.roleOptions=[{text:"オペレータ",value:"oparator"},{text:"クライアント",value:"client"}]),$("#app1").show();let e=$("#user_json").val(),i=JSON.parse(e),a=i.role;null==a||""==a?a=t.def_role:this._isRoleInOptions(a,t.roleOptions)||(a=t.def_role),this.app=new Vue({el:"#app1",data:{nickname:i.nickname,password:"",role:a,roleOptions:t.roleOptions,form_visible:1,send_mail_msg_visible:0,repw_visible:0,success:0},methods:{pwReg:()=>{this.pwReg()}}}),this._exJQueryValidator(),this._validStep2()}_isRoleInOptions(t,e){let i=!1;for(let a in e){if(t==e[a].value){i=!0;break}}return i}_validStep2(){var t,e;t={nickname:{required:!0,maxlength:50},password:{required:!0,minlength:8,maxlength:100,password_strength:!0},password_confirm:{equalTo:"[name=password]"}},e={password:{required:"パスワードを入力してください",minlength:"パスワードは8文字以上で入力してください"},password_confirm:{required:"確認のため再度入力してください",equalTo:"同じパスワードをもう一度入力してください。"}},$("#step2_form").validate({rules:t,messages:e,errorPlacement:function(t,e){e.is(":radio")||e.is(":checkbox")?t.appendTo(e.parent()):t.insertAfter(e)}})}pwReg(){if(!$("#step2_form").valid())return;let t=$("#csrf_token").val(),e=$("#user_json").val(),i=JSON.parse(e);i.nickname=this.app.nickname,i.password=this.app.password,i.role=this.app.role;let a={ent:i,repw_flg:$("#repw_flg")};var r=JSON.stringify(a),s=new FormData;s.append("key1",r),s.append("csrf_token",t);let l=this.crudBaseConfig.crud_base_project_path+"/signin_x/pwReg";jQuery.ajax({type:"post",url:l,data:s,cache:!1,dataType:"text",processData:!1,contentType:!1}).done((t=>{var e;try{e=jQuery.parseJSON(t)}catch(e){return void jQuery("#err").append(t)}if(1==e.success){if(this.app.success=1,this.app.form_visible=0,this.app.send_mail_msg_visible=1,1==e.dev_flg){let t=$("#dev_mailtext");t.show(),t.html(e.dev_mailtext)}let t=this.crudBaseConfig.crud_base_project_path;location.href=t}})).fail(((t,e,i)=>{jQuery("#err").append("アクセスエラー"),jQuery("#err").append(t.responseText),alert(e)}))}repw(){$("#app1").show(),this.app=new Vue({el:"#app1",data:{email:"",form_visible:1,send_mail_msg_visible:0},methods:{tempRegActionForRepw:()=>{this.tempRegActionForRepw()}}}),this._exJQueryValidator(),this._validRepw()}_validRepw(){var t,e;t={email:{required:!0,email:!0}},e={},$("#form1").validate({rules:t,messages:e,errorPlacement:function(t,e){e.is(":radio")||e.is(":checkbox")?t.appendTo(e.parent()):t.insertAfter(e)}})}tempRegActionForRepw(){if(!$("#form1").valid())return;let t=$("#csrf_token").val();var e={email:this.app.email,repw_flg:1},i=JSON.stringify(e),a=new FormData;a.append("key1",i),a.append("csrf_token",t);let r=this.crudBaseConfig.crud_base_project_path+"/signin_x/tempRegAction";jQuery.ajax({type:"post",url:r,data:a,cache:!1,dataType:"text",processData:!1,contentType:!1}).done((t=>{var e;try{e=jQuery.parseJSON(t)}catch(e){return void jQuery("#err").append(t)}if(1==e.repw_flg&&(this.app.repw_visible=1),1==e.send_mail_flg&&(this.app.send_mail_msg_visible=1,1==e.dev_flg)){let t=$("#dev_mailtext");t.show(),t.html(e.dev_mailtext)}})).fail(((t,e,i)=>{jQuery("#err").append("アクセスエラー"),jQuery("#err").append(t.responseText),alert(e)}))}}